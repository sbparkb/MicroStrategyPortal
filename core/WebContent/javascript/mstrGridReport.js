var mstrGrid=mstrGridReport;mstrGridReportScript=true;mstrGridReport.prototype=new mstrGridStatic();mstrGridReport.prototype.type=microstrategy.OBJTYPE_GRID;mstrGridReport.prototype.um=microstrategy.updateManager;mstrGridReport.prototype.mask=null;mstrGridReport.prototype.maskFor=null;mstrGridReport.prototype.maskArea=null;mstrGridReport.prototype.gridTable=null;mstrGridReport.prototype.selections=null;mstrGridReport.prototype.activeElement=null;mstrGridReport.prototype.hasNoMetrics=true;mstrGridReport.prototype.metricsCount=-1;mstrGridReport.prototype.metricsOnRows=false;mstrGridReport.prototype.checkBanding=false;mstrGridReport.prototype.hasThresholds=false;mstrGridReport.prototype.thresholdsState=false;mstrGridReport.prototype.disabled=false;mstrGridReport.prototype.objId=null;mstrGridReport.prototype.dragDisplay=null;mstrGridReport.prototype.imgDisplay=null;mstrGridReport.prototype.x=0;mstrGridReport.prototype.y=0;mstrGridReport.prototype.template=null;mstrGridReport.prototype.viewerId=null;mstrGridReport.prototype.bp=null;mstrGridReport.prototype.fp=null;mstrGridReport.prototype.parentSubsection=null;mstrGridReport.prototype.useClientSideManipulations=false;mstrGridReport.prototype.isEmptyTemplate=true;mstrGridReport.prototype.dSetId="";mstrGridReport.prototype.dSetName="";mstrGridReport.prototype.doColWidths=false;mstrGridReport.prototype.colWidths=null;mstrGridReport.prototype.startCol=0;mstrGridReport.prototype.endCol=0;mstrGridReport.prototype.maxCols=-1;mstrGridReport.prototype.gridStructureInfo=null;mstrGridReport.prototype.showAttForms=false;mstrGridReport.prototype.isDndEnabled=true;mstrGridReport.prototype.isMdxCube=false;mstrGridReport.prototype.isXDACustomSQLReport=false;mstrGridReport.prototype.isViewReport=false;mstrGridReport.prototype.useDNDMapping=false;mstrGridReport.prototype.dndHelper=null;mstrGridReport.prototype.overlapGridTitles=false;mstrGridReport.prototype.showEmptyAxis=false;mstrGridReport.prototype.emptyAxisVisible=false;mstrGridReport.prototype.showGraphDropZones=false;mstrGridReport.prototype.isFilterVisible=false;mstrGridReport.prototype.gridFormatReqId=null;mstrGridReport.prototype.gridSelections="";mstrGridReport.prototype.currentPageX="";mstrGridReport.prototype.currentPageY="";mstrGridReport.prototype.showColHeaders=true;mstrGridReport.prototype.showRowHeaders=true;mstrGridReport.prototype.rowAxis=null;mstrGridReport.prototype.colAxis=null;mstrGridReport.prototype.pagebyAxis=null;mstrGridReport.prototype.metricsAxis=null;mstrGridReport.prototype.copyAxes=false;mstrGridReport.prototype.gridCellCssPrefix="";mstrGridReport.prototype.isReportRedoable=false;mstrGridReport.prototype.isReportUndoable=false;mstrGridReport.prototype.isOutlineMode=false;mstrGridReport.prototype.isStaticOutlineMode=false;mstrGridReport.prototype.outlineMode=null;mstrGridReport.prototype.outlineModeStartRow=0;mstrGridReport.prototype.outlineModeEndRow=0;mstrGridReport.prototype.outlineModeExpandImage="";mstrGridReport.prototype.outlineModeContractImage="";mstrGridReport.prototype.outlineModeLevel=0;mstrGridReport.prototype.outlineModeWithLockHeaders=false;mstrGridReport.prototype.isSaveBeforeDocCreate=false;mstrGridReport.prototype.reportID=null;mstrGridReport.prototype.parentFolderID=null;mstrGridReport.prototype.messageID=null;mstrGridReport.prototype.stateID=null;mstrGridReport.prototype.objTypeReport=null;mstrGridReport.prototype.outlineModeMaxLevels=-1;mstrGridReport.prototype.currentView=microstrategy.DISPLAY_MODE_GRID;mstrGridReport.prototype.isDrilled=false;mstrGridReport.prototype.isNew=false;mstrGridReport.prototype.saveStateID=null;mstrGridReport.prototype.isReadOnly=false;mstrGridReport.prototype.saveEnabled=false;mstrGridReport.prototype.needSaveAs=false;mstrGridReport.prototype.autostyleId="";mstrGridReport.prototype.selectedAxis=null;mstrGridReport.prototype.selectedPosition=null;mstrGridReport.prototype.selectedLevel=null;mstrGridReport.prototype.selectedUnit=null;mstrGridReport.prototype.positionForGradient=null;mstrGridReport.prototype.gridArea=0.5;mstrGridReport.prototype.gridPosition=1;mstrGridReport.prototype.isGrid=false;mstrGridReport.prototype.isGraph=false;mstrGridReport.prototype.isVisualization=false;mstrGridReport.prototype.major=0;mstrGridReport.prototype.minor=0;mstrGridReport.prototype.categories=0;mstrGridReport.prototype.series=0;mstrGridReport.prototype.enableLegends=false;mstrGridReport.prototype.enableLabels=false;mstrGridReport.prototype.legend=false;mstrGridReport.prototype.dValues=false;mstrGridReport.prototype.seriesLayout=1;mstrGridReport.prototype.allowedGraphTypes=null;mstrGridReport.prototype.GRAPH_OBJECT_ID_FOOTNOTE=3;mstrGridReport.prototype.GRAPH_OBJECT_ID_TITLE=5;mstrGridReport.prototype.GRAPH_OBJECT_ID_SUBTITLE=4;mstrGridReport.prototype.GRAPH_OBJECT_ID_LEGEND_TEXT=9;mstrGridReport.prototype.GRAPH_OBJECT_ID_DATA_TEXT=260;mstrGridReport.prototype.GRAPH_OBJECT_ID_2DX_TITLE=293;mstrGridReport.prototype.GRAPH_OBJECT_ID_2DY1_TITLE=299;mstrGridReport.prototype.GRAPH_OBJECT_ID_2DY2_TITLE=305;mstrGridReport.prototype.GRAPH_OBJECT_ID_3DCOL_TITLE=515;mstrGridReport.prototype.GRAPH_OBJECT_ID_3DLY_TITLE=534;mstrGridReport.prototype.GRAPH_OBJECT_ID_3DROW_TITLE=555;mstrGridReport.prototype.GRAPH_OBJECT_ID_3DRY_TITLE=561;mstrGridReport.prototype.GRAPH_OBJECT_ID_NULL=9999;mstrGridReport.prototype.GRAPH_OBJECT_ID_OPILBL_VALUE=418;mstrGridReport.prototype.DEFAULT_GRAPH_MAJOR_TYPE=4;mstrGridReport.prototype.DEFAULT_GRAPH_MINOR_TYPE=1;mstrGridReport.prototype.Major_3D_surface=131072;mstrGridReport.prototype.Major_Hichert=33554432;mstrGridReport.prototype.Major_3D_scatter=262144;mstrGridReport.prototype.Major_Scatter=128;mstrGridReport.prototype.Major_Bubble=1024;mstrGridReport.prototype.Major_Gauge=524288;mstrGridReport.prototype.drillOpenInNewWindow=false;mstrGridReport.prototype.drillIframeEnabled=false;mstrGridReport.prototype.drillRetainParentValue="";mstrGridReport.prototype.drillKeepThreshValue="";mstrGridReport.prototype.oldFormatDrillPathImportance=null;mstrGridReport.prototype.drillElementListName="";mstrGridReport.prototype.gradientColorId="4225";mstrGridReport.prototype.gradientAngleId="4226";mstrGridReport.prototype.gradientXOffsetId="4229";mstrGridReport.prototype.gradientYOffsetId="4230";mstrGridReport.prototype.quickSwitch=false;mstrGridReport.prototype.isWidget=false;mstrGridReport.prototype.widgetDescription=null;mstrGridReport.prototype.widgetPreviewSrc=null;mstrGridReport.prototype.widgetPreview=null;mstrGridReport.prototype.needSaveBeforeNotes=true;mstrGridReport.prototype.hiliteCell=[];mstrGridReport.prototype.gridGraphUnitKeyContext=null;mstrGridReport.prototype.visualizationsEnabled=false;mstrGridReport.prototype.effectiveView=1;mstrGridReport.ALL_UNITS=microstrategy.GRID_OTHER;mstrGridReport.ROW_UNITS=microstrategy.GRID_OTHER+1;mstrGridReport.COL_UNITS=microstrategy.GRID_OTHER+2;mstrGridReport.METRIC_UNITS=microstrategy.GRID_OTHER+3;mstrGridReport.ALL_FORMAT_VALUES=5;mstrGridReport.prototype.nonUnitCount=mstrGridReport.METRIC_UNITS+1;mstrGridReport.prototype.gridUnitFormat=mstrGridReport.ALL_UNITS;mstrGridReport.prototype.gridValueFormat=2;mstrGridReport.prototype.formatMap=null;mstrGridReport.prototype.toolbarFormatMap={FontFamily:"fontFamily",FontSize:"fontSize",Bold:"fontWeight",Italic:"fontStyle",Underline:"textDecoration",FillColor:"backgroundColor",FontColor:"color"};mstrGridReport.prototype.saveFolderId=null;mstrGridReport.prototype.allVisList=null;mstrGridReport.prototype.isVFEmpty=false;mstrGridReport.FMT_TYPE_TITLE="2";mstrGridReport.OPACITY_MOUSE_OVER="0.6";mstrGridReport.OPACITY_MOUSE_OUT="1";mstrGridReport.OPACITY_SELECTED="0.5";mstrGridReport.SELECTOR_HILITE_CLASS="gridSelectorHilite";mstrGridReport.SELECTOR_MOUSE_OVER_CLASS="gridSelectorMouseOver";mstrGridReport.SELECTOR_MOUSE_OUT_CLASS="";mstrGridReport.ELEMENT_HILITE_CLASS="gridElementHilite";mstrGridReport.ELEMENT_HILITE_CLEAR_CLASS="";mstrGridReport.GRAPH_IMAGE=microstrategy.FOLDER_IMAGES+"graph.gif";mstrGridReport.GRID_GRAPH_IMAGE=microstrategy.FOLDER_IMAGES+"gridGraphli.gif";mstrGridReport.GRID_IMAGE=microstrategy.FOLDER_IMAGES+"iconGrid2.gif";mstrGridReport.heightAndWidthAttMap={hm:"heightMode",wm:"widthMode",ht:"height",wd:"width"};mstrGridReport.COL_WIDTH_FIT_TO_DISPLAY=1;mstrGridReport.COL_WIDTH_FIT_TO_CONTENT=2;mstrGridReport.COL_WIDTH_FIXED=3;mstrGridReport.prototype.gridWidthInfo={colScenario:mstrGridReport.COL_WIDTH_FIT_TO_DISPLAY,rowScenario:mstrGridReport.COL_WIDTH_FIT_TO_CONTENT,rowHeight:""};mstrGridReport.SAME_PROMPT=1;mstrGridReport.DO_NOT_ANSWER=2;mstrGridReport.CLOSE=3;mstrGridReport.DYNAMIC=4;mstrGridReport.STATIC=5;mstrGridReport.CURRENT_UNIT=6;mstrGridReport.ALL_VALID_UNITS=7;mstrGridReport.USE_DEFAULT_ANSWER=8;mstrGridReport.DYNAMIC_OR_SAME_PROMPT=9;mstrGridReport.CONSTANT_PROMPT_TYPE=1;mstrGridReport.TARGET_VALUE="tval";mstrGridReport.GRAPH_FONT_STYLE="gfs";mstrGridReport.GRAPH_FONT_FAMILY="gff";mstrGridReport.GRAPH_FONT_SIZE="gfz";mstrGridReport.GRAPH_FONT_COLOR="gfc";mstrGridReport.APPLICABLE_PROPERTY="ap";mstrGridReport.INDEX="index";mstrGridReport.IS_FOR_ALL="forAll";mstrGridReport.prototype.initObjId=function(){try{var s=this.id.split("_");this.objId=s[1]||s[0];}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.isModifyGridInDoc=function(){return false;};mstrGridReport.isDesignMode=function(){return(microstrategy.DISPLAY_MODE==microstrategy.DESIGN_MODE);};mstrGridReport.isReport=function(){return(microstrategy.EXECUTION_SCOPE==microstrategy.REPORT_EXECUTION);};mstrGridReport.isRWD=function(){return(microstrategy.EXECUTION_SCOPE==microstrategy.RWD_EXECUTION);};mstrGridReport.allowEdit=function(){return(microstrategy.EDIT_MODE==microstrategy.ALLOW_EDIT_MODE);};mstrGridReport.isViewMode=function(){return(microstrategy.DISPLAY_MODE==microstrategy.VIEW_MODE);};mstrGridReport.updateNow=function(){return(mstrGridReport.isDesignMode())?mstrUpdateManager.UPDATE_LATER:mstrUpdateManager.UPDATE_NOW;};mstrGridReport.prototype.addBoneHandler=function(id,handler){return new Function("e","return microstrategy.bone('"+id+"')."+handler+"(e);");};mstrGridReport.prototype.onload=function(){try{this.isGridStatic=false;mstrGridStatic.prototype.onload.call(this);this.disabled=false;this.isGridPostLoaded=false;this.commands=new mstrGridCommands(this);if(this.objId==null){this.initObjId();}this.useDNDMapping=this.isDndMapping();if(mstrGridReport.allowEdit()){this.dndHelper=new mstrDNDHelperImpl(this);}this.initGrid();if(this.fp!=null){if(mstrGridReport.isDesignMode()){this.useClientSideManipulations=true;this.checkQuickSearchEnabled();}this.initTemplate();}if(this.isReportRedoable||this.isReportUndoable){microstrategy.eventManager.notifyOrphanBones("onupdatemanagerchange");}var useLockset=this.useLockset;var oldExpdPos=window.__expdRowPos;var expdOrd=this.expdRowOrd;var expdRow;var div;var table;if(typeof (expdOrd)!=="undefined"){if(useLockset){div=document.getElementById(this.id+"divLock4");table=div.getElementsByTagName("table")[0];}else{table=this.elem.getElementsByTagName("table")[0];}tBody=table.tBodies[0],rows=table.rows;for(var i=0;i<rows.length;i++){var r=rows[i];var o=r.getAttribute("o");if(o==expdOrd){expdRow=r;break;}}if(window.__expdRowPos){delete window.__expdRowPos;}}if(expdRow){var f=function(){if(useLockset){var rowScroll=getObjSumTop(expdRow,div);var rowPos=rowScroll-oldExpdPos;div.scrollTop=rowPos;}else{var rowScroll=getObjSumTopScrolled(expdRow);var rowPos=rowScroll-oldExpdPos;window.scrollTo(window.pageXOffset,rowPos);}};window.setTimeout(f,0);}else{if(mstrGridReport.isReport()&&getObjSumTopScrolled(this.elem)-document.documentElement.scrollTop<0){window.scrollTo(0,0);}}this.elem.onscroll=this.addBoneHandler(this.id,"onscroll");this.isGridBone=true;if(mstrGridReport.isReport()&&mstr){this.initNotesIcon();}this.initIncrementalFetchBoxes();this.initReportQuickSearch();}catch(err){microstrategy.errors.log(err);}finally{if(window.__expdRowPos){delete window.__expdRowPos;}}};mstrGridReport.prototype.checkQuickSearchEnabled=function(){try{this.quickSearchEnabled=this.isFeatureAvailable(microstrategy.FEATURE_REPORT_TEMPLATE_SEARCH)&&this.isGrid&&mstrGridReport.isReport()&&(microstrategy.useQuickSearch())&&!(this.isViewReport||this.isMdxCube||this.isXDACustomSQLReport)&&(mstrGridReport.isDesignMode()||!mstrGridReport.isDesignMode()&&microstrategy.enableGridViewSearch);return this.quickSearchEnabled;}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.initReportQuickSearch=function(){try{this.checkQuickSearchEnabled();if(!this.quickSearchEnabled){return ;}var me=this;mstrGridReport.createQuickSearchPlaceHolder=function(axis){var pl=document.createElement("div");pl.setAttribute("ty","qs");if(axis){pl.setAttribute("ax",axis);}pl.className="dummy-searchbox";pl.onmousedown=function(){microstrategy.openReportQuickSearchBox(this);};return pl;};mstrGridReport.attachSearchBoxPlaceholderHandler=function(elem){var placeholders=microstrategy.findChildrenWithAtt(elem||me.elem,"div","ty","qs");for(var i=0,len=placeholders.length;i<len;i++){var pl=placeholders[i];pl.className="dummy-searchbox";pl.onmousedown=function(e){microstrategy.openReportQuickSearchBox(this);};}};mstrGridReport.fnGetQuickSearchWidget=function(el){var qs=me.quickSearch||window.mstrmojo&&mstrmojo.all.ReportQuickSearchBox;if(qs){return qs;}else{var qs=mstrmojo.insert({scriptClass:"mstrmojo.ReportQuickSearchBox",id:"ReportQuickSearchBox",quicksearch:me.quickSearchEnabled,enableOptions:true,visible:false,itemSelectCallback:function(node,attForms){if(!microstrategy.checkACL(node,[microstrategy.ACL_EXECUTE,microstrategy.ACL_USE])){return ;}me=microstrategy.bone(me.id);var addTemplateUnit=function(node,axis,depth){if(!axis){axis=node.getAttribute(microstrategy.HTMLATTR_DSS_TYPE)==microstrategy.DSSTYPE_METRIC?microstrategy.GRIDCELL_AXIS_COLUMNS:microstrategy.GRIDCELL_AXIS_ROWS;}else{if(axis==microstrategy.GRIDCELL_AXIS_METRICS&&(!me.gridStructureInfo.hasMetrics||node.getAttribute(microstrategy.HTMLATTR_DSS_TYPE)==microstrategy.DSSTYPE_ATTRIBUTE)){axis=microstrategy.GRIDCELL_AXIS_COLUMNS;}}var um=microstrategy.updateManager,ac=me.commands.exec("addTemplateUnit",node,axis,depth||-1,[]);um.add(ac);if(microstrategy.DISPLAY_MODE==microstrategy.VIEW_MODE){um.flushAndSubmitChanges();}};if(!this.axis||this.axis&&(this.axis!=microstrategy.GRIDCELL_AXIS_PAGE_BY)||this.axis&&(this.axis==microstrategy.GRIDCELL_AXIS_PAGE_BY)&&mstrGridReport.isDesignMode()){addTemplateUnit(node,this.axis,this.depth);}if(this.axis&&(this.axis==microstrategy.GRIDCELL_AXIS_PAGE_BY)){if(mstrGridReport.isDesignMode()){microstrategy.activeCXMenu=microstrategy.findChildWithAtt(me.elem,"td",microstrategy.HTMLATTR_DSS_ID,node.getAttribute(microstrategy.HTMLATTR_DSS_ID));me.processContextMenus("p");}else{var pgb=microstrategy.bone("pbb_PageByStyle");pgb.useClientSideManipulations=false;pgb.addUnit(node,microstrategy.GRIDCELL_AXIS_PAGE_BY,1,null);}}var wkBone=microstrategy.bone("tbWkSet_ObjectBrowserReportWorkingSetStyle");wkBone&&wkBone.tree.addNode(node);}});if(qs&&!qs.hasRendered){qs.render();document.body.appendChild(qs.domNode);}me.quickSearch=qs;return me.quickSearch;}};microstrategy.openReportQuickSearchBox=function(el){var openQS=function(){var sb=mstrGridReport.fnGetQuickSearchWidget(el);if(!sb){return ;}var sbn=sb.domNode;if(el.firstChild){window.setTimeout(function(){sb.set("visible",true);sb.inputNode.focus();},10);return ;}sb.axis=el.getAttribute("ax")||sb.axis;switch(parseInt(sb.axis,10)){case -1:sb.set("objectType",sb.objectType||"4");break;default:sb.set("objectType",sb.objectType||sb.ALL_TYPES);break;}if(sb.suggestionPopup&&sb.suggestionPopup.containerNode){sb.suggestionPopup.containerNode.scrollTop=0;}el.appendChild(sbn);sb.set("visible",false);window.setTimeout(function(){sb.set("visible",true);sb.clearSearch();sb.inputNode.focus();},20);};microstrategy.mojoLoader.loadWidget({bundle:"mojo-ros.js",callback:openQS});};}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.isDndMapping=function(){try{if(!this.showColHeaders&&!this.showRowHeaders){return false;}if(!this.isDndEnabled){return false;}if(!this.isFeatureAvailable(microstrategy.FEATURE_EMBEDDED_TEMPLATE_NODE)){return false;}var that=this;var fn=function(v){return that.isFeatureAvailable(microstrategy["FEATURE_"+v]);};return(this.isModifyGridInDoc()||fn("DESIGN_MODE")||fn("OBJECT_BROWSER_EDITOR")||fn("WEB_PIVOT"));}catch(err){microstrategy.errors.log(err);}return false;};mstrGridReport.prototype.onpostload=function(){try{mstrGridStatic.prototype.onpostload.call(this);if(mstrGridReport.allowEdit()&&!(this.visualizationMode==50&&this.docViewer&&!this.docViewer.isEditableViewModeEplus())){this.selections=null;this.initSelections(true);}this.rowAxis=this.colAxis=this.pagebyAxis=this.metricsAxis=null;this.notifySelectionChange("ongridselectionschange");}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.onreload=function(e){try{mstrRWUnitBoneImpl.prototype.onreload.call(this,e);if(bIsW3C&&mstrGridReport.isReport()){if(document.getElementById("gridStyleIFrame")){var gridStyle=document.getElementById("gridStyle");var t=gridStyle&&gridStyle.parentNode&&gridStyle.parentNode.removeChild(gridStyle);}}if(!!this.graphSelections){var ps=eval("("+this.graphSelections+")");this.setGraphSelected(ps.graphSelected);if(this.graphSelected){this.selectedGraphUnit=ps.graphSelectedUnit;this.selectedGraphTargetValue=ps.graphSelectedValue;}}}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.onrepostload=function(e){try{mstrGridStatic.prototype.onrepostload.call(this);if(mstrGridReport.isReport()){this.observer.notifyAll("onReportReload");}}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.onscroll=function(e){try{stopEventBubbling(e||window.event);}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.initGrid=function(){try{mstrGridStatic.prototype.initGrid.call(this);if(this.copyAxes){var bone=microstrategy.bone(this.id.substr(0,this.id.lastIndexOf("_"))+"_0");this.rowAxis=bone.rowAxis;this.colAxis=bone.colAxis;this.pagebyAxis=bone.pagebyAxis;this.metricsAxis=bone.metricsAxis;this.copyAxes=false;}var gsi=this.gridStructureInfo;if(!this.gridStructureInfo){if(!this.isGrid&&this.isGraph){var graphId=this.elem.id;var gridId=graphId.slice(0,graphId.lastIndexOf("_"));var gridBone=microstrategy.bone(gridId);if(gridBone&&gridBone.gridStructureInfo){gsi=this.gridStructureInfo=gridBone.gridStructureInfo;}else{this.needsGridInfo=true;}}}if(!gsi){gsi=this.gridStructureInfo=new mstrGridInfo(this);gsi.init(this.elem);}if(this.isGrid&&this.isGraph){var gridId=this.elem.id;var graphId=gridId+"_graph";var graphBone=microstrategy.bone(graphId);if(graphBone&&graphBone.needsGridInfo){graphBone.gridStructureInfo=this.gridStructureInfo;graphBone.needsGridInfo=false;}}if(this.shouldInitMask()){this.initMask();}if(this.isGridBone||mstrGridReport.isDesignMode()){if(!gsi.emptyCase){var oTables=this.elem.getElementsByTagName("table");if(oTables){this.gridTable=oTables[0];for(i=0;i<oTables.length;i++){oTables[i].getElementsByTagName("tbody")[0].onmousedown=this.addBoneHandler(this.id,"onmousedown");if(!mstrGridReport.isDesignMode()){oTables[i].getElementsByTagName("tbody")[0].onclick=this.addBoneHandler(this.id,"onclick");}}}this.doColWidths=(!mstrGridReport.isDesignMode()&&gsi.enableColWidths()&&this.isFeatureAvailable("enable-resize-columns-rows"));if(this.doColWidths&&this.isGrid&&this.isFeatureAvailable("grid-layout")){var that=this;window.setTimeout(function delayInitColResize(){that.initColResize();},0);}if(this.isOutlineMode){this.outlineMode=new mstrOutlineModeImpl(parseInt(this.outlineModeStartRow),parseInt(this.outlineModeEndRow),this.outlineModeExpandImage,this.outlineModeContractImage,this.outlineModeLevel,this.outlineModeMaxLevels,this);}var that=this;window.setTimeout(function(){if(mstr.utils.ISFF&&that.elem&&that.elem.offsetHeight>32768){that.elem.style.overflowX="";}},0);}}this.setDsetId(this.dSetId);}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.initNotesIcon=function(){try{var nim=mstr.$obj("NotesIconModel_model");if(nim&&!this.needSaveBeforeNotes){nim.set("objectID",this.reportID);nim.set("objectType",this.objTypeReport);}if(this.needSaveBeforeNotes||(microstrategy.bone("accordion_AccordionTabManagerStyle")&&microstrategy.bone("accordion_AccordionTabManagerStyle").currentTabName==microstrategy.ACCORDION_REPORT_NOTES_PANEL)){var notesIconView=mstr.$obj("NotesIconView_view");if(notesIconView){notesIconView.set("visible",false);}}else{if(!this.inReload&&nim){nim.execCheck();}}}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.initMapper=function(){try{if(this.mapper){return ;}if(this.useDNDMapping){this.getMapper();this.maskArea=this.elem;this.maskFor=microstrategy.DSSTYPE_METRIC+microstrategy.HTMLATTR_MASKFOR_DELIM+microstrategy.DSSTYPE_ATTRIBUTE;}}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.getMapper=function(){try{this.mapper=new mstrGridMapperImpl();}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.initTemplate=function(){try{this.template=new mstrTemplateImpl();this.template.onload(this.gridTable,this,this.fp);}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.addAction=function(elem,actId,bp,args,argv,ac){bp=bp||this.beanPath;args=args||[];argv=argv||[];var a=this.um.createActionObject(elem,actId,bp,args,argv,[]);if(ac){ac.push(a);}else{this.um.add([a]);this.um.flushAndSubmitChanges();}};mstrGridReport.prototype.handleDatasetExplorer=function(info){try{var ds=info.items[0];this.addAction(this.elem,mstrUpdateManager.ADD_DATASET_AND_TEMPLATE,mstr.$obj("mstrPageInfo").get("beanPath"),["2048032","2048033","2048012","2048135"],[ds.dssid,ds.tp,this.objId,(info.formatting)?1:2]);}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.onlockscroll=function(){try{if(this.colWidths!=null){this.colWidths.syncCols();}if(this.mask!=null){this.mask.onmaskedobjectresize();}}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.onresize=function(){try{if(this.mask!=null){this.mask.onmaskedobjectresize();}if(mstr.utils.ISIE8||mstr.utils.ISIE9||mstr.utils.ISIE10||mstr.utils.ISW3CIE){var me=this;window.setTimeout(function(){me.resizeLockSet(true);},10);}else{this.resizeLockSet();}if(this.colWidths){this.colWidths.syncCols();}if(mstr.utils.ISIE6&&mstrGridReport.isReport()&&this.image&&!mstrGridReport.isDesignMode()){var rf=microstrategy.bone("ReportFrame").elem;if(document.body.clientWidth>mstr.utils.BoxModel.getBrowserWindowWidth(document)){rf.style.width=Math.max(mstr.utils.BoxModel.getBrowserWindowWidth(document)-mstr.utils.BoxModel.getElementSumOffsetLeft(document.getElementById("reportViewAllModes")),this.image.clientWidth)+"px";}else{rf.style.width="auto";}}}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.copyBoneProperties=function(sourceGridBone){try{if(sourceGridBone){this.setFeature(microstrategy.FEATURE_EMBEDDED_TEMPLATE_NODE,sourceGridBone.isFeatureAvailable(microstrategy.FEATURE_EMBEDDED_TEMPLATE_NODE));if(this.gridStructureInfo&&sourceGridBone.gridStructureInfo){this.gridStructureInfo.dataSetId=sourceGridBone.gridStructureInfo.dataSetId;}this.editorProperties=sourceGridBone.editorProperties;}}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.onwinresize=function(){try{if(this.isGridPostLoaded){this.ondialogresize();}}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.ondocumentclick=function(e){try{var s=this.selections;window.setTimeout(this.resetGridUnitSelections,0);var t=s&&s.ondocumentclick&&s.ondocumentclick(e);}catch(err){microstrategy.errors.log(err);}};mstrGridReport.desp=function(s){return microstrategy.descriptors.getDescriptor(s);};mstrGridReport.prototype.onObjectBrowserTabChange=function(tabName){try{this.observer.notifyAll("onObjectBrowserTabChange");if(mstrGridReport.isDesignMode()){return ;}var gs=this.gridStructureInfo;if((gs.isEmptyTemplate&&gs.metricsAxis!=microstrategy.GRIDCELL_AXIS_PAGE_BY)||!this.showEmptyAxis||!gs.hasEmptyAxis()||this.noData){return ;}var outlineMode=false;var r,rX,rC,rR;var ct=function(s){return document.createTextNode(mstrGridReport.desp(s));};var fn=function(o){return o.getElementsByTagName("tbody")[0].rows;};if(this.lockSet){var l=this.lockSet.quadrants;r=l[0]?fn(l[0]):null;rX=l[1]?fn(l[1]):null;rC=l[2]?fn(l[2]):null;rR=l[3]?fn(l[3]):null;outlineMode=true;}else{r=fn(this.elem);}var tr,td,i,j,cnt,divs;var sizeFn=(this.showAttForms)?"totalSize":"size";var rtSpan=this.getFixedRows();var rhSpan=rtSpan==r.length?1:r.length-rtSpan;var fnT=function(){divs=[r,rX,rR,rC];for(i=0;i<4;i++){if(divs[i]){td=divs[i][0].insertCell(0);if(rtSpan>0){td.rowSpan=rtSpan;}td.className="r-rowTitle r-cell";td.innerHTML="&nbsp;";}}};var fnH=function(newCell){divs=[r,rR];for(i=0;i<2;i++){if(divs[i]){tr=newCell?divs[i][0].parentNode.insertRow(divs[i].length):divs[i][rtSpan];td=tr.insertCell(0);if(rhSpan>0){td.rowSpan=rhSpan;}td.className="r-rowHeader r-cell";td.appendChild(ct("4500"));if(newCell){td=r[rtSpan].insertCell(1);var gstr=r[gs.colAxis[sizeFn]()-1];if(gstr&&gstr.cells){var sz=gstr.cells.length;if(bIsIE8||bIsIE6||bIsIE7&&sz>1000){td.colSpan=250;}else{td.colSpan=sz;}}td.className="r-metricValue r-cell";td.appendChild(ct("4501"));}}}};var that=this;var rmvCol=function(isFirst){if(!that.gridTable){return ;}var colgroup=that.gridTable.getElementsByTagName("colgroup")[0];var col;if(isFirst){col=colgroup.firstChild;}else{col=colgroup.lastChild;}if(col){colgroup.removeChild(col);}};var insCol=function(isFirst){if(!that.gridTable){return ;}var colgroup=that.gridTable.getElementsByTagName("colgroup")[0];var col=document.createElement("col");col.setAttribute("key","3");if(isFirst){colgroup.insertBefore(col,colgroup.firstChild);}else{colgroup.appendChild(col);}};var rvCell=function(row){return(row&&row.cells&&row.cells.length>0);};switch(tabName){case"workingSet":case"objectBrowser":if(this.emptyAxisVisible){return ;}if(gs.rowAxis[sizeFn]()==0&&gs.metricAxis[sizeFn]()==0){insCol(true);fnT();fnH(true);}else{if(gs.rowAxis[sizeFn]()==0){insCol(true);fnT();fnH();}if(gs.metricAxis[sizeFn]()==0){insCol();var cs=gs.colAxis[sizeFn]();if(cs==0){divs=[r,rC];for(i=0;i<2;i++){if(divs[i]){td=divs[i][0].insertCell(divs[i][0].cells.length);td.className="r-colHeader r-cell";td.appendChild(ct("4502"));}}if(r[1]){td=r[1].insertCell(r[1].cells.length);td.rowSpan=r.length-1;td.className="r-metricValue r-cell";td.appendChild(ct("4501"));}}else{tr=r[cs];td=tr.cells[tr.cells.length-1];if(td.rowSpan==1){for(i=cs+1,cnt=r.length;i<cnt;i++){tr=r[i];tr.removeChild(tr.cells[tr.cells.length-1]);}td.rowSpan=r.length-gs.colAxis[sizeFn]();}td.className="r-metricValue r-cell";td.appendChild(ct("4501"));}}}this.emptyAxisVisible=true;break;default:if(!this.emptyAxisVisible){return ;}if(gs.rowAxis[sizeFn]()==0){rmvCol(true);divs=[r,rX,rC,rR];for(i=0;i<4;i++){if(divs[i]&&rvCell(divs[i][0])){divs[i][0].removeChild(divs[i][0].cells[0]);}}divs=[r,rR];for(i=0;i<2;i++){if(divs[i]){tr=divs[i][rtSpan];var tmp;if(rvCell(tr)){tmp=tr&&tr.removeChild(tr.cells[0]);}}}}if(gs.rowAxis[sizeFn]()==0&&gs.metricAxis[sizeFn]()==0){divs=[r,rR];for(i=0;i<2;i++){if(divs[i]){tr=divs[i][divs[i].length-1];tr.parentNode.removeChild(tr);}}}else{if(gs.metricAxis[sizeFn]()==0){if(gs.colAxis[sizeFn]()==0){rmvCol();divs=[r,rC];for(i=0;i<2;i++){if(divs[i]){tr=divs[i][0];tr.removeChild(tr.cells[tr.cells.length-1]);}}tr=r[1];if(rvCell(tr)){tr.removeChild(tr.cells[tr.cells.length-1]);}}else{tr=r[gs.colAxis[sizeFn]()];td=tr.cells[tr.cells.length-1];while(td.hasChildNodes()){td.removeChild(td.lastChild);}}}}this.emptyAxisVisible=false;break;}if(outlineMode){divs=[r,rX,rR,rC];for(i=0;i<4;i++){if(divs[i]){var t=divs[i][0].parentNode.parentNode;t.style.tableLayout="auto";t.style.width="auto";}}}this.onresize();}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.ondialogresize=function(e){try{if(this.gridWidthInfo!=null&&this.gridWidthInfo.colScenario==mstrGridReport.COL_WIDTH_FIXED){this.resizeLockSet();}else{this.onresize(e);}}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.onQuickSwitchClick=function(e){};mstrGridReport.isMetric=function(t,isUnResolveMOP){var cmp=function(v,s){s=!s?"":s+"_";return(v==microstrategy["DSSTYPE_"+s+"METRIC"]);};return(cmp(t)||cmp(t,"USER")||cmp(t,"USER_SUMMARY")||(isUnResolveMOP&&t==microstrategy.DSSTYPE_PROMPT&&mstrGridReport.isDesignMode()));};mstrGridReport.prototype.onnotifydrag=function(items,bone,types){try{if(this.mask==null||this.disabled||!this.useDNDMapping){return null;}var type=null;var isOnlyMetrics=true;if(bone==this||bone.type==microstrategy.OBJTYPE_PAGE_BY||bone.type==microstrategy.OBJTYPE_OBJBROWSER){if(!this.isFeatureAvailable(microstrategy.FEATURE_WEB_PIVOT)){return null;}type=types[0];var testDatasetId=(mstrGridReport.isRWD()&&this.dSetId)?this.dSetId:null;for(var item in items){var objInfo=new mstrObjectInfoImpl(items[item]);if(bone.type==microstrategy.OBJTYPE_OBJBROWSER){if(objInfo.dssType==microstrategy.DSSTYPE_RPT_DEFINITION){if(mstrGridReport.isReport()||(mstrGridReport.isRWD()&&types.length>1)){return null;}}else{if(!this.isFeatureAvailable(microstrategy.FEATURE_MODIFY_GRID_LEVEL_IN_DOCUMENTS)){return null;}}if(objInfo.dssType==microstrategy.DSSTYPE_FILTER&&objInfo.dssSubType!=microstrategy.DSSTYPE_CUSTOM_GROUP){return null;}if(objInfo.dssType==microstrategy.DSSTYPE_ATTRIBUTE_FORM&&!this.isFeatureAvailable(microstrategy.FEATURE_SET_ATTRIBUTEFORM_DISPLAY)){return null;}if(objInfo.dssType==microstrategy.DSSTYPE_PROMPT&&objInfo.dssSubType!=microstrategy.DSSSUB_TYPE_PROMPT_OBJECTS){return null;}if(!microstrategy.checkACL(items[item],[microstrategy.ACL_USE])){return null;}if(mstrGridReport.isRWD()&&microstrategy.bones.rwb_viewer.isFeatureAvailable(microstrategy.FEATURE_SINGLE_SOURCE_GRID)){if(testDatasetId==null){testDatasetId=objInfo.dSetId;}if(objInfo.dssType!=microstrategy.DSSTYPE_RPT_DEFINITION&&objInfo.dSetId!=testDatasetId){return null;}}type=items[item].getAttribute(microstrategy.HTMLATTR_OBJTYPE);if(type!=null&&type==microstrategy.OBJTYPE_ELEMENT){return null;}if(mstrGridReport.isReport()&&this.isMdxCube&&!this.canAddMDXUnit(items[item])){return null;}}if(isOnlyMetrics&&!mstrGridReport.isMetric(objInfo.dssType)){isOnlyMetrics=false;}}types.sort(function(a,b){return parseInt(a)-parseInt(b);});if(types[0]==types[types.length-1]){type=types[0];}else{type=(isOnlyMetrics)?microstrategy.DSSTYPE_METRIC:microstrategy.DSSTYPE_ATTRIBUTE;}}if(type==null){return null;}switch(type){case microstrategy.DSSTYPE_TEMPLATE:type=mstrMaskMappedImpl.MASK_TYPE;break;case microstrategy.DSSTYPE_METRIC:case microstrategy.DSSTYPE_USER_METRIC:case microstrategy.DSSTYPE_USER_SUMMARY_METRIC:type=microstrategy.DSSTYPE_METRIC;break;case microstrategy.DSSTYPE_RPT_DEFINITION:type=microstrategy.DSSTYPE_RPT_DEFINITION;break;default:type=microstrategy.DSSTYPE_ATTRIBUTE;break;}if(this.gridStructureInfo.emptyCase||type==microstrategy.DSSTYPE_RPT_DEFINITION){type=mstrMaskMappedImpl.MASK_TYPE;}microstrategy.eventManager.notifyOrphanBones("onforcerepaint");this.dragSource=bone;if(!this.mask.isLoaded){var msk=this.mask;var that=this;if(mstrGridReport.isReport()){this.initializeMapper(msk,type);}else{this.elem.onmouseover=function(){that.elem.onmouseover=null;that.initializeMapper(msk,type);};}}else{this.mask.toggle(true,type);}this.dragSource=bone;}catch(err){microstrategy.errors.log(err);}return null;};mstrGridReport.prototype.onnotifydragend=function(){try{if(this.mask&&this.mask.isLoaded&&this.mask.toggle){this.mask.toggle(false);microstrategy.eventManager.notifyOrphanBones("onforcerepaint");}else{if(this.dragSource){var ds=this.dragSource;var type=ds.type;if(ds==this||type==microstrategy.OBJTYPE_PAGE_BY||type==microstrategy.OBJTYPE_OBJBROWSER){this.elem.onmouseover=null;}}}}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.initializeMapper=function(msk,type){if(microstrategy.midx==undefined){microstrategy.midx=0;}this.mask.midx=microstrategy.midx++;this.initMapper();msk.onload(this);msk.toggle(true,type);this.initializeDragDisplay();};mstrGridReport.prototype.adjustGridWidth=function(widthMode){try{if((mstr.utils.Arrays.find(["0","2"],widthMode)>-1)&&this.isGrid&&this.gridTable){var tableLayout="auto";var width="auto";if(widthMode=="0"){if(this.gridWidthInfo.colScenario!="2"){tableLayout="fixed";width="100%";}else{return true;}}var s=this.gridTable.style;s.tableLayout=tableLayout;s.width=width;}return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrGridReport.prototype.processRedoUndo=function(s){try{if(this.um.anyNonStatic(true)){this.um[s.toLowerCase()]();}else{if(this["isReport"+s+"able"]){this.addAction(this.elem,mstrUpdateManager["REPORT_"+s.toUpperCase()]);}}}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.processRedo=function(){this.processRedoUndo("Redo");};mstrGridReport.prototype.processUndo=function(){this.processRedoUndo("Undo");};mstrGridReport.prototype.commonRedoUndoCode=function(action,mode){try{var cw=this.colWidths;switch(action.id){case mstrUpdateManager.RESIZE_SINGLE_COLUMN:if(this.objId==action.cachedArray.objId&&cw&&(mode=="undo"||this.gridWidthInfo.colScenario==mstrGridReport.COL_WIDTH_FIXED)){var key=action.args[0];if(key=="allcolumns"){for(var i=0,cnt=cw.widths.length;i<cnt;i++){cw.setColWidthByIndex(i,(mode=="undo")?action.args[1][i]:action.args[1],cw.getColWidthByIndex(i));}}else{cw.setColWidthByKey(key,action.args[1],cw.getColWidthByKey(key));}cw.syncCols();}break;case mstrUpdateManager.SET_RESIZE_ROW_SCENARIO:case mstrUpdateManager.SET_RESIZE_COLUMNS_SCENARIO:if(this.objId!=action.cachedArray.objId||!cw){break;}var isRows=(action.id==mstrUpdateManager.SET_RESIZE_ROW_SCENARIO);var args=[action.args[0]];if(isRows){args.push(action.args[1]);}cw[(isRows)?"setRowHeightMode":"setColWidthsMode"].apply(cw,args);this.gridWidthInfo[(isRows)?"rowScenario":"colScenario"]=action.args[0];cw.syncCols();break;case mstrUpdateManager.PIVOT_TEMPLATE_UNIT:case mstrUpdateManager.PIVOT_TEMPLATE_METRIC:case mstrUpdateManager.ADD_TEMPLATE_UNIT:case mstrUpdateManager.ADD_TEMPLATE_METRIC:case mstrUpdateManager.REMOVE_TEMPLATE_UNIT:case mstrUpdateManager.REMOVE_TEMPLATE_METRIC:case mstrUpdateManager.ADD_FORM:case mstrUpdateManager.REMOVE_FORM:case mstrUpdateManager.SWAP_TEMPLATE_AXES:if(action.cachedArray.id==this.id&&this.useClientSideManipulations&&this.template){if(action.id!=mstrUpdateManager.SWAP_TEMPLATE_AXES||this.isGrid||this.zonesEditor){this.template[mode](action);this.onresize();}}break;case mstrUpdateManager.PIVOT_MULTIPLE_UNITS:case mstrUpdateManager.REMOVE_MULTIPLE_UNITS:var ca=action.cachedArray;if(ca&&ca.id==this.id&&this.useClientSideManipulations&&this.template){var al=ca.list;if(al&&al.length){if(mode=="undo"){al.reverse();}for(var i=0,cnt=al.length;i<cnt;i++){al[i].args=al[i].oldArgs;this.template[mode](al[i]);}if(mode=="undo"){al.reverse();}this.onresize();}}break;}return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrGridReport.prototype.redoundo=function(s,action){try{return this.commonRedoUndoCode(action,s);}catch(err){microstrategy.errors.log(err);return false;}};mstrGridReport.prototype.onredo=function(action){this.redoundo("redo",action);};mstrGridReport.prototype.onundo=function(action){this.redoundo("undo",action);};mstrGridReport.prototype.ondrop=function(area,selections){try{var items=selections.getItems();var pointsTo=area.getAttribute(microstrategy.HTMLATTR_POINTS_TO);if(this.dragSource&&pointsTo!=null){var um=this.um;var ac=[];var gsi=this.gridStructureInfo;var toAxis=toDepth=toSubDepth=1;if(!gsi.emptyCase&&pointsTo!=this.id){var toArgs=pointsTo.split(",");if(toArgs.length<2){return null;}toAxis=parseInt(toArgs[0]);toDepth=parseInt(toArgs[1]);toSubDepth=parseInt(toArgs[2]);if(isNaN(toSubDepth)){toSubDepth=1;}}if(this.dragSource.type==microstrategy.OBJTYPE_OBJBROWSER){var isMultipleItems=selections.isMulti();var isOnlyMetrics=(isMultipleItems)?selections.isOnlyMetrics():true;var metricUnitPivot=false;var metricInsertPoint=gsi.metricAxis.size()+1;for(var i=items.length-1;i>=0;i--){var subType=items[i].getAttribute(microstrategy.HTMLATTR_DSS_TYPE);var type=items[i].getAttribute(microstrategy.HTMLATTR_OBJTYPE);if(type==microstrategy.OBJTYPE_ELEMENT){continue;}if(subType==microstrategy.DSSTYPE_TEMPLATE&&pointsTo==this.id){ac=this.replaceTemplate(items[i],true,ac);continue;}if(isMultipleItems&&!isOnlyMetrics&&gsi.hasMetrics&&(mstrGridReport.isMetric(subType))){if(!gsi.findUnit(items[i].getAttribute(microstrategy.HTMLATTR_DSS_ID))){ac=this.addUnit(items[i],microstrategy.GRIDCELL_AXIS_METRICS,metricInsertPoint,1,ac);}}else{var newDepth=toDepth;var newSubDepth=toSubDepth;var objDssId=(subType==microstrategy.DSSTYPE_ATTRIBUTE_FORM)?items[i].getAttribute(microstrategy.HTMLATTR_ATTRIBUTE_ID):items[i].getAttribute(microstrategy.HTMLATTR_DSS_ID);if(toSubDepth>1){if(subType!=microstrategy.DSSTYPE_ATTRIBUTE_FORM){newDepth++;newSubDepth=1;}else{var targetUnit=gsi.getUnit(toAxis,toDepth,1);if(targetUnit!=null){if(objDssId!=targetUnit.parentDssId){newDepth++;newSubDepth=1;}else{if(this.showAttForms){var attributeUnit=gsi.findUnit(objDssId);if(attributeUnit!=null&&attributeUnit.hasAttForms()){var formUnit=attributeUnit.getSubUnit(items[i].getAttribute(microstrategy.HTMLATTR_DSS_ID));if(formUnit!=null&&formUnit.subDepth<newSubDepth){newSubDepth--;}}}}}}}var existingUnit=gsi.findUnit(objDssId);if(existingUnit!=null){if(existingUnit.axis==toAxis&&existingUnit.depth<newDepth){if(newSubDepth>1){newSubDepth=1;}else{newDepth--;}}}if(mstrGridReport.isMetric(subType)){if(gsi.hasMetrics){if(toAxis!=microstrategy.GRIDCELL_AXIS_METRICS){if(!metricUnitPivot&&(toAxis!=gsi.metricsAxis||newDepth!=gsi.metricsDepth)){var unit=gsi.getUnit(gsi.metricsAxis,gsi.metricsDepth,1);if(unit){var aclen=ac.length;ac=this.pivotUnit(unit,toAxis,newDepth,1,ac);var objInfo=gsi.buildGridUnitInfo(items[i],toAxis,newDepth,newSubDepth);if(mstrGridReport.isRWD()&&objInfo.dssSetId!=gsi.dataSetId&&ac.length>aclen){ac=this.changeGridDataSource(objInfo.dssSetId,ac);}metricInsertPoint=newDepth;}metricUnitPivot=true;}if(gsi.findUnit(items[i].getAttribute(microstrategy.HTMLATTR_DSS_ID))==null){ac=this.addUnit(items[i],microstrategy.GRIDCELL_AXIS_METRICS,metricInsertPoint,1,ac);}}else{ac=this.addUnit(items[i],microstrategy.GRIDCELL_AXIS_METRICS,newDepth,1,ac);}}else{if(isMultipleItems&&!isOnlyMetrics&&toAxis!=microstrategy.GRIDCELL_AXIS_COLUMNS){ac=this.addUnit(items[i],microstrategy.GRIDCELL_AXIS_COLUMNS,gsi.colAxis.size()+1,1,ac);}else{ac=this.addUnit(items[i],toAxis,newDepth,newSubDepth,ac);}}}else{ac=this.addUnit(items[i],toAxis,newDepth,newSubDepth,ac);}}}}else{if(this.dragSource==this||this.dragSource.type==microstrategy.OBJTYPE_PAGE_BY||this.dragSource.type==microstrategy.OBJTYPE_GRAPH_ZONES){var objInfoList=this.getObjInfoList(items);if(objInfoList.length==1){var oi=objInfoList[0];var pivotArgs=this.computeDepthsForPivot(oi,toAxis,toDepth,toSubDepth);ac=this.pivotUnit(oi,toAxis,pivotArgs.depth,pivotArgs.subDepth,ac);}else{ac=this.pivotUnits(objInfoList,toAxis,toDepth,toSubDepth,ac,true);}}}if(ac.length>0){um.add(ac);if(this.selections){this.selections.clearAll(true);}if(this.flush){um.flushAndSubmitChanges();this.flush=false;}else{if(this.useClientSideManipulations){microstrategy.eventManager.notifyOrphanBones("ongridstructurechange",gsi);}else{if(this.dragSource&&this.dragSource.type==microstrategy.OBJTYPE_GRAPH_ZONES){togglePulldowns(this.dragSource.elem,true);}um.flushAndSubmitChanges();}}}}return false;}catch(err){microstrategy.errors.log(err);return false;}};mstrGridReport.prototype.computeDepthsForPivot=function(objInfo,toAxis,toDepth,toSubDepth){var __result={depth:toDepth,subDepth:toSubDepth};var newDepth=toDepth;var newSubDepth=toSubDepth;if(toSubDepth>1){if(objInfo.dssType==microstrategy.DSSTYPE_ATTRIBUTE_FORM&&this.showAttForms&&objInfo.axis==toAxis&&objInfo.depth==newDepth&&objInfo.subDepth<newSubDepth){newSubDepth--;}else{newDepth++;newSubDepth=1;}}if(objInfo.axis==toAxis&&objInfo.depth<newDepth){if(newSubDepth>1){newSubDepth=1;}else{newDepth--;}}var maxAxisPosition=this.gridStructureInfo.getMaxAxisPosition(toAxis);if(newDepth>maxAxisPosition||newDepth==-1){newDepth=maxAxisPosition;}__result.depth=newDepth;__result.subDepth=newSubDepth;return __result;};mstrGridReport.prototype.sortByAxisDepth=function(a,b){try{var sc=this.gridStructureInfo;var m=sc.getGridUnitInfo(a);var n=sc.getGridUnitInfo(b);var x=(m.subtype==microstrategy.OBJTYPE_METRIC)?sc.metricsAxis:m.axis;var y=(n.subtype==microstrategy.OBJTYPE_METRIC)?sc.metricsAxis:n.axis;if(x==y){return this.sortByDepth(m,n);}return((x<y)?-1:((x>y)?1:0));}catch(err){microstrategy.errors.log(err);return null;}};mstrGridReport.prototype.sortByDepth=function(a,b){try{var x=a.depth;var y=b.depth;return((x<y)?-1:((x>y)?1:0));}catch(err){microstrategy.errors.log(err);return null;}};mstrGridReport.prototype.pivotUnits=function(objInfoList,toAxis,toDepth,toSubDepth,ac,computeDepths){try{var multipleSrcAxisPos="";var um=this.um;var updateNow=mstrGridReport.updateNow();var numAttForms=0;var gsi=this.gridStructureInfo;var mxap=gsi.getMaxAxisPosition(toAxis);if(toDepth==-1){toDepth=mxap;}for(var k=0;k<objInfoList.length;k++){multipleSrcAxisPos+=this.buildPivotingSrc(objInfoList[k]);if(objInfoList[k].dssType==microstrategy.DSSTYPE_ATTRIBUTE_FORM){numAttForms++;}}if(multipleSrcAxisPos.length>0){var pivotDepths={depth:toDepth,subDepth:toSubDepth};if(computeDepths){pivotDepths=this.computeDepthsForPivot(objInfoList[0],toAxis,toDepth,toSubDepth);}var eventArgDepth=pivotDepths.depth;var eventArgAxis=toAxis;if(eventArgDepth==toDepth&&pivotDepths.subDepth>1){if(numAttForms==objInfoList.length){eventArgAxis=0;eventArgDepth=pivotDepths.subDepth;}}var cachedArray=null;if(updateNow==mstrUpdateManager.UPDATE_LATER){var tempAc=[];var cachedArray={id:this.id,list:tempAc};var that=this;var fn=function(i){var oi=objInfoList[i];tempAc=that.pivotUnit(oi,toAxis,pivotDepths.depth,pivotDepths.subDepth,tempAc);};if(this.pivotClientSideInReverseOrder(objInfoList,eventArgAxis,eventArgDepth,toSubDepth)){for(i=objInfoList.length-1;i>=0;--i){fn(i);}}else{for(i=0;i<objInfoList.length;++i){fn(i);}}cachedArray.list=tempAc;}ac.push(um.createActionObject(null,mstrUpdateManager.PIVOT_MULTIPLE_UNITS,this.beanPath,["4110","4213","4008","4009"],[updateNow,multipleSrcAxisPos,eventArgAxis,eventArgDepth],null,cachedArray));}return ac;}catch(err){microstrategy.errors.log(err);return null;}};mstrGridReport.prototype.pivotClientSideInReverseOrder=function(objInfoList,toAxis,toDepth,toSubDepth){if(objInfoList&&objInfoList.length){var oi=objInfoList[0];switch(oi.dssType){case microstrategy.DSSTYPE_METRIC:case microstrategy.DSSTYPE_USER_METRIC:case microstrategy.DSSTYPE_USER_SUMMARY_METRIC:case microstrategy.DSSTYPE_ATTRIBUTE_FORM:if(oi.depth<toDepth){return false;}break;case microstrategy.DSSTYPE_ATTRIBUTE:if(oi.axis==toAxis&&oi.depth<toDepth){return false;}break;default:return true;}}return true;};mstrGridReport.prototype.buildPivotingSrc=function(objInfo){try{var APS=",";var t=objInfo.dssType;var p=null;if(objInfo.subtype==microstrategy.SUBOBJTYPE_METRIC){p=objInfo.depth;}else{if(objInfo.subtype==microstrategy.SUBOBJTYPE_ATTRIBUTE_FORM){p=objInfo.parentDssId+APS+objInfo.attFormId;}else{t=objInfo.isMetricTemplateUnit?"-1":objInfo.dssType;p=objInfo.axis+APS+objInfo.depth;}}return t+APS+p+"!";}catch(err){microstrategy.errors.log(err);return null;}};mstrGridReport.prototype.buildDeletingFromReportSrc=function(objInfo){try{var APS=",";var t=objInfo.dssType;var p=null;if(objInfo.subtype==microstrategy.SUBOBJTYPE_ATTRIBUTE_FORM){p=objInfo.parentDssId+APS+objInfo.attFormId;}else{t=objInfo.isMetricTemplateUnit?"-1":objInfo.dssType;p=objInfo.dssId;}return t+APS+p+"!";}catch(err){microstrategy.errors.log(err);return null;}};mstrGridReport.prototype.onmouseover=function(e){try{e=e||window.event;var src=getEventTarget(e);var nodeName=src&&src.nodeName&&src.nodeName.toLowerCase();if(!nodeName){return ;}if((nodeName!="td")){src=microstrategy.findParentWithTag(src,"td");}var ui=this.gridStructureInfo&&this.gridStructureInfo.getGridCellProps(src);if(src&&!src.getAttribute("title")){if(ui&&ui.getCellTooltip()){src.setAttribute("title",ui.getCellTooltip());}}if(this.quickSearchEnabled&&src){var tr=microstrategy.findParentWithTag(src,"tr");if(tr.getAttribute(microstrategy.HTMLATTR_GRIDROW_ORDINAL)){this.hideQuickSearchIcon();return ;}else{this.showQuickSearchIcon(src);}}mstrGridStatic.prototype.onmouseover.apply(this,arguments);}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.onmouseout=function(e){try{this.hideQuickSearchIcon();this.hideToolbarOnMouseOut();}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.hideQuickSearchIcon=function(e){try{var qsIcon=this.qsPopupIcon;if(qsIcon){qsIcon.style.display="none";}}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.canShowQuickSearchIcon=function(elCell){try{var qsp=this.quickSearch&&this.quickSearch.searchBoxPopup;if(qsp&&qsp.modal){return false;}var tr=microstrategy.findParentWithTag(elCell,"tr");if(tr.getAttribute(microstrategy.HTMLATTR_GRIDROW_ORDINAL)){return false;}var dpt=elCell.getAttribute(microstrategy.HTMLATTR_GRIDCELL_DEPTH),ax=elCell.getAttribute(microstrategy.HTMLATTR_GRIDCELL_AXIS),upt=elCell.getAttribute(microstrategy.HTMLATTR_GRID_UNIT_POS),or=elCell.getAttribute(microstrategy.HTMLATTR_ORIENTATION),sty=elCell.getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE);this.qsDepthInfo={};this.qsCssName="row";if(or==microstrategy.GRIDCELL_ORIENTATION_VERTICAL){this.qsCssName=sty==microstrategy.SUBOBJTYPE_ATTRIBUTE?"row":"metric";}else{if(or==microstrategy.GRIDCELL_ORIENTATION_HORIZONTAL&&sty==microstrategy.SUBOBJTYPE_ATTRIBUTE){this.qsCssName="col";}}if(upt){if(or==microstrategy.GRIDCELL_ORIENTATION_VERTICAL&&sty==microstrategy.SUBOBJTYPE_METRIC){ax=microstrategy.GRIDCELL_AXIS_METRICS;this.qsDepthInfo.upt=upt;}else{var c=elCell.previousSibling;while(c&&c.tagName&&c.tagName.toLowerCase()=="td"){dpt=c.getAttribute(microstrategy.HTMLATTR_GRIDCELL_DEPTH);ax=c.getAttribute(microstrategy.HTMLATTR_GRIDCELL_AXIS);or=c.getAttribute(microstrategy.HTMLATTR_ORIENTATION)==microstrategy.GRIDCELL_ORIENTATION_HORIZONTAL;if(ax&&dpt&&or){break;}c=c.previousSibling;}}}if(ax&&dpt){this.qsDepthInfo.axis=ax;this.qsDepthInfo.depth=parseInt(dpt)+1;return true;}return false;}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.showQuickSearchIcon=function(elCell){try{if(!this.canShowQuickSearchIcon(elCell)){return ;}var qsIconId="mstrQSIcon",h=w=20;var qsIcon=this.qsPopupIcon;if(!qsIcon){var bid=this.id;var div=document.createElement("div");div.id=qsIconId;div.onclick=function(){microstrategy.bone(bid).showQuickSearchPopup();};div.onmouseover=function(){this.style.display="block";};div.onmouseout=function(){this.style.display="none";};var divAxisIcon=document.createElement("div");divAxisIcon.className="mstrQSIcon-axis";div.appendChild(divAxisIcon);var divLine=document.createElement("div");divLine.className="mstrQSIcon-line";div.appendChild(divLine);document.body.appendChild(div);this.qsPopupIcon=qsIcon=div;}var BM=mstr.utils.BoxModel,pos=BM.position(elCell),s=qsIcon.style;s.display="block";s.left=Math.min(BM.getBrowserWindowWidth(document)-w,pos.left+elCell.offsetWidth)-w+"px";s.top=pos.top-h+"px";qsIcon.className=this.qsCssName;qsIcon.lastChild.style.top=(this.qsCssName=="col"&&this.qsDepthInfo.axis==2)?h+elCell.offsetHeight+"px":"";}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.showQuickSearchPopup=function(){try{var me=this,openQSPopup=function(){var qs=(me.quickSearch=mstrGridReport.fnGetQuickSearchWidget());var di=me.qsDepthInfo;qs.axis=di.axis;qs.depth=di.depth;qs.openPlaceholderPopup(mstr.utils.BoxModel.position(me.qsPopupIcon,true));};microstrategy.mojoLoader.loadWidget({bundle:"mojo-ros.js",callback:openQSPopup});}catch(err){microstrategy.errors.log(err);}return false;};mstrGridReport.prototype.onclick=function(e){return null;};mstrGridReport.prototype.onmousedown=function(e){try{microstrategy.hidePopups();if(this.gridStructureInfo.isEmptyTemplate||!this.isGrid){return null;}e=e||window.event;var cellSrc=getEventTarget(e);var nodeName=cellSrc.nodeName.toLowerCase();if(nodeName=="select"&&cellSrc.name=="WBV"){return null;}if((nodeName!="td")&&e.button==2){cellSrc=microstrategy.findParentWithTag(cellSrc,"td");}var tdSrc=cellSrc;if((tdSrc.nodeName.toLowerCase()!="td")){tdSrc=microstrategy.findParentWithTag(tdSrc,"td");}var orgCx=tdSrc.getAttribute("cx");var orgD1=tdSrc.getAttribute("D1");var orgCtm=tdSrc.getAttribute("ctm");if(tdSrc.getAttribute(microstrategy.HTMLATTR_GRIDCELL_ID)&&(!orgCx||!orgD1||!orgCtm)){var unitInfo=this.gridStructureInfo.getGridCellProps(tdSrc);if(unitInfo){if(!orgCx&&unitInfo.getCellCx()){tdSrc.setAttribute("cx",unitInfo.getCellCx());}if(!orgD1&&tdSrc.getAttribute(microstrategy.HTMLATTR_GRIDCELL_ORDINAL)){tdSrc.setAttribute("D1",unitInfo.getCellDrillElement(tdSrc));}if(!orgCtm&&unitInfo.getAttColTitleMissing()){tdSrc.setAttribute("ctm","1");tdSrc.setAttribute("AX","2");tdSrc.setAttribute("DPT",String(unitInfo.depth));tdSrc.setAttribute("STY",microstrategy.SUBOBJTYPE_ATTRIBUTE);var unit=this.gridStructureInfo.getUnit(2,unitInfo.depth);var attrDssId=unit&&unit.dssId;if(attrDssId){tdSrc.setAttribute(microstrategy.HTMLATTR_DSS_ID,attrDssId);}}}}if(nodeName.toLowerCase()=="a"){var td=microstrategy.findParentWithTag(cellSrc,"td");var DssXmlBaseFormHTMLTag=7;if(td.getAttribute("ts")==DssXmlBaseFormHTMLTag){cellSrc.href=microstrategy.addCSRFTokenToURL(cellSrc.href);}}if(e.button==2){this.processRightMouseClick(e,cellSrc);}var _result=null;if(e.button!=2){_result=this.processMousedown(e,cellSrc);if(_result!=null){return _result;}return this.postmousedown(e,cellSrc);}else{return true;}}catch(err){microstrategy.errors.log(err);return false;}};mstrGridReport.prototype.processRightMouseClick=function(e,cellSrc){try{e.cancelBubble=true;var isCellSrcSelected=(cellSrc!=null&&this.selections)?this.selections.isCellSelected(cellSrc):false;if(!isCellSrcSelected&&this.selections!=null){this.selections.addToSelections(e,cellSrc);}}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.processMousedown=function(e,cellSrc){try{var src=findTarget(cellSrc,microstrategy.HTMLATTR_SUBOBJTYPE);if(src){getMouse(e);this.x=lMouseX;this.y=lMouseY;this.activeElement=src;var subtype=this.activeElement.getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE);e.cancelBubble=true;switch(subtype){case microstrategy.SUBOBJTYPE_RESIZE_VLINE:this.bindingEvents(this,{mousemove:{s:"onresizestart"},mouseup:{s:"onmouseup"}});return false;case microstrategy.SUBOBJTYPE_BTN:if(getButtonId(e)==1){var cmdId=src.getAttribute("id");var item=findTarget(src.parentNode,microstrategy.HTMLATTR_SUBOBJTYPE);if(cmdId&&item){return this.processPivotButtons(item,cmdId);}}break;case microstrategy.SUBOBJTYPE_OUTLINE_MODE_IMG:var depth=src.getAttribute("dpt");var rowCount=src.getAttribute("rcnt");var isTotal=src.getAttribute("ist");if(this.outlineMode){this.outlineMode.showHideRows(this.id,parseInt(depth),parseInt(rowCount),isTotal);}return true;case microstrategy.SUBOBJTYPE_RA_BTN:this.raOutlineModeImpl=new mstrRaOutlineModeImpl(0,this.gridTable.rows.length-1,this);this.raOutlineModeImpl.showHideRows(src);return true;case microstrategy.SUBOBJTYPE_ATTRIBUTE:case microstrategy.SUBOBJTYPE_ATTRIBUTE_FORM:case microstrategy.SUBOBJTYPE_METRIC:stopEventBubbling(e);var isDrag=src.getAttribute("dg");if(isDrag&&isDrag.toLowerCase()=="true"&&this.isFeatureAvailable(microstrategy.FEATURE_EMBEDDED_TEMPLATE_NODE)){this.bindingEvents(this,{mousemove:{s:"ondragstart"},mouseup:{s:"ondragcancel"}});}break;}}if(cellSrc&&this.selections!=null&&cellSrc.nodeName.toLowerCase()=="td"){this.selections.addToSelections(e,cellSrc);}return null;}catch(err){microstrategy.errors.log(err);return null;}};mstrGridReport.prototype.postmousedown=function(e,cellSrc){try{stopEventBubbling(e);return false;}catch(err){microstrategy.errors.log(err);return null;}};mstrGridReport.prototype.onresizestart=function(e){try{this.detachWinListener(this,"mousemove");this.saveEnabled=true;this.isSaveBeforeDocCreate=true;this.notifySelectionChange("ongridselectionschange");return this.colWidths.onresizestart(e);}catch(err){microstrategy.errors.log(err);return null;}};mstrGridReport.prototype.createDrillActions=function(valueDrillKey,retainParent,retainThreshold,valueDrillElementList,valueDisplayMode,isWithin){try{var ids=["4034","4134","4035","4212"];var values=[valueDrillKey,retainParent,retainThreshold,valueDrillElementList,valueDisplayMode];if(!this.oldFormatDrillPathImportance){ids=["4178"].concat(ids);}else{ids=["4033","4124"].concat(ids);values.splice(1,0,this.oldFormatDrillPathImportance);}if(isWithin&&this.sliceID){ids.push("4254");values.push(this.sliceID);}return this.um.createActionObject(this.elem,mstrUpdateManager.GRID_DRILL,this.beanPath,ids,values,[]);}catch(err){microstrategy.errors.log(err);return null;}};mstrGridReport.prototype.showAdvDrillEditor=function(valueDrillAxis,valueDrillPosition,isIFrameEnabled){this.um.useIframe=isIFrameEnabled?true:false;this.addAction(null,mstrUpdateManager.OPEN_ADV_DRILL_EDITOR,this.beanPath,["6011","6012","6010","6031"],[valueDrillAxis,valueDrillPosition,1,"drillEditor"]);};mstrGridReport.prototype.drill=function(valueDrillKey,valueDisplayMode,valueDrillElementList,isWithin){try{var retainParent="";if(this.drillRetainParentValue!="3"){retainParent=this.drillRetainParentValue;}var retainThreshold="";if(this.drillKeepThreshValue!="3"){retainThreshold=this.drillKeepThreshValue;}var s=this.commands.queryState("selectedDrillElements");if(valueDrillElementList==null){valueDrillElementList=s;}else{if(s&&(!this.isReportMdxCube())){valueDrillElementList=valueDrillElementList+","+s;}}var action=this.createDrillActions(valueDrillKey,retainParent,retainThreshold,valueDrillElementList,valueDisplayMode,isWithin);if(this.drillOpenInNewWindow&&!(parseInt(isWithin))){this.um.newWindow=true;}this.um.useIframe=this.drillIframeEnabled;this.commands.exec("clearAllGridSelections");if(action){this.um.add([action]);this.um.flushAndSubmitChanges();this.um.acknowledgeRequest();}}catch(err){microstrategy.errors.log(err);}return false;};mstrGridReport.createDragDisplay=function(){var node=document.createElement("span");node.className="mstrDnDReportDragItem";node.appendChild(document.createTextNode(""));return document.body.appendChild(node);};mstrGridReport.prototype.initializeDragDisplay=function(){try{this.dragDisplay=this.dragDisplay||mstrGridReport.createDragDisplay();}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.ondragstart=function(e){try{e=this.initEvent(e,true);var s=this.selections;var x=Math.abs(lMouseX-this.x);var y=Math.abs(lMouseY-this.y);if(x>3||y>3){var cellSrc=getEventTarget(e);var isCellSrcSelected=(cellSrc!=null&&s)?s.isCellSelected(cellSrc):false;if(!isCellSrcSelected){s.addToSelections(e,cellSrc);}var tempCells=(s!=null)?s.getSelectedCellsWithAttr("dg","true"):new Array;if(s.isEmpty()||tempCells==null||tempCells.length<1){s.clearAll(true);}if(!s.isCellSelected(this.activeElement)){s.add(this.activeElement);tempCells.push(this.activeElement);}tempCells.sort(new Function("a","b","return microstrategy.bone('"+this.id+"').sortByAxisDepth(a,b);"));var unitTypes=new Array;this.dragItems=new Array;var desc="";var j=0;for(var i in tempCells){var obj=tempCells[i];this.dragItems[j]=obj;unitTypes[j++]=(obj.getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==microstrategy.SUBOBJTYPE_METRIC)?microstrategy.DSSTYPE_METRIC:microstrategy.DSSTYPE_ATTRIBUTE;desc+=obj.getAttribute(microstrategy.HTMLATTR_DESCRIPTION)+",";}this.initializeDragDisplay();this.dragDisplay.replaceChild(document.createTextNode(desc.substring(0,desc.length-1)),this.dragDisplay.firstChild);this.initMapper();s.clearAll();for(i in this.dragItems){s.add(this.dragItems[i]);}s.clearDeferredSrc();microstrategy.eventManager.onnotifydrag(this.dragItems,this,unitTypes);this.bindingEvents(this,{mousemove:{s:"ondrag"},mouseup:{s:"ondragend"}});this.ondrag(e);}}catch(err){microstrategy.errors.log(err);}return false;};mstrGridReport.prototype.ondrag=function(e){try{e=this.initEvent(e,true);if(lMouseX>Math.max(document.documentElement.scrollWidth,document.body.scrollWidth)-25){return ;}moveObjTo(this.dragDisplay,lMouseX-getObjWidth(this.dragDisplay)-microstrategy.CURSOR_OFFSET,lMouseY-getObjHeight(this.dragDisplay)-microstrategy.CURSOR_OFFSET);this.dndHelper.moveHelperImage(e);microstrategy.scrollPageHorizontally(lMouseX);}catch(err){microstrategy.errors.log(err);}return false;};mstrGridReport.prototype.ondragend=function(e){try{e=this.initEvent(e);microstrategy.eventManager.notifyOrphanBones("onnotifydragend");this.onmouseup(e);this.dndHelper.parkObject(this.dragDisplay);var src=microstrategy.findAncestor(getEventTarget(e));if(src){var bone=microstrategy.boneForMask(src);if(bone&&bone.ondrop){if(bone.id=="UniqueReportID"&&src.tagName.toLowerCase()!="area"&&!bone.isGraph){return ;}bone.ondrop(src,this.selections);if(this.selections){this.selections.clearAll(true);}if(this.useClientSideManipulations){microstrategy.eventManager.notifyOrphanBones("ongridstructurechange",this.gridStructureInfo);}}}}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.ondragcancel=function(e){try{e=this.initEvent(e,true);this.onmouseup(e);}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.onmouseup=function(e,path){try{if(e&&e.e){e=e.e;}this.activeElement=null;if(this.dndHelper){this.dndHelper.onmouseup((path)?path:this.id);}if(!this.isDropZoneEditor&&this.selections){this.selections.onmouseup(e);}}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.shouldInitMask=function(){try{return(this.useDNDMapping);}catch(err){microstrategy.errors.log(err);return null;}};mstrGridReport.prototype.initMask=function(){try{this.mask=new mstrMaskMappedImpl(function(d){try{d=d||{};var tBody=this.maskedBone&&this.maskedBone.elem.getElementsByTagName("tbody")[0];if(tBody!=null&&tBody.rows!=null){d.height=parseInt(tBody.offsetHeight);d.width=parseInt(tBody.offsetWidth);}return d;}catch(err){microstrategy.errors.log(err);}});}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.initSelections=function(restoreState){try{if(this.isGrid){var s=this.selections=new mstrGridSelectionsImpl();s.parentBone=this;s.path="microstrategy.bone('"+this.id+"').selections";s.onload();if(restoreState&&this.gridSelections&&!(microstrategy.EXECUTION_SCOPE==microstrategy.REPORT_EXECUTION&&microstrategy.DISPLAY_MODE==microstrategy.DESIGN_MODE)){var gs=eval("("+this.gridSelections+")");if(gs&&gs.src==true){this.setGridUnitSelections(gs.unit,gs.value);}else{s.repopulateSelections();}}}}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.getExecTarget=function(){try{return microstrategy;}catch(err){microstrategy.errors.log(err);return null;}};mstrGridReport.prototype.exec=function(cmdId,cmdValue,holdFlush){try{var toReturn=false;var targetBone=this.getExecTarget();if(targetBone!=null){var properties;if(typeof (cmdValue)=="string"||typeof (cmdValue)=="number"){if(cmdId=="lncolor"){properties=["borderTopColor",cmdValue];}else{properties=targetBone.setSingleFormat(cmdId,cmdValue);}}else{if(cmdValue!=null){properties=new Array(2);if(cmdId=="lncolor"){properties[0]="borderTopColor";}properties[1]=cmdValue[1];}else{return(toReturn=false);}}var um=this.um;cmdId=properties[0];cmdValue=properties[1];if(cmdId&&cmdValue){var eventId=null;if(this.isGraph){var params=null;var args=[];var argumentValues=[];argumentValues.push(cmdValue);switch(cmdId){case"changeChartWindow_horizontal":case"changeChartWindow_vertical":params=cmdValue.split("|");var v=(cmdId=="changeChartWindow_vertical")?"series":"categories";this.changeChartWindow(um,v,params[0],params[1]);um.flushAndSubmitChanges();toReturn=true;break;default:}if(args.length>0&&eventId!=null){um.add([um.createActionObject(this.elem,eventId,this.beanPath,args,argumentValues,[],[])]);if(!this.useClientSideManipulations&&!holdFlush){um.flushAndSubmitChanges();}toReturn=true;}}if(this.isGrid&&!toReturn){var format=mstrFormatObject;if((cmdId!="backgroundColor"&&cmdId!="Gradient")||cmdValue.indexOf(",")<0||cmdValue.indexOf("rgb")>=0){cmdValue=format.encodeValue(cmdId,cmdValue);}var argumentId=null;var argumentValue=cmdValue;var argumentId2=null;var argumentValue2=null;var gradientValues=null;eventId=null;if(cmdId=="Gradient"){cmdId="backgroundColor";}var command=format[cmdId];if(command!=null){command=command[0];switch(command){case"FormattingFont":eventId=mstrUpdateManager.SAVE_GRID_FONT_PROPERTIES;argumentId={fontFamily:"4042",fontSize:"4045",color:"4048"}[cmdId];break;case"FormattingAlignment":eventId=mstrUpdateManager.SAVE_GRID_ALIGNMENT_PROPERTIES;switch(cmdId){case"textAlign":argumentValue=this.adjustTextAlignValueForGrid(argumentValue);argumentId="4056";break;}break;case"FormattingBorder":eventId=mstrUpdateManager.SAVE_GRID_BORDER_PROPERTIES;switch(cmdId){case"borderTopColor":case"borderLeftColor":case"borderRightColor":case"borderBottomColor":var selections=this.selections.getSelectedGridTargetGridLevel();for(var i in selections){var temps=selections[i].split(",");var axis=temps[0];var position=temps[1];var unit=temps[2];var level=temps[3];if(this.isTargetUnitLevelValid(unit,level)){um.add([um.createActionObject(this.elem,eventId,this.beanPath,["4006","4007","4109","4108","4067","4068","4069","4070","4223","4126"],[axis,position,level,unit,argumentValue,argumentValue,argumentValue,argumentValue,"0",this.styleName],[],[])]);}}if(!this.useClientSideManipulations&&!holdFlush){um.flushAndSubmitChanges();}toReturn=true;break;}break;case"FormattingPatterns":eventId=mstrUpdateManager.SAVE_GRID_PATTERN_PROPERTIES;break;default:}}var selectedUnits=this.selections.getSelectedGridTargetGridLevel();if(selectedUnits.length==0){this.setGridUnitSelections(this.gridUnitFormat,this.gridValueFormat);selectedUnits=this.selections.getSelectedGridTargetGridLevel();}for(i in selectedUnits){temps=selectedUnits[i].split(",");axis=temps[0];position=temps[1];unit=temps[2];level=temps[3];if(argumentId!=null&&eventId!=null){var action=um.createActionObject(this.elem,eventId,this.beanPath,["4006","4007","4109","4108",argumentId,"4126",argumentId2],[axis,position,level,unit,argumentValue,this.styleName,argumentValue2],[],[]);if(!(argumentId2&&argumentValue2&&gradientValues&&gradientValues.length>0)){um.add([action]);}toReturn=true;}}if(!this.useClientSideManipulations&&!holdFlush){um.flushAndSubmitChanges();}}}}}catch(err){microstrategy.errors.log(err);toReturn=false;}return toReturn;};mstrGridReport.prototype.changeChartWindow=function(um,cmdId,start,end){var windowSize=(end-start+1)<1?1:end-start+1;var gridStart=(this.isGrid&&this.isGraph)?start:"";var gridWindow=(this.isGrid&&this.isGraph)?windowSize:"";if(this.seriesLayout!="1"){cmdId=(cmdId=="categories")?"series":"categories";}var args=(cmdId=="categories")?["4018","4020","4022","4024"]:["4019","4021","4023","4025"];um.add([um.createActionObject(this.elem,mstrUpdateManager.SET_RESULT_WINDOW,this.beanPath,args,[gridStart,gridWindow,start,windowSize])]);};mstrGridReport.prototype.isTargetUnitLevelValid=function(unit,level){try{var isMetric=(unit==2)||(unit==6);var isSubtotalsLevel=(level==3)||(level==4);return(!isMetric||!isSubtotalsLevel);}catch(err){microstrategy.errors.log(err);return false;}};mstrGridReport.prototype.adjustTextAlignValueForGrid=function(av){return{0:"2",1:"4",2:"3"}[av]||av;};mstrGridReport.prototype.getDNDHelperImage=function(bone,pointsTo){if(!pointsTo){return null;}if(bone.type!=this.type||bone.id==this.id){var arrPointsTo=pointsTo.split(",");if(!isNaN(arrPointsTo[0])){var axis=parseInt(arrPointsTo[0]);var fn=microstrategy.FOLDER_IMAGES;if(axis==microstrategy.GRIDCELL_AXIS_ROWS){fn+="dRows.gif";}else{if(axis==microstrategy.GRIDCELL_AXIS_COLUMNS){fn+="dcols.gif";}else{if(axis==microstrategy.GRIDCELL_AXIS_METRICS){fn+="dMetrics.gif";}}}return fn;}}return null;};mstrGridReport.prototype.isRemoveFromGrid=function(featureId){try{return(featureId)?this.isFeatureAvailable(featureId):false;}catch(err){microstrategy.errors.log(err);return null;}};mstrGridReport.prototype.deleteItems=function(items){try{if(this.selections){this.selections.clearAll(true);}var um=microstrategy.updateManager;var ac=[];var isRemoveFromGrid=this.isRemoveFromGrid(microstrategy.FEATURE_WEB_REMOVE_FROM_GRID);var b=(items.length==1);ac=this[(b)?"deleteItemSrc":"deleteMultiItemSrc"](((b)?items[0]:items),ac,!isRemoveFromGrid);if(ac.length>0){um.add(ac);if(!this.useClientSideManipulations){if(this.dragSource&&this.dragSource.type==microstrategy.OBJTYPE_GRAPH_ZONES){togglePulldowns(this.dragSource.elem,true);}um.flushAndSubmitChanges();}}return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrGridReport.prototype.processPivotButtons=function(item,cmdId){try{var um=microstrategy.updateManager;if(!um){return false;}var ac=[];if(cmdId=="x"){ac=this.deleteItemSrc(item,ac);}else{if(cmdId=="xx"){if(this.useClientSideManipulations){microstrategy.eventManager.notifyOrphanBones("onunitremoved",this.gridStructureInfo.buildGridUnitInfo(item));}ac=this.deleteItemSrc(item,ac,true);}else{var objInfo=this.gridStructureInfo.getGridUnitInfo(item);var axis=objInfo.axis;var depth=objInfo.depth;var subDepth=objInfo.subDepth;if(cmdId=="c"){axis=(axis==microstrategy.GRIDCELL_AXIS_ROWS)?microstrategy.GRIDCELL_AXIS_COLUMNS:microstrategy.GRIDCELL_AXIS_ROWS;ac=this.pivotUnit(objInfo,axis,1,1,ac);}else{if(cmdId=="p"){ac=this.pivotUnit(objInfo,microstrategy.GRIDCELL_AXIS_PAGE_BY,-1,1,ac);}else{if(objInfo.dssType==microstrategy.DSSTYPE_ATTRIBUTE_FORM){if(this.isFeatureAvailable(microstrategy.FEATURE_SET_ATTRIBUTEFORM_DISPLAY)&&this.showAttForms){if(cmdId=="l"||cmdId=="u"){(subDepth==1)?depth--:subDepth--;}else{var attUnit=this.gridStructureInfo.findUnit(objInfo.parentDssId);(subDepth==attUnit.attForms.size())?depth++:subDepth++;}}else{subDepth=1;(cmdId=="l"||cmdId=="u")?depth--:depth++;}}else{objInfo=this.gridStructureInfo.getGridUnitInfoBySrc(item);var index=objInfo?objInfo.index:-1;axis=objInfo.axis;depth=objInfo.depth;subDepth=objInfo.subDepth;if(index>-1){(cmdId=="l"||cmdId=="u")?index--:index++;var u=this.gridStructureInfo.allAxes[(axis==microstrategy.GRIDCELL_AXIS_METRICS)?0:axis].units[index];depth=u?u.depth:objInfo.depth;}else{(cmdId=="l"||cmdId=="u")?depth--:depth++;}}ac=this.pivotUnit(objInfo,axis,depth,subDepth,ac);}}}}if(ac.length>0){um.add(ac);this.selections.clearAll(true);if(this.useClientSideManipulations){microstrategy.eventManager.notifyOrphanBones("ongridstructurechange",this.gridStructureInfo);}else{um.flushAndSubmitChanges();if(bIsChrome){window.setTimeout(function(){window.getSelection().removeAllRanges();},0);}}}return true;}catch(err){microstrategy.errors.log(err);return null;}};mstrGridReport.prototype.processContextMenus=function(evtId,evtArgs){try{var um=microstrategy.updateManager;if(!um){return false;}var src=microstrategy.activeCXMenu;var fn=function(s){return src.getAttribute(microstrategy["HTMLATTR_DSS_"+s]);};if(src){var forceServer=false;var ac=[];var argSplits=[];var a,v;switch(evtId){case"pttm":argSplits=evtArgs.split(",");switch(argSplits[0]){case"r":case"c":case"p":case"g":var m={r:1,c:2,p:4,g:0};this.addPercentToTotal(src,m[argSplits[0]],null);break;case"a":this.addPercentToTotal(src,0,argSplits[1]);break;}break;case"rm":argSplits=evtArgs.split(",");var c=mstr.utils.Arrays.find(["a","n"],argSplits[1]);if(c>-1){var p1=null;if(c==0){p1=argSplits[2];}this.addRankMetric(src,p1,argSplits[0]);}break;case"tm":argSplits=evtArgs.split(",");this.addTransformationMetric(src,argSplits[0],argSplits[1]);break;case"xx":if(this.useClientSideManipulations){var objInfoList=[src];if(this.selections){objInfoList=this.getObjInfoList(this.selections.getSelectedUnitHeaders());}microstrategy.eventManager.notifyOrphanBones("onunitsremoved",objInfoList);}case"x":var selectedUnits=this.selections&&this.selections.getSelectedUnitHeaders();if(this.selections&&selectedUnits&&selectedUnits.length>1){var removeFromReport=(evtId=="xx");ac=this.deleteMultiItemSrc(selectedUnits,ac,removeFromReport);}else{ac=this.deleteItemSrc(src,ac,evtId=="xx");}if(this.selections){this.selections.clearAll(true);}if(ac.length>0&&this.useClientSideManipulations){microstrategy.eventManager.notifyOrphanBones("ongridstructurechange",this.gridStructureInfo);}forceServer=(evtId=="xx");break;case"keepOnGrid":var selectedUnits=this.selections&&this.selections.getSelectedUnitHeaders();if(this.selections&&selectedUnits&&selectedUnits.length>=1){ac=this.keepUnits(selectedUnits,ac);}if(this.selections){this.selections.clearAll(true);}if(ac.length>0&&this.useClientSideManipulations){microstrategy.eventManager.notifyOrphanBones("ongridstructurechange",this.gridStructureInfo);}break;case"p":case"c":case"l":case"r":case"u":case"d":var items=this.selections.getSelectedCellsWithAttr("dg","true");items.sort(new Function("a","b","return microstrategy.bone('"+this.id+"').sortByAxisDepth(a,b);"));var objInfoList=this.getObjInfoList(items);var srcObj;if(items.length<=1){srcObj=src;}else{if(evtId=="l"||evtId=="u"){srcObj=items[0];}else{if(evtId=="r"||evtId=="d"){srcObj=items[items.length-1];}else{srcObj=src;}}}objInfo=this.gridStructureInfo.getGridUnitInfo(srcObj);var axis=objInfo.axis;var depth=objInfo.depth;var subDepth=objInfo.subDepth;if(evtId=="p"){axis=microstrategy.GRIDCELL_AXIS_PAGE_BY;depth=-1;subDepth=1;}else{if(evtId=="c"){axis=(axis==microstrategy.GRIDCELL_AXIS_ROWS)?microstrategy.GRIDCELL_AXIS_COLUMNS:microstrategy.GRIDCELL_AXIS_ROWS;depth=1;subDepth=1;}else{if(objInfo.dssType==microstrategy.DSSTYPE_ATTRIBUTE_FORM){if(this.isFeatureAvailable(microstrategy.FEATURE_SET_ATTRIBUTEFORM_DISPLAY)&&this.showAttForms){if(evtId=="l"||evtId=="u"){(subDepth==1)?depth--:subDepth--;}else{var attUnit=this.gridStructureInfo.findUnit(objInfo.parentDssId);(subDepth==attUnit.attForms.size())?depth++:subDepth++;}}else{subDepth=1;(evtId=="l"||evtId=="u")?depth--:depth++;}}else{objInfo=this.gridStructureInfo.getGridUnitInfoBySrc(srcObj);var index=objInfo?objInfo.index:-1;axis=objInfo.axis;depth=objInfo.depth;subDepth=objInfo.subDepth;if(index>-1){(evtId=="l"||evtId=="u")?index--:index++;var u=this.gridStructureInfo.allAxes[(axis==microstrategy.GRIDCELL_AXIS_METRICS)?0:axis].units[index];depth=u?u.depth:objInfo.depth;}else{(evtId=="l"||evtId=="u")?depth--:depth++;}}}}if(evtId=="l"||evtId=="r"||evtId=="u"||evtId=="d"){var maxAxisPosition=this.gridStructureInfo.getMaxAxisPosition(axis);if(depth<1||depth>=maxAxisPosition){return false;}}ac=(objInfoList.length>1)?this.pivotUnits(objInfoList,axis,depth,subDepth,ac):this.pivotUnit(objInfo,axis,depth,subDepth,ac);var _tmp=this.selections&&this.selections.clearAll(true);_tmp=(ac.length>0)&&microstrategy.eventManager.notifyOrphanBones("ongridstructurechange",this.gridStructureInfo);break;case"atfa":argSplits=evtArgs.split(EXPRESSION_SEPARATOR);var formID=argSplits[0];var formName=argSplits[1];objInfo=this.gridStructureInfo.buildGridUnitInfo(src);var formItem=this.gridStructureInfo.buildFormSrcFromCM(objInfo,formName,formID);subDepth=this.gridStructureInfo&&this.gridStructureInfo.getAttrFormPos(formItem);ac=this.addUnit(formItem,objInfo.axis,objInfo.depth,subDepth,ac);_tmp=this.selections&&this.selections.clearAll(true);_tmp=(ac.length>0)&&this.useClientSideManipulations&&microstrategy.eventManager.notifyOrphanBones("ongridstructurechange",this.gridStructureInfo);break;case"atfr":var attInfo=this.gridStructureInfo.findUnit(fn("ID"));if(attInfo==null){break;}if(attInfo.hasAttForms()&&attInfo.attForms.size()>1){var formInfo=attInfo.attForms.findUnit(evtArgs);ac=this.deleteUnit(formInfo,ac);_tmp=this.selections&&this.selections.clearAll(true);_tmp=(ac.length>0&&this.useClientSideManipulations)&&microstrategy.eventManager.notifyOrphanBones("ongridstructurechange",this.gridStructureInfo);}else{showMessage({contents:mstrGridReport.desp("3626"),elements:microstrategy.OK_BUTTON,type:mstrMsgBoxImpl.MSG_WARNING});}break;case"atfm":this.addAction(null,mstrUpdateManager.OPEN_ATT_FORMS_EDITOR,this.beanPath,["6042","6044"],[fn("ID"),"false"]);break;case"gridFormat":var info=this.gridStructureInfo.getGridUnitInfo(src);this.gridUnitFormat=this.resolveGridUnitId(info.axis,info.depth);this.gridValueFormat=1;window.setTimeout("microstrategy.bone('"+this.viewerId+"').commands.exec('openFormatGrid', { selectedIndicesList : 9 });",20);break;case"rename":var evtStr="formulaMode=0&activeViewID="+this.objId+"&activeDatasetID="+this.dSetId;evtStr=evtStr+"&activeElemIndx="+evtArgs;toggleShowBean("formula",true,evtStr);break;case"mfc":case"mftop":case"mfbottom":case"mfedit":case"mfadd":var mp={mfc:"CLEAR_UNIT_LIMIT",mfedit:"EDIT_UNIT_LIMIT",mfadd:"ADD_SUBEXPRESSION"}[evtId]||"SET_UNIT_LIMIT";a=["1001"];v=[fn("ID")];if(evtId=="mftop"||evtId=="mfbottom"){a=a.concat(["1002","262144011","262144017","262144014"]);v=v.concat([fn("TYPE"),((evtId=="mftop")?"1":"2"),"2","10"]);}var p=mstrUpdateManager[mp];this.addAction(null,p,this.bp[p],a,v);break;case"fos":var selectedDrillElements=this.commands.queryState("selectedDrillElements");this.commands.exec("clearAllGridSelections");var ids=["4035"];var values=[selectedDrillElements];if(this.sliceID){ids.push("4254");values.push(this.sliceID);}ids.push("4134");values.push("1");this.addAction(null,mstrUpdateManager.FILTER_ON_SELECTIONS,this.beanPath,ids,values);break;case"deopenNewSort":var objInfo=this.gridStructureInfo.getGridUnitInfo(src),att={dssId:objInfo.dssType==21?objInfo.parentDssId:objInfo.dssId,dssSetId:objInfo.dssSetId};var me=this;microstrategy.openCustomSortEditor({mid:this.messageID||mstrApp.oi.mid,uKey:this.RWUnitId,att:att,bp:this.beanPath,onSave:function(data){var args=mstrmojo.hash.copy(data,{attId:att.dssId});me.addAction(null,mstrUpdateManager.VIEW_EVENT_CUSTOM_SORT,me.beanPath,[409606622],[JSON.stringify(args)]);}});break;case"deopenSort":case"deopen":a=["1001"];v=[fn("ID")];if(evtId==="deopenSort"){a.push("6048");v.push("1");}this.addAction(null,mstrUpdateManager.OPEN_DERIVED_ELEMENTS_EDITOR,this.bp[mstrUpdateManager.OPEN_DERIVED_ELEMENTS_EDITOR],a,v);break;case"declear":showMessage({contents:mstrGridReport.desp("5776"),elements:microstrategy.OK_BUTTON+microstrategy.CANCEL_BUTTON,okEval:"microstrategy.bones['"+this.id+"'].clearDerivedElements('"+fn("ID")+"')",title:mstrGridReport.desp("5950")});break;case"deSum":case"deAvg":case"deMin":case"deMax":case"deMinus":case"deDivide":case"deList":this.addCalculationQuickGroup(evtId);return null;case"WebHyperLinkEditor":var params="activeUnitID="+fn("ID")+"&activeUnitType="+fn("TYPE")+"&renderPromptsOnly=false";toggleShowBean("webHyperLinkEditor",true,params);break;case"edtSimpleThresholds":case"edtAdvancedThresholds":var sb=evtId;if(microstrategy.EXECUTION_SCOPE!=microstrategy.RWD_EXECUTION){sb=sb.replace("edtSim","edtReportSim");}toggleShowBean(sb,true,"&activeViewID="+this.objId+"&container="+evtArgs);break;case"alert":evtStr="&activeViewID="+this.objId+"&container="+evtArgs;toggleShowBean("alertsEditor",true,evtStr);break;case"alertMobile":evtStr="&activeViewID="+this.objId+"&container="+evtArgs;this.um.replaceURL("deliveryMode","128");toggleShowBean("mobileAlertsEditor",true,evtStr);break;case"alertEmail":evtStr="&activeViewID="+this.objId+"&container="+evtArgs;this.um.replaceURL("deliveryMode","1");toggleShowBean("alertsEditor",true,evtStr);break;}if(ac.length>0){um.add(ac);if(!this.useClientSideManipulations||forceServer){um.flushAndSubmitChanges();}}return true;}}catch(err){microstrategy.errors.log(err);}return false;};mstrGridReport.prototype.clearDerivedElements=function(dssId){try{this.addAction(null,mstrUpdateManager.CLEAR_DERIVED_ELEMENTS,this.beanPath,["1001"],[dssId]);return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrGridReport.prototype.pivotUnit=function(objInfo,axis,depth,subDepth,ac){try{var um=this.um;var ca={id:this.id,pivot:true};var gsi=this.gridStructureInfo;var mxap=gsi.getMaxAxisPosition(axis);if(objInfo.axis!=axis){if(depth>mxap||depth==-1){depth=mxap;}}else{if(depth>=mxap||depth==-1){depth=mxap-1;}}var finishPivot=false;if(objInfo.subtype==microstrategy.SUBOBJTYPE_METRIC||objInfo.isMetricTemplateUnit){if(objInfo.axis!=axis){finishPivot=(gsi.metricsAxis!=axis||gsi.metricsDepth!=depth);}else{finishPivot=(objInfo.depth!=depth);}}else{finishPivot=(objInfo.axis!=axis||objInfo.depth!=depth);if(this.isFeatureAvailable(microstrategy.FEATURE_SET_ATTRIBUTEFORM_DISPLAY)&&this.showAttForms){finishPivot=(finishPivot||objInfo.subDepth!=subDepth);}}var item=objInfo.src;if(finishPivot){var updateNow=mstrGridReport.updateNow();switch(objInfo.subtype){case microstrategy.SUBOBJTYPE_ATTRIBUTE:ac.push(um.createActionObject(objInfo,mstrUpdateManager.PIVOT_TEMPLATE_UNIT,this.beanPath,["4110","4006","4007","4008","4009"],[updateNow,objInfo.axis,objInfo.depth,axis,depth],[updateNow,objInfo.axis,objInfo.depth,axis,depth],ca));break;case microstrategy.SUBOBJTYPE_ATTRIBUTE_FORM:if(objInfo.axis!=axis||objInfo.depth!=depth){var attUnit=gsi.findUnit(objInfo.parentDssId);ac.push(um.createActionObject(attUnit,mstrUpdateManager.PIVOT_TEMPLATE_UNIT,this.beanPath,["4110","4006","4007","4008","4009"],[updateNow,objInfo.axis,objInfo.depth,axis,depth],[updateNow,objInfo.axis,objInfo.depth,axis,depth],ca));}else{ac.push(um.createActionObject(objInfo,mstrUpdateManager.ADD_FORM,this.beanPath,["4110","4165","4166","4008","4009","4168","4096001"],[updateNow,objInfo.parentDssId,objInfo.dssId,axis,depth,subDepth,this.dSetId],[updateNow,objInfo.parentDssId,objInfo.dssId,objInfo.axis,objInfo.depth,objInfo.subDepth,this.dSetId],ca));}break;case microstrategy.SUBOBJTYPE_METRIC:if(objInfo.axis!=axis){objInfo=gsi.getUnit(gsi.metricsAxis,gsi.metricsDepth,1);item=objInfo.src;ac.push(um.createActionObject(objInfo,mstrUpdateManager.PIVOT_TEMPLATE_UNIT,this.beanPath,["4110","4006","4007","4008","4009"],[updateNow,objInfo.axis,objInfo.depth,axis,depth],[updateNow,objInfo.axis,objInfo.depth,axis,depth],ca));}else{ac.push(um.createActionObject(objInfo,mstrUpdateManager.PIVOT_TEMPLATE_METRIC,this.beanPath,["4110","4028","4029"],[updateNow,objInfo.depth,depth],[updateNow,objInfo.depth,depth],ca));}break;}if(this.useClientSideManipulations){this.template.pivot(item,axis,depth,subDepth);if(mstrGridReport.isReport()){var bone=null;if(this.id.indexOf("_graph")>-1){var bone=microstrategy.bone(this.id.substr(0,this.id.indexOf("_graph")));}else{var bone=microstrategy.bone(this.id+"_graph");}}if(bone){bone.template.generateTemplate();bone.template.sendUpdate();}if(this.useDNDMapping&&this.mask!=null){this.mask.onmaskedobjectresize();}}}return ac;}catch(err){microstrategy.errors.log(err);return false;}};mstrGridReport.prototype.addUnit=function(item,axis,depth,subDepth,ac,forceDepth){try{var um=this.um;var ca={id:this.id,allForms:false,pivot:false};if(this.isGraph&&!this.gridStructureInfo.hasMetrics&&axis==-1){axis=2;}var gis=this.gridStructureInfo;var maxAxisPosition=gis.getMaxAxisPosition(axis);if(!forceDepth&&(depth>maxAxisPosition||depth==-1)){depth=maxAxisPosition;}var objInfo=gis.buildGridUnitInfo(item,axis,depth,subDepth);var unitInfo=subUnitInfo=null;var aclen=ac.length;if(objInfo.dssType==microstrategy.DSSTYPE_ATTRIBUTE_FORM){unitInfo=gis.findUnit(objInfo.parentDssId);if(unitInfo!=null){if(unitInfo.attFormId==objInfo.dssId){ac=this.pivotUnit(unitInfo,axis,depth,subDepth,ac);if(mstrGridReport.isRWD()&&objInfo.dssSetId!=gis.dataSetId&&ac.length>aclen){ac=this.changeGridDataSource(objInfo.dssSetId,ac);}return ac;}else{subUnitInfo=unitInfo.attForms.findUnit(objInfo.dssId);if(subUnitInfo!=null){ac=this.pivotUnit(subUnitInfo,axis,depth,subDepth,ac);if(mstrGridReport.isRWD()&&objInfo.dssSetId!=gis.dataSetId&&ac.length>aclen){ac=this.changeGridDataSource(objInfo.dssSetId,ac);}return ac;}else{if(unitInfo.axis!=axis||unitInfo.depth!=depth){ac=this.pivotUnit(unitInfo,axis,depth,1,ac);depth=unitInfo.depth;subDepth=unitInfo.hasAttForms()?Math.max(unitInfo.attForms.size()+1,2):2;}}}}else{ca.allForms=true;}}else{unitInfo=gis.findUnit(objInfo.dssId);if(unitInfo!=null){ac=this.pivotUnit(unitInfo,axis,depth,subDepth,ac);if(mstrGridReport.isRWD()&&objInfo.dssSetId!=gis.dataSetId&&ac.length>aclen){ac=this.changeGridDataSource(objInfo.dssSetId,ac);}return ac;}}var updateNow=mstrGridReport.updateNow();var pbb=microstrategy.bone("pbb_GroupByStyle");var hasAllOnNGB=pbb&&pbb.hasAllSelected;var disablePU=hasAllOnNGB?"1":"0";switch(objInfo.dssType){case microstrategy.DSSTYPE_ATTRIBUTE:case microstrategy.DSSTYPE_HIERARCHY:if(item.getAttribute(microstrategy.HTMLATTR_OBJTYPE)==microstrategy.OBJTYPE_XDA_DATA_ELEMENT){ac.push(um.createActionObject(objInfo,mstrUpdateManager.ADD_TEMPLATE_UNIT,this.beanPath,["4110","4008","4009","4026","4027","4177","4200","4220","4221","4229"],[updateNow,axis,objInfo.depth,objInfo.dssType,objInfo.dssId,objInfo.dssSetId,objInfo.alias,item.getAttribute("did"),item.getAttribute("hid"),disablePU],[],ca));break;}case microstrategy.DSSTYPE_PROMPT:if(objInfo.dssType==microstrategy.DSSTYPE_PROMPT){iframe.showWaitPage();var isValidPrompt=false;mstr.$XHR.request(mstrConfig.taskURL,{taskId:"validatePromptForTemplate",objectID:objInfo.dssId},{success:function(res){isValidPrompt=res.v||false;}},false);iframe.hideWaitPage();if(!isValidPrompt){showMessage({contents:mstrGridReport.desp(8946),elements:microstrategy.OK_BUTTON,type:mstrMsgBoxImpl.MSG_ERROR});break;}}case microstrategy.DSSTYPE_CONSOLIDATION:case microstrategy.DSSTYPE_FILTER:ac.push(um.createActionObject(objInfo,mstrUpdateManager.ADD_TEMPLATE_UNIT,this.beanPath,["4110","4008","4009","4026","4027","4177","4200","4229"],[updateNow,axis,objInfo.depth,objInfo.dssType,objInfo.dssId,objInfo.dssSetId,objInfo.alias,disablePU],[],ca));break;case microstrategy.DSSTYPE_ATTRIBUTE_FORM:ac.push(um.createActionObject(objInfo,mstrUpdateManager.ADD_FORM,this.beanPath,["4110","4165","4166","4008","4009","4168","4177","4200"],[updateNow,objInfo.parentDssId,objInfo.dssId,axis,objInfo.depth,subDepth,objInfo.dssSetId,objInfo.parentAlias],[],ca));break;case microstrategy.DSSTYPE_METRIC:case microstrategy.DSSTYPE_USER_METRIC:case microstrategy.DSSTYPE_USER_SUMMARY_METRIC:if(!gis.hasMetrics){ac.push(um.createActionObject(objInfo,mstrUpdateManager.ADD_TEMPLATE_METRIC,this.beanPath,["4110","4029","4008","4009","4122","4201","4177","4164","4229"],[updateNow,"0",axis,objInfo.depth,objInfo.dssId,objInfo.alias,objInfo.dssSetId,objInfo.dssSubtype,disablePU],[],ca));}else{ac.push(um.createActionObject(objInfo,mstrUpdateManager.ADD_TEMPLATE_METRIC,this.beanPath,["4110","4029","4122","4201","4177","4164","4229"],[updateNow,objInfo.depth,objInfo.dssId,objInfo.alias,objInfo.dssSetId,objInfo.dssSubtype,disablePU],[],ca));}if(objInfo.dssType==microstrategy.DSSTYPE_USER_METRIC&&mstrGridReport.isRWD()){this.flush=true;ac.push(um.createActionObject(null,mstrUpdateManager.APPLY_CHANGES,mstrUpdateManager.applyChangesBeanPath,[],[],[],null));}break;}if(this.useClientSideManipulations&&ac.length>0){this.template.add(item,axis,objInfo.depth,subDepth);if(mstrGridReport.isReport()){var bone=null;if(this.id.indexOf("_graph")>-1){bone=microstrategy.bone(this.id.substr(0,this.id.indexOf("_graph")));}else{bone=microstrategy.bone(this.id+"_graph");}if(bone){bone.template.generateTemplate();bone.template.sendUpdate();}}if(this.useDNDMapping&&this.mask!=null){this.mask.onmaskedobjectresize();}}this.dSetId=objInfo.dssSetId||this.dSetId;return ac;}catch(err){microstrategy.errors.log(err);return false;}};mstrGridReport.prototype.canAddMDXUnit=function(item){try{if(this.reportObjs){var reportObjs=this.reportObjs,itemType=item.getAttribute(microstrategy.HTMLATTR_DSS_TYPE),itemHid=item.getAttribute("hid"),itemDid=item.getAttribute("did");if(itemType==microstrategy.DSSTYPE_DIMENSION){for(var i=0,len=reportObjs.length;i<len;i++){if(reportObjs[i].oty==microstrategy.DSSTYPE_ATTRIBUTE&&reportObjs[i].hid==itemHid&&reportObjs[i].did==itemDid){return false;}}}else{if(itemType==microstrategy.DSSTYPE_ATTRIBUTE){for(var i=0,len=reportObjs.length;i<len;i++){if(reportObjs[i].oty==microstrategy.DSSTYPE_DIMENSION&&reportObjs[i].hid==itemHid&&reportObjs[i].did==itemDid){return false;}}}}}return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrGridReport.prototype.changeGridDataSource=function(dataSetId,ac){if(dataSetId==this.gridStructureInfo.dataSetId){return ac;}ac.push(this.um.createActionObject(this.elem,mstrUpdateManager.CHANGE_DATA_SET,this.beanPath,["2048031","2048012"],[dataSetId,this.objId]));this.gridStructureInfo.dataSetId=dataSetId;if(this.useClientSideManipulations){microstrategy.eventManager.notifyOrphanBones("ongriddatasourcechange");}return ac;};mstrGridReport.prototype.replaceTemplate=function(item,isLinked,ac){try{var objInfo=new mstrObjectInfoImpl(item);alert("Sorry, this feature has not been implemented yet.");}catch(err){microstrategy.errors.log(err);}return ac;};mstrGridReport.prototype.isGridInCellSelectionMode=function(){try{return(this.selections&&this.selections.hasHilitedCells());}catch(err){microstrategy.errors.log(err);return null;}};mstrGridReport.prototype.getObjInfoList=function(selectedUnits){try{var objInfoList=[];for(var i=0,cnt=selectedUnits.length;i<cnt;++i){var objInfo=this.gridStructureInfo.getGridUnitInfo(selectedUnits[i],(microstrategy.SUBOBJTYPE_ATTRIBUTE_FORM==selectedUnits[i].getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)));if(objInfo){objInfoList.push(objInfo);}}return objInfoList;}catch(err){microstrategy.errors.log(err);return false;}};mstrGridReport.prototype._updateObjInfoList=function(objInfoList){if(!objInfoList){return ;}if(!mstrGridReport.isDesignMode()&&this.overlapGridTitles){return ;}var hasMtu=false;var hasMetric=false;for(var i=0;i<objInfoList.length;i++){var objInfo=objInfoList[i];if(objInfo.isMetricTemplateUnit){hasMtu=true;}else{if(objInfo.subtype==microstrategy.SUBOBJTYPE_METRIC){hasMetric=true;}}if(hasMtu&&hasMetric){break;}}i=0;if(hasMtu&&hasMetric){while(i<objInfoList.length){var objInfo=objInfoList[i];if(objInfo.subtype==microstrategy.SUBOBJTYPE_METRIC){objInfoList.splice(i,1);}else{i++;}}}};mstrGridReport.prototype.keepUnits=function(items,ac){try{var keepList=this.getObjInfoList(items),gsi=this.gridStructureInfo,toRemoveList=[],keepMap={metricCount:0,hasRowAxis:false,hasColAxis:false,hasMetricTemplateUnit:false};for(var i=0,cnt=keepList.length;i<cnt;i++){switch(keepList[i].axis){case microstrategy.GRIDCELL_AXIS_METRICS:keepMap[keepList[i].dssId]=true;keepMap.metricCount++;break;case microstrategy.GRIDCELL_AXIS_ROWS:case microstrategy.GRIDCELL_AXIS_COLUMNS:if(keepList[i].isMetricTemplateUnit){keepMap.hasMetricTemplateUnit=true;}else{if(keepList[i].subtype==microstrategy.SUBOBJTYPE_ATTRIBUTE){keepMap.hasRowAxis=keepMap.hasRowAxis||(keepList[i].axis==microstrategy.GRIDCELL_AXIS_ROWS);keepMap.hasColAxis=keepMap.hasColAxis||(keepList[i].axis==microstrategy.GRIDCELL_AXIS_COLUMNS);keepMap[keepList[i].dssId]=true;}else{if(keepList[i].subtype==microstrategy.SUBOBJTYPE_ATTRIBUTE_FORM){keepMap.hasRowAxis=keepMap.hasRowAxis||(keepList[i].axis==microstrategy.GRIDCELL_AXIS_ROWS);keepMap.hasColAxis=keepMap.hasColAxis||(keepList[i].axis==microstrategy.GRIDCELL_AXIS_COLUMNS);keepMap[keepList[i].dssId+keepList[i].parentDssId]=true;}}}break;default:break;}}if(!keepMap.hasMetricTemplateUnit&&keepMap.metricCount>0&&keepMap.metricCount<gsi.metricAxis.units.length){for(var i=0,cnt=gsi.metricAxis.units.length;i<cnt;i++){var unit=gsi.metricAxis.units[i];if(!keepMap.hasOwnProperty(unit.dssId)){toRemoveList.push(unit);}}}function prepareToRemoveListForAttr(unit){if(unit.isMetricTemplateUnit){return ;}if(!keepMap.hasOwnProperty(unit.dssId)){if(unit.hasAttForms()){for(var i=0,cnt=unit.attForms.size();i<cnt;i++){var attForm=unit.attForms.units[i];if(!keepMap.hasOwnProperty(attForm.dssId+attForm.parentDssId)){toRemoveList.push(attForm);}}}else{toRemoveList.push(unit);}}}if(keepMap.hasRowAxis){for(var i=0,cnt=gsi.rowAxis.units.length;i<cnt;i++){prepareToRemoveListForAttr(gsi.rowAxis.units[i]);}}if(keepMap.hasColAxis){for(var i=0,cnt=gsi.colAxis.units.length;i<cnt;i++){prepareToRemoveListForAttr(gsi.colAxis.units[i]);}}ac=this.deleteUnits(toRemoveList,ac,false);}catch(err){microstrategy.errors.log(err);}return ac;};mstrGridReport.prototype.deleteMultiItemSrc=function(items,ac,removeFromReport){try{var objInfoList=this.getObjInfoList(items);ac=this.deleteUnits(objInfoList,ac,removeFromReport);}catch(err){microstrategy.errors.log(err);}return ac;};mstrGridReport.prototype.deleteUnits=function(objInfoList,ac,removeFromReport){try{var isRemoveFromReport=!!removeFromReport;var isRemoveFromGrid=this.isRemoveFromGrid(microstrategy.FEATURE_WEB_REMOVE_FROM_GRID);var updateNow=mstrGridReport.updateNow();var multipleSrc="";var tempAc=[];var cachedArray={id:this.id};if(this.isGridObjectLocked(objInfoList)){return ac;}this._updateObjInfoList(objInfoList);var um=this.um;for(var i=0,cnt=objInfoList.length;i<cnt;i++){var objInfo=objInfoList[i];if(!isRemoveFromReport&&isRemoveFromGrid){multipleSrc+=this.buildPivotingSrc(objInfo);}else{multipleSrc+=this.buildDeletingFromReportSrc(objInfo);}}if(updateNow==mstrUpdateManager.UPDATE_LATER&&!isRemoveFromReport){for(var i=0,cnt=objInfoList.length;i<cnt;i++){var objInfo=objInfoList[i];tempAc=this.deleteUnit(objInfo,tempAc,removeFromReport);}}if(multipleSrc.length>0){cachedArray.list=tempAc;var id=mstrUpdateManager.REMOVE_MULTIPLE_UNITS_FROM_WORKING_SET;var args=["4213"];var argv=[multipleSrc];if(!isRemoveFromReport&&isRemoveFromGrid){id=mstrUpdateManager.REMOVE_MULTIPLE_UNITS;args=["4110"].concat(args);argv=[updateNow].concat(argv);if(mstrGridReport.isRWD()){args=["4179"].concat(args);argv=["true"].concat(argv);}}ac.push(um.createActionObject(null,id,this.beanPath,args,argv,null,cachedArray));}}catch(err){microstrategy.errors.log(err);}return ac;};mstrGridReport.prototype.deleteItemSrc=function(item,ac,removeFromReport){try{var objInfo=this.gridStructureInfo.buildGridUnitInfo(item);this.deleteUnit(objInfo,ac,removeFromReport);return ac;}catch(err){microstrategy.errors.log(err);return false;}};mstrGridReport.prototype.deleteUnit=function(objInfo,ac,removeFromReport){try{var um=this.um;var ca={id:this.id};var updateNow=mstrGridReport.updateNow();var isRemoveFromReport=!!removeFromReport;var isRemoveFromGrid=this.isRemoveFromGrid(microstrategy.FEATURE_WEB_REMOVE_FROM_GRID);if(objInfo.subtype==microstrategy.SUBOBJTYPE_ATTRIBUTE_FORM){isRemoveFromGrid=this.isRemoveFromGrid(microstrategy.FEATURE_USE_REPORT_OBJECT_WINDOW);}if(this.isGridObjectLocked([objInfo])){return ac;}if(!isRemoveFromReport&&isRemoveFromGrid){var isDisableOnly=mstrGridReport.isRWD();var pbb=microstrategy.bone("pbb_GroupByStyle");var hasAllOnNGB=pbb&&pbb.hasAllSelected;var disablePU=hasAllOnNGB?"1":"0";switch(objInfo.subtype){case microstrategy.SUBOBJTYPE_ATTRIBUTE:if(this.useClientSideManipulations){if(objInfo.isMetricTemplateUnit){var metrics=[];for(var i=0;i<this.gridStructureInfo.metricAxis.size();i++){metrics.push(this.gridStructureInfo.metricAxis.units[i]);}ca.metrics=metrics;if(this.controlLinks&&this.controlLinks.Metrics){delete this.controlLinks.Metrics;}}}if(this.controlLinks&&this.controlLinks[objInfo.dssId]){delete this.controlLinks[objInfo.dssId];}if(objInfo.depth>2){var axisUnits=this.gridStructureInfo.allAxes[objInfo.axis].units;for(var i=0;i<axisUnits.length;i++){if(objInfo.dssId==axisUnits[i].dssId){objInfo.depth=axisUnits[i].depth;break;}}}ac.push(um.createActionObject(objInfo,mstrUpdateManager.REMOVE_TEMPLATE_UNIT,this.beanPath,["4110","4006","4007","4179","4229"],[updateNow,objInfo.axis,objInfo.depth,isDisableOnly,disablePU],[updateNow,objInfo.axis,objInfo.depth,isDisableOnly,disablePU],ca));break;case microstrategy.SUBOBJTYPE_ATTRIBUTE_FORM:if(this.isFeatureAvailable(microstrategy.FEATURE_SET_ATTRIBUTEFORM_DISPLAY)){ac.push(um.createActionObject(objInfo,mstrUpdateManager.REMOVE_FORM,this.beanPath,["4110","4165","4166"],[updateNow,objInfo.parentDssId,objInfo.dssId],[updateNow,objInfo.parentDssId,objInfo.dssId],ca));}else{objInfo=this.gridStructureInfo.findUnit(objInfo.parentDssId);ac.push(um.createActionObject(objInfo,mstrUpdateManager.REMOVE_TEMPLATE_UNIT,this.beanPath,["4110","4006","4007","4179"],[updateNow,objInfo.axis,objInfo.depth,isDisableOnly],[updateNow,objInfo.axis,objInfo.depth,isDisableOnly],ca));}break;case microstrategy.SUBOBJTYPE_METRIC:ca.metricsAxis=this.gridStructureInfo.metricsAxis;ca.metricsDepth=(this.gridStructureInfo.metricAxis.size()>1)?null:this.gridStructureInfo.metricsDepth;ac.push(um.createActionObject(objInfo,mstrUpdateManager.REMOVE_TEMPLATE_METRIC,this.beanPath,["4110","4028","4179","4229"],[updateNow,objInfo.depth,isDisableOnly,disablePU],[updateNow,objInfo.depth,isDisableOnly,disablePU],ca));break;}}else{if(objInfo.isMetricTemplateUnit){ac.push(um.createActionObject(objInfo,mstrUpdateManager.REMOVE_ALL_WORKINGSET_METRICS,this.beanPath,["4110"],[updateNow],[updateNow],ca));}else{switch(objInfo.subtype){case microstrategy.SUBOBJTYPE_ATTRIBUTE_FORM:if(this.isFeatureAvailable(microstrategy.FEATURE_MODIFY_REPORT_LIST)){if(this.isFeatureAvailable(microstrategy.FEATURE_SET_ATTRIBUTEFORM_DISPLAY)){ac.push(um.createActionObject(objInfo,mstrUpdateManager.REMOVE_FORM,this.beanPath,["4110","4165","4166"],[updateNow,objInfo.parentDssId,objInfo.dssId],[updateNow,objInfo.parentDssId,objInfo.dssId],ca));}else{ac.push(um.createActionObject(objInfo,mstrUpdateManager.REMOVE_WORKINGSET_OBJECT,this.beanPath,["4110","4165","4166"],[updateNow,objInfo.dssId,objInfo.dssType],[updateNow,objInfo.dssId,objInfo.dssType],ca));}}else{showMessage({contents:"You do not have the necessary privileges to perform the selected action.",elements:microstrategy.OK_BUTTON,type:mstrMsgBoxImpl.MSG_WARNING});}break;default:ac.push(um.createActionObject(objInfo,mstrUpdateManager.REMOVE_WORKINGSET_OBJECT,this.beanPath,["4110","4165","4166"],[updateNow,objInfo.dssId,objInfo.dssType],[updateNow,objInfo.dssId,objInfo.dssType],ca));break;}}}if(this.isMdxCube){this.useClientSideManipulations=false;}if(this.useClientSideManipulations){this.template.remove(objInfo);if(this.useDNDMapping&&this.mask!=null){this.mask.onmaskedobjectresize();}if(this.gridStructureInfo.isEmptyTemplate){this.dSetId=null;}}return ac;}catch(err){microstrategy.errors.log(err);return false;}};mstrGridReport.prototype.isGridObjectLocked=function(objList){if(objList){var cnt=objList.length;for(var i=0;i<cnt;i++){var obj=objList[i];if(obj.isLocked&&(obj.subtype!=microstrategy.SUBOBJTYPE_ATTRIBUTE_FORM||!this.isFeatureAvailable(microstrategy.FEATURE_SET_ATTRIBUTEFORM_DISPLAY))){var msg=(cnt==1)?"3807":"3811";showMessage({contents:mstrGridReport.desp(msg),elements:microstrategy.OK_BUTTON,type:mstrMsgBoxImpl.MSG_WARNING});return true;}}}return false;};mstrGridReport.prototype.swapAxes=function(){try{this.um.add([this.um.createActionObject(this.elem,mstrUpdateManager.SWAP_TEMPLATE_AXES,this.beanPath,[],[],[],{id:this.id})]);if(this.useClientSideManipulations){if(this.isGrid||this.zonesEditor){this.template.swapAxes();}}else{this.um.flushAndSubmitChanges();}}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.addPercentToTotal=function(item,axesBitMap,attributeID){try{var objInfo=this.gridStructureInfo.buildGridUnitInfo(item);var ids=["4176","4122"];var values=[axesBitMap,objInfo.dssId];if(attributeID!=null){ids.splice(1,0,"4165");values.splice(1,0,attributeID);}this.addAction(objInfo,mstrUpdateManager.INSERT_PERCENT_TO_TOTAL_METRIC,this.beanPath,ids,values);}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.addRankMetric=function(item,attributeID,sortOrder){try{var objInfo=this.gridStructureInfo.buildGridUnitInfo(item);var ids=["4122","4012"];var values=[objInfo.dssId,sortOrder];if(attributeID!=null){ids.splice(0,0,"4165");values.splice(0,0,attributeID);}this.addAction(objInfo,mstrUpdateManager.INSERT_RANK_METRIC,this.beanPath,ids,values);}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.addTransformationMetric=function(item,roleID,formula){try{var objInfo=this.gridStructureInfo.buildGridUnitInfo(item);this.addAction(objInfo,mstrUpdateManager.INSERT_TRANSFORMATION_METRIC,this.beanPath,["4175","4122","4032"],[roleID,objInfo.dssId,formula]);}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.handleBanding=function(state,ac){try{if(!state){state=(this.checkBanding)?0:1;}this.checkBanding=!this.checkBanding;var args=["4125"];var argValues=[state];if(this.styleName&&this.styleName.length>0){args.push("4126");argValues.push(this.styleName);}this.addAction(this.elem,mstrUpdateManager.TOGGLE_BANDING,this.beanPath,args,argValues,ac);}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.setSubtotalDisplayOption=function(axis,displayOption,ac){try{this.addAction(this.elem,mstrUpdateManager.SET_SUBTOTAL_POSITION,this.beanPath,["4006","4217"],[axis,displayOption],ac);}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.setSubtotalAxisStyle=function(values,ac){try{var temps=values.split("|");if(!temps){return false;}var axis=temps[0];var index=temps[1];var style=temps[2];this.addAction(null,mstrUpdateManager.ADD_AXIS_SUBTOTAL,this.beanPath,["4006","4218","4016","4110"],[axis,index,style,"1"],ac);}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.setSubtotalSelectedUnit=function(values,ac){try{var temps=values.split("|");if(!temps){return false;}var index=temps[0];var selectedUnits=temps[1];this.addAction(null,mstrUpdateManager.ADD_UNIT_SUBTOTAL,this.beanPath,["4215","4218"],[selectedUnits,index],ac);}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.disableSubtotal=function(values,ac){try{var subtotalIndex=values;this.addAction(null,mstrUpdateManager.DISABLE_SUB_TOTALS,this.beanPath,["4218","4110"],[subtotalIndex,"1"],ac);}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.handleChangeStyle=function(style,ac){try{this.addAction(this.elem,mstrUpdateManager.CHANGE_STYLE,this.beanPath,["4041"],[style],ac);}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.setVisualizationSettings=function(enabled,selectedVisualization,visualizationList,viewMode,ac,visProps,iphoneVis,ipadVis,aPhoneVis,aTabletVis){try{var event=mstrUpdateManager.SET_VISUALIZATION_PROPERTIES;var updateNow=mstrGridReport.updateNow();var args=[];var argv=[];if(enabled){args.push("4096048");argv.push(enabled);}var vis;if(selectedVisualization!=null){args.push("4096049");argv.push(selectedVisualization);vis=this.getAllVisList()[selectedVisualization];if(vis){args.push("4255");argv.push((typeof (vis.ip)!="undefined")?vis.ip:"0");args.push("409606615");argv.push((typeof (vis.im)!="undefined")?vis.im:"");}}if(visualizationList!=null){args.push("4096050");argv.push(visualizationList);}if(viewMode){args.push("4096051");argv.push(viewMode);}if(visProps!=null){args.push("409606616");argv.push(visProps);}if(iphoneVis!=null){args.push("409606617");argv.push(iphoneVis);}if(ipadVis!=null){args.push("409606618");argv.push(ipadVis);}if(aPhoneVis!=null){args.push("409606619");argv.push(aPhoneVis);}if(aPhoneVis!=null){args.push("409606621");argv.push(aTabletVis);}microstrategy.updateVisProps(enabled,selectedVisualization,visualizationList,viewMode,this);if(mstrGridReport.isRWD()&&(vis||selectedVisualization=="")){this.curWgtId=selectedVisualization==""?"":vis.id;}args.push("4110");argv.push(updateNow);this.addAction(this.elem,event,this.beanPath,args,argv,ac);if(ac){this.notifySelectionChange("onvischange");}return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrGridReport.prototype.getAllVisList=function(){return(this.allVisList)?this.allVisList:this.docViewer.allVisList;};mstrGridReport.prototype.handleViewMode=function(viewMode,ac,quickSwitch){try{var changeViewModeEvent=(mstrGridReport.isReport())?mstrUpdateManager.REPORT_CHANGE_VIEW_MODE:mstrUpdateManager.CHANGE_VIEW_MODE;this.addAction(this.elem,changeViewModeEvent,this.beanPath,["4115"],[viewMode],ac);}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.updateViewMode=function(viewMode){try{var value=parseInt(viewMode);if(this.isTemplateEmpty()&&!this.quickSwitch){this.isGrid=true;this.isGraph=false;this.isVisualization=false;}else{this.isGrid=(value==microstrategy.DISPLAY_MODE_GRID_AND_GRAPH||value==microstrategy.DISPLAY_MODE_GRID);this.isGraph=(value==microstrategy.DISPLAY_MODE_GRID_AND_GRAPH||value==microstrategy.DISPLAY_MODE_GRAPH);this.isVisualization=(value>=microstrategy.FIRST_VISUALIZATION_VIEW_MODE);}if(this.isGraph&&!this.quickSwitch){this.major=this.DEFAULT_GRAPH_MAJOR_TYPE;this.minor=this.DEFAULT_GRAPH_MINOR_TYPE;}}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.toggleSubtotals=function(){try{var state=(this.isFeatureAvailable(microstrategy.FEATURE_CHECK_SHOW_SUBTOTALS))?0:1;this.addAction(this.elem,mstrUpdateManager.TOGGLE_SUBTOTALS,this.beanPath,["4116"],[state]);}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.displayThresholds=function(propValue,ac){try{this.addAction(this.elem,mstrUpdateManager.TOGGLE_GRID_THRESHOLDS,this.beanPath,["4171"],[propValue],ac);}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.addQuickThresholds=function(ac,cmdVals){try{if(cmdVals==null||cmdVals.indexOf("|")<1){return false;}var cmdValues=cmdVals.split("|");var index=cmdValues[0];var beanName=cmdValues[1];var beanPath=microstrategy.servletName+"."+microstrategy.pageName+"."+beanName;var su=this.selections.selectedUnits;var metricKeys="";var targetIds="";for(var i in su){if(su[i]!=null&&su[i].isMetric){if(su[i].gridTarget!=null&&su[i].gridTarget.length>0){var temps=su[i].gridTarget.split(",");var mindex=this.gridStructureInfo.getUnitIndex(microstrategy.GRIDCELL_AXIS_METRICS,parseInt(temps[0])+1);if(mindex!=null){metricKeys+=mindex+",";}var unit=this.gridStructureInfo.getUnit(microstrategy.GRIDCELL_AXIS_METRICS,parseInt(temps[0])+1);if(unit!=null){targetIds+=unit.dssId+",";}}}}if(metricKeys.length>0){metricKeys=metricKeys.slice(0,-1);}if(targetIds.length>0){targetIds=targetIds.slice(0,-1);}var defObj=mstrQuickThresholds[index];var _ac=(ac)?ac:[];if(defObj){_ac.push(this.um.createActionObject(this.elem,mstrUpdateManager.CLEAR_THRESHOLDS,beanPath,["111009","111013","111018"],[metricKeys,"0","1"]));var thresholdsSize=defObj.length;for(i=0;i<thresholdsSize;i++){var ct=defObj[i];var applyNow=((thresholdsSize-1)==i)?1:0;var event=null;var ids=["111002","111003","111004","111005","111007","111008","111009","111010","111013"];var values=[ct.formatProps,ct.replaceType,ct.replaceValue,ct.floor,ct.thresholdType,targetIds,metricKeys,ct.thresholdName,applyNow];if(ct.ceiling!=null&&ct.ceiling.length>0&&ct.floor!=null&&ct.floor.length>0){ids.splice(4,0,"111006");values.splice(4,0,ct.ceiling);}else{if(ct.ceiling!=null&&ct.ceiling.length>0){ids.splice(3,1,"111006");values.splice(3,1,ct.ceiling);}else{if(ct.floor!=null&&ct.floor.length>0){}else{ids=null;values=null;}}}if(ids!=null&&values!=null){event=this.um.createActionObject(this.elem,mstrUpdateManager.ADD_THRESHOLD,beanPath,ids,values);}if(event!=null){_ac.push(event);}}if(ac==null){this.um.add(_ac);}this.applyAddQuickThresholds();return true;}}catch(err){microstrategy.errors.log(err);}return false;};mstrGridReport.prototype.isReportCustomSQL=function(){try{return this.isXDACustomSQLReport;}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.isReportMdxCube=function(){try{return this.isMdxCube;}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.isReportViewReport=function(){try{return this.isViewReport;}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.applyAddQuickThresholds=function(){try{this.um.flushAndSubmitChanges();}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.submitSetPropertyValueAction=function(target,state){this.addAction(this.elem,mstrUpdateManager.SET_PROPERTY_VALUES,this.beanPath,["4146"],["Template Formatting!"+target+"!"+state]);};mstrGridReport.prototype.toggleAttForms=function(){try{this.submitSetPropertyValueAction("LongNames!",this.showAttForms?0:4);}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.toggleMergeHeaders=function(prop){try{var p=prop.substr(10,3);this.submitSetPropertyValueAction("Merge"+((p=="Col")?"Column":"")+"Cells",(this.isFeatureAvailable(microstrategy["FEATURE_CHECK_MERGE_"+p.toUpperCase()+"_HEADER"]))?0:-1);}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.toggleLockHeaders=function(prop){try{var p=prop.substr(9,3)=="Col"?"Column":"Row",lockColHeadersFeature=microstrategy.FEATURE_CHECK_LOCK_COLUMN_HEADERS,lockRowHeadersFeature=microstrategy.FEATURE_CHECK_LOCK_ROW_HEADERS,toggleFeature=(p=="Row"?lockRowHeadersFeature:lockColHeadersFeature),lockSet=this.lockSet,beforeToggle=this.isFeatureAvailable(toggleFeature),state=beforeToggle?0:-1,action;action=this.um.createActionObject(this.elem,mstrUpdateManager.SET_PROPERTY_VALUES,this.beanPath,["4146"],["Template Formatting!Lock"+p+"Headers!"+state],[]);this.um.add([action]);this.setFeature(toggleFeature,!beforeToggle);this.useLockset=this.isFeatureAvailable(lockRowHeadersFeature)||this.isFeatureAvailable(lockColHeadersFeature);iframe.showWaitPage(true);if(lockSet){lockSet.removeQuadrants();delete this.lockSet;}this.initLockHeaders();this.resizeLockSet();this.saveEnabled=true;this.notifySelectionChange("ongridselectionschange");iframe.hideWaitPage();}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.oncolresize=function(bone,cmdId,cmdVal1,cmdVal2){try{if(bone.objId==this.objId){if(bone!=this&&this.isGridBone&&this.colWidths){this.colWidths.oncolresize(cmdId,cmdVal1,cmdVal2);}window.setTimeout("microstrategy.bone('"+bone.id+"').resizeLockSet(true)",1);var _tmp=this.mask&&this.mask.onmaskedobjectresize();}}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.raiseColResizeEvent=function(cmdId,cmdValue1,cmdValue2){this.oncolresize(this,cmdId,cmdValue1,cmdValue2);};mstrGridReport.prototype.initColResize=function(extraColTag){try{this.setupColResize(extraColTag);this.nowrapHiddenColumn();}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.setupColResize=function(extraColTag){try{if(!this.gridTable||!this.isResizable){return ;}this.gridWidthInfo.useExtraColTag=extraColTag;this.colWidths=new mstrColResizeImpl(this.gridTable,"microstrategy.bone('"+this.id+"').colWidths",this);this.colWidths.syncCols();}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.nowrapHiddenColumn=function(){var grid=this.gridTable;this.nowrapHidColOnGrid(grid);if(this.lockSet){var quadrants=this.lockSet.quadrants;for(var i=1;i<quadrants.length;i++){var headerGrid=quadrants[i]&&quadrants[i].firstChild;if(headerGrid){this.nowrapHidColOnGrid(headerGrid);}}}};mstrGridReport.prototype.nowrapHidColOnGrid=function(grid){try{var tbody=grid.getElementsByTagName("TBODY")[0];if(!tbody||grid.style.tableLayout!="fixed"){return ;}var colCount,widths,i;if(!this.colWidths){if(grid.childNodes[0].tagName.toUpperCase()!="COLGROUP"){return ;}var colTags=grid.childNodes[0].childNodes;colCount=colTags.length;widths=[];for(i=0;i<colCount;i++){widths.push(parseInt(colTags[i].style.width,10));}}else{colCount=this.colWidths.colCount;widths=this.colWidths.widths;}var j,row,cell,currentIndex,colspan,cellWidth;for(i=0;i<tbody.rows.length;i++){row=tbody.rows[i];currentIndex=colCount-1;colspan=0;for(j=row.cells.length-1;j>=0;j--){cell=row.cells[j];colspan=cell.getAttribute("colspan")||1;if(colspan>1){cellWidth=0;for(k=0;k<colspan;k++){cellWidth+=widths[currentIndex];currentIndex--;}if(cellWidth<=0){cell.className=cell.className+" nwFixedWidth0";}}else{if(widths[currentIndex]<=0){cell.className=cell.className+" nwFixedWidth0";}currentIndex--;}}}}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.processGridFormattingProperties=function(formatValue){try{var um=this.um;var ac=[];var propValue=null;var format=mstrFormatObject;var localStyleName=this.styleName;var weight3Dprocessed=false;for(var i=0;i<formatValue.length;i++){var oneFormat=formatValue[i].split("|");var newFormatId=oneFormat[0];var newFormatValue=oneFormat[1];var argID="",argValue="",evtID="";var extraArgID=null;var extraArgValue=null;var selectedUnits=this.selections.getSelectedGridTargetGridLevel();for(var sunit in selectedUnits){var temps=selectedUnits[sunit].split(",");var axis=temps[0];var position=temps[1];var unit=temps[2];var level=temps[3];if(unit==2){position=axis;axis="0";}var aa=[];var gfp={Name:["4042"],Size:["4045","fontSize"],Color:["4048","color"],Bold:["4043"],Italic:["4044"],Underline:["4047"],Strikeout:["4046"]};if(!!gfp[newFormatId]){evtID=mstrUpdateManager.SAVE_GRID_FONT_PROPERTIES;aa=gfp[newFormatId];}else{var gap={Horizontal:["4056"],Vertical:["4057"],TextWrap:["4058"],TextDirection:["4222"],LeftPadding:["4223"],TopPadding:["4224"],RightPadding:["4225"],BottomPadding:["4226"]};if(!!gap[newFormatId]){evtID=mstrUpdateManager.SAVE_GRID_ALIGNMENT_PROPERTIES;aa=gap[newFormatId];}else{var gbp={TopColor:["4067","borderTopColor"],LeftColor:["4068","borderLeftColor"],BottomColor:["4069","borderBottomColor"],RightColor:["4070","borderRightColor"],TopStyle:["4061"],LeftStyle:["4062"],BottomStyle:["4063"],RightStyle:["4064"],b3dweight:["4222"],b3dstyle:["4223"]};if(!!gbp[newFormatId]){evtID=mstrUpdateManager.SAVE_GRID_BORDER_PROPERTIES;aa=gbp[newFormatId];}else{var gnp={Category:["4050"],DecimalPlaces:["4051"],ThousandSeparator:["4052"],CurrencySymbol:["4053"],CurrencyPosition:["4054"],NegativeNumbers:["4111"],Format:["4055"]};if(!!gnp[newFormatId]){evtID=mstrUpdateManager.SAVE_GRID_NUMBER_PROPERTIES;aa=gnp[newFormatId];}else{var gpp={FillColor:["4071"]};if(!!gpp[newFormatId]){evtID=mstrUpdateManager.SAVE_GRID_PATTERN_PROPERTIES;aa=gpp[newFormatId];extraArgID="4224";if(!newFormatValue||newFormatValue==""){aa[1]="backgroundColor";extraArgValue="1";}else{if(newFormatValue.indexOf(",")<0){aa[1]="backgroundColor";extraArgValue="0";}else{extraArgValue="2";}}}}}}}argID=aa[0];argValue=!aa[1]?newFormatValue:format.encodeValue(aa[1],newFormatValue);if(evtID!=""){var ids=["4006","4007","4109","4108",argID,"4126"];var values=[axis,position,level,unit,argValue,localStyleName];if(argID=="4071"){ids=ids.concat(extraArgID);values=values.concat(extraArgValue);if(newFormatValue.indexOf&&newFormatValue.indexOf(",")>=0){var gradientInfo=this.convertGradientInfo(newFormatValue);argValue=format.encodeValue("backgroundColor",argValue);values[4]=argValue;ids=ids.concat(this.gradientColorId,this.gradientAngleId,this.gradientXOffsetId,this.gradientYOffsetId);values=values.concat(gradientInfo[this.gradientColorId],gradientInfo[this.gradientAngleId],gradientInfo[this.gradientXOffsetId],gradientInfo[this.gradientYOffsetId]);}}else{if(argID=="4223"){var bgcolor=mstr.utils.Color.hex2rgb("#FFFFFF");var bottomright=mstr.utils.Color.get3DBorderColor(bgcolor,"dark");var topleft=mstr.utils.Color.get3DBorderColor(bgcolor,"light");if(argValue!="1"){var temp=topleft;topleft=bottomright;bottomright=temp;}topleft=format.encodeValue("borderTopColor2",topleft);bottomright=format.encodeValue("borderBottomColor2",bottomright);ids.splice(5,1,"4229","4231","4230","4232");values.splice(5,1,topleft,topleft,bottomright,bottomright);}}ac.push(um.createActionObject(this.elem,evtID,this.beanPath,ids,values,[],[]));localStyleName="";}}}if(ac.length>0){um.add(ac);if(!this.useClientSideManipulations){um.flushAndSubmitChanges();}}}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.processSingleFormattingProperty=function(cmdId,cmdValue){if(this.graphSelected){if(this.processSingleFormattingPropertyGraph){this.processSingleFormattingPropertyGraph(cmdId,cmdValue);}else{var graphBone=microstrategy.bone(this.id+"_gb");graphBone.graphFontStyle=this.graphFontStyle;graphBone.selectedGraphTargetValue=this.selectedGraphTargetValue;if(graphBone.processSingleFormattingPropertyGraph){graphBone.processSingleFormattingPropertyGraph(cmdId,cmdValue);}}}else{var isEmpty=true;for(var s in this.selections.selectedUnits){isEmpty=false;break;}if(isEmpty){this.setGridUnitSelections(this.gridUnitFormat,this.gridValueFormat);}this.processSingleFormattingPropertyGrid(cmdId,cmdValue);}};mstrGridReport.prototype.processSingleFormattingPropertyGrid=function(cmdId,cmdValue){try{var commonArgs=["4006","4007","4108","4109","4126"];var item={n:cmdId,v:cmdValue};var ac=[];if(cmdId in this.toolbarFormatMap){item.n=this.toolbarFormatMap[cmdId];}switch(cmdId){case"IncreaseDecimal":case"DecreaseDecimal":case"Currency":case"IntlCurrency":case"Percent":case"Comma":if(cmdId.indexOf("Decimal")>-1){item.n="409606611";item.v=(cmdId.indexOf("Increase")>-1)?1:-1;}else{var index=1;if(cmdId=="Percent"){index++;}else{if(cmdId=="Comma"){index=index+2;}}item.n=String(409606611+index);item.v=1;}break;}this.saveGridFormattingChange(commonArgs,item,ac);if(ac.length>0){this.um.add(ac);this.um.flushAndSubmitChanges();}}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.saveGridFormattingChange=function(baseIds,item,ac){try{var selections=[];var evtId="";if(item.m){var target=this.resolveGridTargetProperties(item.m);selections=[[target.axis,target.position,target.unit,target.level,this.styleName]];}else{var localStyleName=this.styleName;var selectedUnits=this.selections.getSelectedGridTargetGridLevel();for(var unit in selectedUnits){selections.push(selectedUnits[unit].split(",").concat(localStyleName));localStyleName="";}}var fm=this.getGridFormatMap();var pArg=fm.getArgId(item.n)||item.n;var pValue=fm.encode(item.n,item.v);if(!pValue&&isNaN(pValue)){pValue=item.v;}var borderMap={1:{i:0},2:{i:2},4:{i:1},8:{i:3}};for(var i=0,cnt=selections.length;i<cnt;i++){var itemIds=[].concat(baseIds);var itemVals=[].concat(selections[i]);switch(item.n){case"backgroundColor":case"Gradient":evtId=mstrUpdateManager.SAVE_GRID_PATTERN_PROPERTIES;itemIds=itemIds.concat("4224");if(item.n.indexOf("Gradient")>-1||item.v.indexOf(",")>-1){itemVals=itemVals.concat("2");itemIds=itemIds.concat([4071,4225,4226,4229,4230]);itemVals=itemVals.concat(pValue);}else{itemVals=itemVals.concat((item.v=="transparent")?"1":"0");if(item.v=="transparent"&&item.n=="backgroundColor"){pValue=null;}}break;case"fontFamily":case"fontSize":case"color":case"fontWeight":case"fontStyle":case"textDecoration":case"textDecoration2":evtId=mstrUpdateManager.SAVE_GRID_FONT_PROPERTIES;break;case"Category":case"DecimalPlaces":case"CurrencySymbol":case"CurrencyPosition":case"NegativeNumbers":case"ThousandSeparator":case"Format":evtId=mstrUpdateManager.SAVE_GRID_NUMBER_PROPERTIES;break;case"GridHorizontal":case"Vertical":case"Vertical2":case"TextWrap":case"TextDirection":case"paddingLeft":case"paddingTop":case"paddingRight":case"paddingBottom":evtId=mstrUpdateManager.SAVE_GRID_ALIGNMENT_PROPERTIES;break;case"409606611":case"409606612":case"409606613":case"409606614":evtId=mstrUpdateManager.NUMBER_FORMAT;break;case"borders":case"lncolor":case"lnstyle":pArg=null;pValue=null;evtId=mstrUpdateManager.SAVE_GRID_BORDER_PROPERTIES;var baseStyle=4061;var baseColor=4067;var memo=this.convertSelectToUnitMemo(selections[i]);var w,j,delta;var borders=["Top","Left","Bottom","Right"];if(item.n=="borders"){delta=item.v[0];var side=parseInt(delta.v[0],10);if(side==0){w=0;}else{if(side==16){w=1;}else{w=(delta.cl)?1:0;for(j=0;j<4;j++){if(borderMap[side].i!=j){borders[j]=null;}}}}}var bs,bc;for(j=0;j<4;j++){if(!borders[j]){continue;}itemIds.push(String(baseStyle+j));itemIds.push(String(baseColor+j));bs=borders[j]+"Style";bc=borders[j]+"Color";if(item.n=="lncolor"){itemVals.push(this.getGridFormatValue(memo,bs,false));itemVals.push(fm.encode(bc,item.v));this.setGridFormatValue(memo,bc,item.v);}else{if(item.n=="borders"){itemVals.push(String(w));this.setGridFormatValue(memo,bs,w);}else{w=this.getGridFormatValue(memo,bs,true);if(w>0){this.setGridFormatValue(memo,bs,parseInt(item.v,10));itemVals.push(item.v);}else{itemVals.push(w);}}itemVals.push(fm.encode(bc,this.getGridFormatValue(memo,bc,false)));}}break;default:continue;}if(pArg!=null&&pValue!=null){itemIds.push(pArg);itemVals.push(pValue);}var bp=this.bp[evtId]||this.beanPath;this.packageGridFormat(ac,evtId,itemIds,itemVals,bp,this.convertSelectToUnitMemo(selections[i]),item.n,item.v);}}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.isSelectionUnit=function(index){try{return(index>=this.nonUnitCount);}catch(err){microstrategy.errors.log(err);return false;}};mstrGridReport.prototype.resolveGridTargetProperties=function(memo){try{var a;var p;var u;var l=parseInt(memo.format);if(this.isSelectionUnit(memo.unit)){var unit=this.getSelectedGridUnitByIndex(memo.unit);if(unit){a=Math.max(unit.axis,0);p=(a==0)?unit.depth-1:unit.depth;u=(a==0)?2:1;}}else{a=0;p=0;u=parseInt(memo.unit);switch(u){case microstrategy.GRID_BORDERS:u=2;l=6;break;case mstrGridReport.ALL_UNITS:p=-9999;u=7;break;case mstrGridReport.ROW_UNITS:a=1;u=3;break;case mstrGridReport.COL_UNITS:a=2;u=4;break;case mstrGridReport.METRIC_UNITS:p=-999;u=6;break;}}return{axis:a,position:p,unit:u,level:l};}catch(err){microstrategy.errors.log(err);return null;}};mstrGridReport.prototype.convertSelectToUnitMemo=function(selection){try{var p=parseInt(selection[1],10);var obj={unit:-1,format:parseInt(selection[3],10)};switch(p){case -9999:obj.unit=mstrGridReport.ALL_UNITS;break;case -999:obj.unit=mstrGridReport.METRIC_UNITS;break;case -99:obj.unit=microstrategy.GRID_BORDERS;break;default:var a=parseInt(selection[0],10);if(p==0&&a!=0){obj.unit=(parseInt(selection[2],10)==3)?mstrGridReport.ROW_UNITS:mstrGridReport.COL_UNITS;}else{if(a<1){p++;}obj.unit=this.resolveGridUnitId(a,p);}break;}return obj;}catch(err){microstrategy.errors.log(err);return{};}};mstrGridReport.prototype.packageGridFormat=function(ac,id,argIds,argValues,bp,memo,pName,pValue){try{ac.push(this.um.createActionObject(this.elem,id,bp||this.beanPath,argIds,argValues,[],[]));this.setGridFormatValue(memo,pName,pValue);}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.getCellsWithAttr=function(prop,value){var cells=[],oTables=this.elem.getElementsByTagName("table")[0];if(oTables){cells=microstrategy.findChildrenWithAtt(oTables,"td",prop,value)||[];}return cells;};mstrGridReport.prototype.findAllCells=function(gridUnit,level,inclIDAttrCells){try{var result=[];var oTables=this.elem.getElementsByTagName("table")[0];var unitPos=gridUnit.axis+","+gridUnit.depth;if(gridUnit.subtype==microstrategy.SUBOBJTYPE_METRIC){unitPos=microstrategy.GRIDCELL_AXIS_METRICS+","+parseInt(gridUnit.depth);}var cells=microstrategy.findChildrenWithAtt(oTables,"td",microstrategy.HTMLATTR_GRID_UNIT_POS,unitPos)||[];if(!cells||cells.length==0||inclIDAttrCells){var cellId=((gridUnit.axis==-1)?0:gridUnit.axis)+"A"+gridUnit.depth;cells=cells.concat(microstrategy.findChildrenWithAtt(oTables,"td",microstrategy.HTMLATTR_GRIDCELL_ID,cellId));}for(var i in cells){if(this.gridStructureInfo.getCellType(cells[i])==level){result.push(cells[i]);}}return result;}catch(err){microstrategy.errors.log(err);return false;}};mstrGridReport.prototype.setGridProp=function(propSetName,propName,value,featureName,ac,applyStyle){try{var propString=propSetName+"!"+propName+"!"+value;var um=this.um;var ids=["4146"];var values=[propString];if(applyStyle&&this.styleName&&this.styleName.length>0){ids.splice(1,0,"4126");values.splice(1,0,this.styleName);}ac.push(um.createActionObject(this.elem,mstrUpdateManager.SET_PROPERTY_VALUES,this.beanPath,ids,values,[]));if(featureName&&featureName.length>0){var featureValue=(value=="-1")?true:false;this.setFeature(featureName,featureValue);}}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.setReportProp=function(propSetName,propName,value,ac){try{var propString="1!"+propSetName+"!"+propName+"!"+value;ac.push(this.um.createActionObject(this.elem,mstrUpdateManager.SET_REPORT_PROPERTY_VALUES,this.beanPath,["4146"],[propString],[]));}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.processGridPropertyChanges=function(propName,propValue,ac){try{if(this.selections){this.selections.clearAll(true);}if(this.getDocSelections&&this.getDocSelections()){this.getDocSelections().add(this.activeRWUnit,true,true);}var updateEditorProps=false;var fn=function(s){return microstrategy["FEATURE_CHECK_"+s];};switch(propName){case"RHS":case"CHS":case"RHM":case"CHM":case"RHL":case"CHL":case"Outline":case"AttForms":case"TitleOverlap":var pm={RHS:{p:"ShowRowHeaders"},CHS:{p:"ShowColumnHeaders"},RHM:{p:"MergeCells",f:fn("MERGE_ROW_HEADER")},CHM:{p:"MergeColumnCells",f:fn("MERGE_COL_HEADER")},RHL:{p:"LockRowHeaders",f:fn("LOCK_ROW_HEADERS")},CHL:{p:"LockColumnHeaders",f:fn("LOCK_COLUMN_HEADERS")},Outline:{p:"Indented",f:fn("OUTLINE_MODE")},AttForms:{p:"LongNames"},TitleOverlap:{p:"TitleOverlapViewMode"}};var po=pm[propName];po.f=po.f||"";this.setGridProp("Template Formatting",po.p,propValue,po.f,ac,false);updateEditorProps=true;break;case"HideNullZeroValues":this.setGridProp("AnalyticalEngineProperties","HideNullZeroValues",propValue,"",ac,false);break;case"HideNullsOrZeros":this.setGridProp("AnalyticalEngineProperties","ShowAllRows",propValue,"",ac,false);break;case"ExecutionFullScreenMode":this.setReportProp("WebProperties","ExecutionFullScreenMode",propValue,ac);break;case"View":this.setReportProp("Mobile","View",propValue,ac);break;case"EnableBookStylePagebyNavigation":this.setGridProp("Mobile",propName,propValue,"",ac,false);break;case"EnableZoom":this.setReportProp("Mobile","EnableZoom",propValue,ac);break;case"EnableCopyForGridCell":this.setReportProp("Mobile","EnableCopyForGridCell",propValue,ac);break;case"Banding":updateEditorProps=true;this.handleBanding(propValue,ac);break;case"ShowThreshold":updateEditorProps=true;this.displayThresholds(propValue,ac);break;case"DrillOptions":updateEditorProps=true;var that=this;var sgp=function(opt,v){that.setGridProp("GeneralTemplateProperties","Drilling"+opt,v,"",ac,false);};sgp("Options",propValue);var enableDrilling=microstrategy.TRUE;if(propValue==0){enableDrilling=microstrategy.FALSE;}sgp("EnableRWDDrilling",enableDrilling);sgp("EnableReportDrilling",enableDrilling);if(mstr.$obj("dcmmID")){mstr.$obj("dcmmID").clearMenuItems(this.objId);}break;case"assoNodesDrill":var manipCat={assoNodesDrill:"1"}[propName];this["associatedNodes"]=this["associatedNodes"]||{};this["associatedNodes"][manipCat]=propValue.split(CLIPBOARD_ITEM_SEPARATOR);break;case"subtotalDisplayrowSec":case"subtotalDisplaycolSec":case"subtotalDisplaypageSec":var stm={subtotalDisplayrowSec:"ROWS",subtotalDisplaycolSec:"COLUMNS",subtotalDisplaypageSec:"PAGE_BY"};this.setSubtotalDisplayOption(microstrategy["GRIDCELL_AXIS_"+stm[propName]],propValue,ac);break;case"setSubtotalAxisStyle":this.setSubtotalAxisStyle(propValue,ac);break;case"setSubtotalSelectedUnit":this.setSubtotalSelectedUnit(propValue,ac);break;case"disableSubtotal":this.disableSubtotal(propValue,ac);break;case"DefaultViewMode":this.setViewMedia(null,propValue,ac);break;case"AvailableViewModes":if(propValue.indexOf(",")>0){var v=propValue.split(",");this.setViewMedia("",null,ac,v[0],v[1]);}else{this.setViewMedia(propValue,null,ac);}break;case"MakePrivate":if(propValue!=="0"){this.setViewMedia("",null,ac,mstr.Enum.VIEWMEDIA.PRIVATE);}else{this.setViewMedia("",null,ac,null,mstr.Enum.VIEWMEDIA.PRIVATE);}break;case"ControlGroupByList":this.setControlGroupByList(propValue,ac);break;case"GraphExportOverflow":case"GraphExportOverflowSpacing":this.xgovf=propValue;var v=(propName=="GraphExportOverflow")?"":"Spacing";this.setGridProp("GraphInfo","RepeatGraph"+v,propValue,"",ac,false);break;case"IfRowMode":updateEditorProps=true;this.setGridProp("GeneralTemplateProperties","IFRowMode",propValue,"",ac,false);break;case"IfMaxRows":updateEditorProps=true;this.setGridProp("GeneralTemplateProperties","IFMaxRows",propValue,"",ac,false);break;case"IfColMode":updateEditorProps=true;this.setGridProp("GeneralTemplateProperties","IFColumnMode",propValue,"",ac,false);break;case"IfMaxCols":updateEditorProps=true;this.setGridProp("GeneralTemplateProperties","IFMaxColumns",propValue,"",ac,false);break;}if(updateEditorProps&&this.editorProperties){this.editorProperties[propName]=propValue;}microstrategy.eventManager.notifyOrphanBones("onpropertychange");}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.setControlGroupByList=function(value,ac){try{var finalOrder="";for(var i=0,cnt=value.length;i<cnt;i++){finalOrder+=(i>0)?"!":"";finalOrder+=value[i].dssid;}this.addAction(this.elem,mstrUpdateManager.RW_REORDER_CONTROL_GROUP_BY,this.beanPath,["2048012","2048173"],[this.objId,finalOrder],ac);this.ControlGroupByList=value;}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.setViewMedia=function(avModes,defMode,ac,addViewMedia,removeViewMedia){try{if(avModes==null){avModes="";}if(defMode==null){defMode="";}this.addAction(this.elem,mstrUpdateManager.SET_REPORT_VIEW_MEDIA,this.beanPath,["4228","4229","4243","4244"],[avModes,defMode,addViewMedia||"",removeViewMedia||""],ac);}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.hiliteObj=function(obj,opacity,cssClassName){try{var className=obj.className;var spaceIndex=className.lastIndexOf(" ");if(spaceIndex>-1){obj.className=className.substr(0,spaceIndex);}if(cssClassName.length>0){obj.className+=" "+cssClassName;}if(bIsIE6){setFilter(obj,"Alpha",{opacity:opacity*100});}else{if(bIsW3C){obj.style.MozOpacity=opacity;}}}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.restoreHiliteIfCurrent=function(obj){try{if(this.hiliteCell){for(var i in this.hiliteCell){if(this.hiliteCell[i]==obj){this.hiliteObj(obj,mstrGridReport.OPACITY_SELECTED,mstrGridReport.SELECTOR_HILITE_CLASS);return true;}}return false;}}catch(err){microstrategy.errors.log(err);}return false;};mstrGridReport.prototype.hiliteIfNotCurrent=function(anchorObj,opacity,bgImg){try{if(anchorObj){var elemTD=microstrategy.findAncestorWithTag(anchorObj,"TD");if(this.hiliteCell){for(var i in this.hiliteCell){if(this.hiliteCell[i]==elemTD){return ;}}elemTD.className=elemTD.className.replace(bgImg,"")+" "+bgImg;}}}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.mouseOverSelector=function(anchorObj){try{this.hiliteIfNotCurrent(anchorObj,mstrGridReport.OPACITY_MOUSE_OVER,mstrGridReport.SELECTOR_MOUSE_OVER_CLASS);}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.mouseOutSelector=function(anchorObj){try{this.hiliteIfNotCurrent(anchorObj,mstrGridReport.OPACITY_MOUSE_OUT,mstrGridReport.SELECTOR_MOUSE_OUT_CLASS);}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.processHL=function(axis,position,oTarget,linkIndex){try{var parentElemsIndex=[];var pfvix;if(oTarget){var peix=oTarget.getAttribute("peix")||oTarget.parentNode.getAttribute("peix");parentElemsIndex.push(this.parsePeix(peix));pfvix=this.parsePfvix(oTarget.getAttribute("pfvix")||oTarget.parentNode.getAttribute("pfvix"));}this.execHL(axis,position,parentElemsIndex,linkIndex,pfvix);}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.executeCMHyperLink=function(axis,position,linkIndex){try{var CMTargets=this.selections.getItems();var parentElemsIndices=[];if(CMTargets!=null){var aux={};for(var i=0,len=CMTargets.length;i<len;i++){var peix=CMTargets[i].getAttribute("peix");if(!aux[peix]){aux[peix]=true;parentElemsIndices.push(this.parsePeix(peix));}}}var src=microstrategy.activeCXMenu;var pfvix=this.parsePfvix(src&&src.getAttribute("pfvix"));this.execHL(axis,position,parentElemsIndices,linkIndex,pfvix);}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.parsePeix=function(peix){return this.parsePix(peix,true);};mstrGridReport.prototype.parsePfvix=function(pfvix){return this.parsePix(pfvix,false);};mstrGridReport.prototype.parsePix=function(pix,hasCurrAtt){try{var res={};res.elements=[];if(pix){var parentIndex=pix.split("_");for(var ix=0,cnt=parentIndex.length;ix<cnt;ix++){var pixBits=parentIndex[ix].split(":");res.elements[pixBits[0]]=pixBits[1];if(ix==0&&hasCurrAtt){res.currAtt=pixBits[0];}}}return res;}catch(err){microstrategy.errors.log(err);return null;}};mstrGridReport.prototype.getElementId=function(attrIndex,parentElemsIndex){try{if(attrIndex>=0){var attrInfo=this.attMap[attrIndex];var eIx;eIx=(attrInfo.isPageBy)?0:parentElemsIndex.elements[attrIndex];if(eIx>=0){return attrInfo.elementMap[eIx];}}}catch(err){microstrategy.errors.log(err);}return null;};mstrGridReport.prototype.getFormId=function(attrIndex,parentFormValueIndex){try{if(attrIndex>=0){var attrInfo=this.formMap[attrIndex];var eIx;eIx=(attrInfo.isPageBy)?0:parentFormValueIndex.elements[attrIndex];if(eIx>=0){return attrInfo.elementMap[eIx];}}}catch(err){microstrategy.errors.log(err);}return null;};mstrGridReport.prototype.execHL=function(axis,position,parentElemsIndex,linkIndex,pfvix){try{var linkDetails=this.linkMap[axis][position][0];var linkArray=linkDetails.links;var linkInfo=linkArray[linkIndex];linkInfo=linkInfo?linkInfo:linkArray[linkDetails.def];if(linkInfo){if(this.selections){this.selections.clearAll(true);}this[!linkInfo.url?"execDynamiclLink":"execUrlLink"](linkDetails,linkInfo,parentElemsIndex,pfvix);}}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.execLinkDrill=function(axis,position,elems,linkIndex){try{var linkDetails=this.linkMap[axis][position][0];var linkArray=linkDetails.links;var linkInfo=linkArray[linkIndex];linkInfo=linkInfo?linkInfo:linkArray[linkDetails.def];if(linkInfo){var elemIds={};for(var i=0;(elems!=null)&&i<elems.length;i++){elemIds[elems[i].id]=elems[i].ans;}if(i>0){elemIds.nAns=elems[0].ans.length;}var xml=this.buildLinkXml(linkDetails,linkInfo,null,null,elemIds);microstrategy.execDynamiclLink(linkInfo,xml,linkDetails&&linkDetails.nw);}}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.getLinkMap=function(){try{return this.linkMap;}catch(err){microstrategy.errors.log(err);return null;}};mstrGridReport.prototype.execUrlLink=function(linkDetails,linkInfo,parentElemsIndex){try{var oForm=null;var url=linkInfo.url;if(url.indexOf("&CurrentElement")>-1&&parentElemsIndex){var index=parentElemsIndex[0]?parentElemsIndex[0]:parentElemsIndex;var eltId=this.getElementId(index.currAtt,index);url=linkInfo.url.replace("&CurrentElement",eltId);}oForm=createDynamicForm(url);if(linkDetails.nw){oForm.target="_blank";}microstrategy.submitForm(oForm);return ;}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.execDynamiclLink=function(linkDetails,linkInfo,parentElemsIndex,pfvix){try{var xml=this.buildLinkXml(linkDetails,linkInfo,parentElemsIndex,pfvix);microstrategy.execDynamiclLink(linkInfo,xml,linkDetails&&linkDetails.nw);}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.buildLinkXml=function(linkDetails,linkInfo,parentElemsIndex,pfvix,linkAnswers){try{var axa=function(m,n){return microstrategy.addXmlAttr(m,n);};var axae=function(m,n){return microstrategy.addXmlAttrEncoded(m,n);};var xml="<hl"+axa("mid",linkInfo.msg)+axa("srct",microstrategy.EXECUTION_SCOPE)+axa("aopam",linkInfo.daMode)+">";var answers=linkInfo.ans;if(answers!=null){xml+="<prms>";for(var i=0,cnt=answers.length;i<cnt;i++){var answer=answers[i];var pid=answer.pid;var aty=answer.aty;var pty=answer.pty;var statValues=answer.values;var statDisplayNames=answer.dispNames;xml+="<prm"+axa("id",pid)+axa("am",aty);if(answer.orId){xml+=axa("orid",answer.orId)+axa("ortp",answer.orTp);if(pty==mstrGridReport.CONSTANT_PROMPT_TYPE&&aty==mstrGridReport.DYNAMIC&&answer.bfi){xml+=axa("pt",pty)+axa("bfi",answer.bfi);}}xml+=">";var ei=null;var dynAttrs=null;var attrI=null;var attrInfo=null;switch(aty){case mstrGridReport.DO_NOT_ANSWER:case mstrGridReport.CLOSE:case mstrGridReport.USE_DEFAULT_ANSWER:case mstrGridReport.SAME_PROMPT:break;case mstrGridReport.STATIC:if(statValues!=null){xml+='<pa ia="1"><es>';for(var statCt=0;statCt<statValues.length;statCt++){xml+="<e"+axa("ei",statValues[statCt])+axae("disp_n",statDisplayNames[statCt])+axa("emt","1")+"/>";}xml+="</es></pa>";}break;case mstrGridReport.DYNAMIC:case mstrGridReport.DYNAMIC_OR_SAME_PROMPT:dynAttrs=answer.attrs;if(dynAttrs!=null&&dynAttrs.length==1){attrI=dynAttrs[0];xml+='<pa ia="1">';if(pty==mstrGridReport.CONSTANT_PROMPT_TYPE&&pfvix){attrInfo=this.formMap[attrI];var form=this.getFormId(attrI,pfvix);if(form){xml+=mstr.utils.String.encodeXMLAttribute(mstr.utils.String.decodeHtmlString(form,false));}}else{if(linkAnswers){attrInfo=this.attMap[attrI];xml+="<es "+axa("dispForms",attrInfo?attrInfo.displayFormsMap:"")+">";var att=linkAnswers[attrInfo.id];for(var elId=0;att&&elId<att.length;elId++){ei=att[elId];if(!ei){continue;}xml+="<e"+axae("ei",ei)+axa("emt","1")+"/>";}xml+="</es>";}else{if(parentElemsIndex){attrInfo=this.attMap[attrI];xml+="<es "+axa("dispForms",attrInfo?attrInfo.displayFormsMap:"")+">";for(var elId=0;parentElemsIndex!=null&&elId<parentElemsIndex.length;elId++){var peIndex=parentElemsIndex[elId];ei=this.getElementId(attrI,peIndex);if(!ei){continue;}xml+="<e"+axae("ei",ei)+axa("emt","1")+"/>";}xml+="</es>";}}}xml+="</pa>";}break;case mstrGridReport.ALL_VALID_UNITS:dynAttrs=answer.attrs;if(dynAttrs!=null&&dynAttrs.length>0&&(parentElemsIndex||linkAnswers)){xml+='<pa ia="1"><attGroups>';if(linkAnswers){for(var elId=0;elId<linkAnswers.nAns;elId++){xml+="<attGroup>";for(var dynCt=0;dynCt<dynAttrs.length;dynCt++){attrI=dynAttrs[dynCt];attrInfo=this.attMap[attrI];if(!linkAnswers[attrInfo.id]){continue;}ei=linkAnswers[attrInfo.id][elId];if(!ei){continue;}xml+="<a"+axa("id",attrInfo.id)+axae("n",attrInfo.n)+"><es "+axa("dispForms",attrInfo.displayFormsMap)+"><e"+axae("ei",ei)+axa("emt","1")+"/></es></a>";}xml+="</attGroup>";}}else{for(var elId=0;parentElemsIndex!=null&&elId<parentElemsIndex.length;elId++){xml+="<attGroup>";var peIndex=parentElemsIndex[elId];for(var dynCt=0;dynCt<dynAttrs.length;dynCt++){attrI=dynAttrs[dynCt];attrInfo=this.attMap[attrI];ei=this.getElementId(attrI,peIndex);if(!ei){continue;}xml+="<a"+axa("id",attrInfo.id)+axae("n",attrInfo.n)+"><es "+axa("dispForms",attrInfo.displayFormsMap)+"><e"+axae("ei",ei)+axa("emt","1")+"/></es></a>";}xml+="</attGroup>";}}xml+="</attGroups></pa>";}break;case mstrGridReport.CURRENT_UNIT:dynAttrs=answer.attrs;if(dynAttrs!=null&&dynAttrs.length==1&&(parentElemsIndex||linkAnswers)){attrI=dynAttrs[0];attrInfo=this.attMap[attrI];xml+='<pa ia="1">';xml+="<a"+axa("id",attrInfo.id)+axae("n",attrInfo.n)+">";xml+="<es "+axa("dispForms",attrInfo.displayFormsMap)+">";if(linkAnswers){for(var elId=0;linkAnswers[attrInfo.id]&&elId<linkAnswers[attrInfo.id].length;elId++){ei=linkAnswers[attrInfo.id][elId];if(ei){xml+="<e"+axae("ei",ei)+axa("emt","1")+"/>";}}}else{for(var elId=0;elId<parentElemsIndex.length;elId++){ei=this.getElementId(attrI,parentElemsIndex[elId]);if(ei){xml+="<e"+axae("ei",ei)+axa("emt","1")+"/>";}}}xml+="</es>";xml+="</a></pa>";}break;}xml+="</prm>";}xml+="</prms>";}xml+="</hl>";return xml;}catch(err){microstrategy.errors.log(err);return null;}};mstrGridReport.prototype.applySelector=function(unitID,controlKey,elementsList,targetKeys,usePartialDisplay,controlKeyContext,anchorObj,ac){try{this.hiliteControlElem(anchorObj,controlKey);var controlInfo=this.controlLinks&&this.controlLinks[unitID];if(controlInfo){targetKeys=this.getVisibleTargets(controlInfo);}var isUConDS=controlInfo&&controlInfo.dsTargets&&controlInfo.dsTargets.length>0;var usePartialDisplay=isUConDS?"0":usePartialDisplay;this.addAction(null,mstrUpdateManager.SET_CUR_CTL_ELEMENTS,this.docViewer.beanPath,["2048130","2048127","2048137","2048138","2048018"],[controlKey,elementsList,controlKeyContext,usePartialDisplay,"false"],ac);}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.hiliteControlElem=function(anchorObj,controlKey){try{var hc=this.hiliteCell;if(hc[controlKey]){this.hiliteObj(hc[controlKey],mstrGridReport.OPACITY_MOUSE_OUT,mstrGridReport.SELECTOR_MOUSE_OUT_CLASS);if(hc.filter){hc[controlKey].style.filter=hc.filter;}}if(anchorObj){var elemTD=microstrategy.findAncestorWithTag(anchorObj,"TD");if(elemTD){hc[controlKey]=elemTD;hc.filter=getFilter(elemTD);this.hiliteObj(elemTD,mstrGridReport.OPACITY_SELECTED,mstrGridReport.SELECTOR_HILITE_CLASS);}}}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.getVisibleTargets=function(controlInfo){try{var targetKeys="";if(controlInfo.gbTargets){controlInfo.targets=[];if(this.docViewer.targetGroupBys){for(var i=0,cnt=controlInfo.gbTargets.length;i<cnt;++i){var targetKey=this.docViewer.targetGroupBys[controlInfo.gbTargets[i]];if(targetKey){controlInfo.targets.push(targetKey);}}}delete controlInfo.gbTargets;}if(controlInfo.targets){for(var i=0,cnt=controlInfo.targets.length;i<cnt;++i){if(mstrDocImpl.shallRenderTarget(controlInfo.targets[i])){if(i>0){targetKeys+=CLIPBOARD_ITEM_SEPARATOR;}targetKeys+=controlInfo.targets[i];}}}return targetKeys;}catch(err){microstrategy.errors.log(err);return null;}};mstrGridReport.prototype.sliceMetric=function(anchorObj,metricID){try{var controlInfo=this.controlLinks&&this.controlLinks.Metrics;if(!controlInfo){return ;}var controlKey=controlInfo.ck;this.hiliteControlElem(anchorObj,controlKey);var targets=this.getVisibleTargets(controlInfo);this.addAction(null,mstrUpdateManager.SET_CUR_CTL_ELEMENTS,this.docViewer.beanPath,["2048130","2048127","2048137","2048138"],[controlKey,metricID,controlInfo.ctxt,controlInfo.partialUpdate],null,!targets);}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.sliceElem=function(anchorObj,axis,position,attIdx,elemIdx){try{var unit=this.gridStructureInfo.getUnit(parseInt(axis),parseInt(position));if(unit!=null){var controlInfo=this.controlLinks&&this.controlLinks[unit.dssId];if(!controlInfo){return ;}var controlKey=controlInfo.ck;this.hiliteControlElem(anchorObj,controlKey);if(attIdx>=0){var attrInfo=this.attMap[attIdx];if(elemIdx>=0){var elementsList=attrInfo.elementMap[elemIdx];var targets=this.getVisibleTargets(controlInfo);var applyNow=targets||(!controlInfo.partialUpdate)?"1":"0";var ac=[];var pbb=microstrategy.bone("pbb_GroupByStyle");var hasAllOnNGB=pbb&&pbb.hasAllSelected;var isUConDS=controlInfo.dsTargets&&controlInfo.dsTargets.length>0;var usePartialUpdate=hasAllOnNGB||isUConDS?"0":controlInfo.partialUpdate;this.addAction(null,mstrUpdateManager.SET_CUR_CTL_ELEMENTS,this.docViewer.beanPath,["2048130","2048127","2048137","2048138","2048018"],[controlKey,elementsList,controlInfo.ctxt,usePartialUpdate,applyNow],ac);this.um.add(ac);if(applyNow){this.um.flushAndSubmitChanges();}}}}}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.processGraphFormattingProperties=function(formatValue){try{var um=this.um;var ac=[];for(var i=0,cnt=formatValue.length;i<cnt;i++){var oneFormat=formatValue[i];var infoArray=null;var eventId=null;var args=[];var argv=[];var formatId=oneFormat[0];var seriesId=null;var targetId=null;var j,cnt2;function _prepareArgs(infoArray){var v=infoArray[0].split("_");args.push("4085");argv.push(v[0]);if(v[1]){args.unshift("4209");argv.unshift(v[1]);}targetId=v[0];}var alphaProperty=null;var fn=function(m,n){args.push("4202");argv.push(m);args.push("4203");if(n){alphaProperty=n;}};switch(formatId){case"formatGraphSetting":eventId=mstrUpdateManager.EDIT_GRAPH_PROPS;infoArray=oneFormat[1];args.push("4085");argv.push(infoArray[0]);args.push("4202");argv.push(infoArray[1]);args.push("4203");argv.push(infoArray[2]);break;case"formatGraphPropertyBulk":case"formatGraphWindowSizeBulk":eventId=mstrUpdateManager.EDIT_GRAPH_PROPS;if(formatId=="formatGraphWindowSizeBulk"){eventId=mstrUpdateManager.EDIT_GRAPH_WINDOW_SIZE;}infoArray=oneFormat[1];for(j=0,cnt2=infoArray.length;j<cnt2;j++){var v=infoArray[j];switch(v[0]){case"major":args.push("4082");this.major=v[1];break;case"minor":args.push("4083");this.minor=v[1];break;case"seriesLayout":args.push("4175");this.seriesLayout=v[1];break;case"showSubtotals":args.push("4176");break;case"useCurvedLines":case"roundedEffect":case"useFontAntiAliasing":var p={useCurvedLines:"804",roundedEffect:"10123",useFontAntiAliasing:"881"}[v[0]];args.push("4085");argv.push("9999");args.push("4202");argv.push(p);args.push("4203");break;case"categories":args.push("4025");this.categories=v[1];break;case"series":args.push("4024");this.series=v[1];break;}if(args.length>argv.length){argv.push(v[1]);}if(eventId!=null){ac.push(um.createActionObject(this.elem,eventId,this.beanPath,args,argv,[],[]));argv=[];args=[];}}eventId=null;break;case"formatGraphObjectBulk":eventId=mstrUpdateManager.EDIT_GRAPH_TEXT_PROPS;infoArray=oneFormat[1];_prepareArgs(infoArray);infoArray=infoArray[1];for(j=0;j<infoArray.length;j++){switch(infoArray[j][0]){case"titleShow":args.push("4084");break;case"titleColor":args.push("4087");break;case"titleFillColor":args.push("4211");break;case"titleName":args.push("4088");break;case"titleStyle":args.push("4089");break;case"titleSize":args.push("4090");break;case"titleContent":args.push("4091");break;case"relativeSize":args.push("4202");argv.push("604");args.push("4203");if(infoArray[j][1]=="1"){infoArray[j][1]=infoArray[j][1]+","+this.graphWidth+","+this.graphHeight;}break;case"titlePosition":args.push("4202");argv.push("644");args.push("4203");break;case"tooltipsShow":args.push("4202");if(seriesId){argv.push("10004");}else{argv.push("10041");}args.push("4203");break;case"tooltipsEditor":args.push("4202");if(seriesId){argv.push("10005");}else{argv.push("10042");}args.push("4203");break;}if(args.length>argv.length){argv.push(infoArray[j][1]);}}break;case"saveGraphProperties":var alphaValue=255;eventId=mstrUpdateManager.EDIT_GRAPH_PROPS;infoArray=oneFormat[1];_prepareArgs(infoArray);infoArray=infoArray[1];for(j=0;j<infoArray.length;j++){var v=infoArray[j];switch(v[0]){case"titleGradient":case"titleColorFillEffect":case"titleFillEffect":case"titleTransparency":case"titleContent":var p={titleGradient:"567",titleColorFillEffect:"10002",titleFillEffect:"4203",titleTransparency:"608"}[v[0]]||"9999";fn(p);break;case"titleFillColor":case"titleLineColor":case"titleColor":var q={titleFillColor:["564","608"],titleLineColor:["588","609"],titleColor:["574","610"]}[v[0]];if(seriesId&&targetId=="286"&&v[0]=="titleFillColor"){argv.push("556");}fn(q[0],q[1]);break;}if(args.length>argv.length){argv.push(v[1]);}if((v[0]=="titleFillColor"||v[0]=="titleLineColor"||v[0]=="titleColor")&&(v[1]=="-1"||v[1]=="transparent")){alphaValue=0;eventId=null;}if(alphaProperty){if(!seriesId){seriesId="-1";}ac.push(um.createActionObject(this.currentArea,mstrUpdateManager.EDIT_GRAPH_PROPS,this.beanPath,["4085","4209","4202","4203"],[targetId,seriesId,alphaProperty,alphaValue]));}}break;case"formatGraphNumberBulk":eventId=mstrUpdateManager.EDIT_GRAPH_PROPS;infoArray=oneFormat[1];if(!infoArray||infoArray.length==0){return false;}targetId=infoArray[0];attributeId="-616";if(targetId.indexOf("_")>0){_prepareArgs(infoArray);}else{switch(targetId){case"272":case"290":attributeId="618";break;case"531":case"558":case"296":attributeId="619";break;case"302":attributeId="620";break;case"512":case"552":attributeId="621";break;case"10002":attributeId="10077";break;}targetId=targetId=="10002"?targetId:"9999";args.push("4085");argv.push(targetId);}var cat,decPl,thSep,currSep,currSym,currPos,negNum,format;for(j=1;j<infoArray.length;j++){var p=infoArray[j].split("|");var q=p[1];switch(p[0]){case"Category":cat=q+",";break;case"DecimalPlaces":decPl=q+",";break;case"ThousandSeparator":var th=(q>0)?"3":"0";thSep=th+",";break;case"CurrencySymbol":currSym=q+",";break;case"CurrencyPosition":currPos=q+",";break;case"NegativeNumbers":negNum=q+",";break;case"Format":format=q;break;}}args.push("4202");argv.push(attributeId);args.push("4203");argv.push(cat+decPl+thSep+currPos+negNum+currSym+format);break;case"formatGraphColorGradient":eventId=mstrUpdateManager.EDIT_GRAPH_PROPS;infoArray=oneFormat[1];_prepareArgs(infoArray);infoArray=infoArray[1];for(j=0;j<infoArray.length;j++){var v=infoArray[j];if(v[0]=="titleGradient"){fn("567");}else{fn("10002");}if(args.length>argv.length){argv.push(infoArray[j][1]);}}break;case"formatGraphDualAxis":eventId=mstrUpdateManager.EDIT_GRAPH_PROPS;infoArray=oneFormat[1];_prepareArgs(infoArray);argv[argv.length-1]="9999";var prop=infoArray[1];if(prop[0]=="titleSeriesOnAxis"){fn("140");}else{fn("10054");}if(args.length>argv.length){argv.push(prop[1]);}break;case"formatGraphAxisBulk":eventId=mstrUpdateManager.EDIT_GRAPH_AXIS_PROPS;infoArray=oneFormat[1];var m={gShow_318:"4096",gShow_325:"4099",gShow_117:"4092",gShow_321:"4097",gShow_127:"4093",gShow_128:"4094",gShow_129:"4095",gScale_127:"4104",gScale_129:"4106",gStep_321:"4101",gStep_128:"4101",gStep_127:"4100",gStep_129:"4102"};for(j=0;j<infoArray.length;j++){var v=infoArray[j];args.push(m[v[0]]||"4105");if(args.length>argv.length){argv.push(infoArray[j][1]);}}break;case"formatTemplateObjectBulk":infoArray=oneFormat[1];for(j=0;j<infoArray.length;j++){if(infoArray[j][0]=="showMetrics"){eventId=mstrUpdateManager.SET_PROPERTY_VALUES;args=["4146"];argv=["Template Formatting!ShowMetricObjectInGraphZone!"+infoArray[j][1]];}}break;}if(eventId!=null){ac.push(um.createActionObject(this.elem,eventId,this.beanPath,args,argv,[],[]));}}if(ac.length>0){um.add(ac);if(!this.useClientSideManipulations){um.flushAndSubmitChanges();}else{this.notifySelectionChange("ongridselectionchange");}}}catch(err){microstrategy.errors.log(err);}return null;};mstrGridReport.prototype.setDsetId=function(id){try{this.dSetId=(this.gridStructureInfo&&this.gridStructureInfo.hasNoUnits)?null:id;}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.openDialog=function(dialogName,url,ac,beanPath,propsObject){try{microstrategy.openDialog(dialogName,url,ac,beanPath,propsObject);}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.convertToDoc=function(isIVE,flashRenderer){try{var ac=[];if(!isIVE){var displayMode;if(this.isGraph&&this.isGrid){displayMode=microstrategy.DISPLAY_MODE_GRID_AND_GRAPH;}else{if(this.isGraph){displayMode=microstrategy.DISPLAY_MODE_GRAPH;}else{if(this.isGrid){displayMode=microstrategy.DISPLAY_MODE_GRID;}}}this.addAction(this.elem,mstrUpdateManager.EXECUTE_RWDOC,microstrategy.servletName,["2048001","2048002","2048092","2048143","2048009","4115"],[this.reportID,this.messageID,microstrategy.RWD_EXECUTION_MODE_DATA,this.stateID,this.objTypeReport,displayMode],ac);var viewMediaStr="currentViewMedia="+microstrategy.RW_VIEW_MODE_EDITABLE;this.um.addURL(viewMediaStr);}else{if(flashRenderer){this.addAction(this.elem,mstrUpdateManager.CONVERT_TO_DOCUMENT,microstrategy.servletName,["3001","3010","3115","2048143","3007","3158","3163","3017"],[this.reportID,this.messageID,microstrategy.RWD_EXECUTION_MODE_DATA,this.stateID,this.objTypeReport,microstrategy.RW_VIEW_MODE_VIEWANALYSIS,microstrategy.RWD_EASE_CREATION_ANALYSIS,microstrategy.APP_BEAN_VIEW_EXECUTION],ac);}else{if(mstr.utils.ISIE6||mstr.utils.ISIE7||mstr.utils.ISIE8){showMessage({contents:mstrGridReport.desp(12187),elements:microstrategy.OK_BUTTON,type:mstrMsgBoxImpl.MSG_ERROR});return ;}else{this.addAction(this.elem,mstrUpdateManager.CREATE_HTML5_VI,microstrategy.servletName,["3001","3010","3115","3007","3163"],[this.reportID,this.messageID,microstrategy.RWD_EXECUTION_MODE_DATA,this.objTypeReport,microstrategy.RWD_EASE_CREATION_HTML5_DASHBOARD_WITH_TEMPLATE],ac);}}}this.um.add(ac);this.um.useIframe=false;this.um.flushAndSubmitChanges();}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.saveReport=function(){try{var askBeforeSaveCheckbox=document.getElementById("askBeforeSaveCheckbox");if(askBeforeSaveCheckbox&&askBeforeSaveCheckbox.checked){this.commands.exec("forceSaveAs");}var ac=[],args=[],argv=[];var cmdId=this.saveCmdId,saveOrigin=7;if(cmdId){switch(cmdId){case"createIVEFromRpt":saveOrigin=15;break;case"createHTML5IVEFromRpt":if(mstr.utils.ISIE6||mstr.utils.ISIE7||mstr.utils.ISIE8){showMessage({contents:mstrGridReport.desp(12187),elements:microstrategy.OK_BUTTON,type:mstrMsgBoxImpl.MSG_ERROR});return ;}saveOrigin=16;break;default:saveOrigin=7;}delete this.saveCmdId;}var folderId=this.getSaveFolderId();if(mstrGridReport.isViewMode()){args=["3013","3031","3017"];argv=[false,saveOrigin,"false"];if(folderId&&!(cmdId)){args.splice(1,0,"3014");argv.splice(1,1,folderId,folderId);}else{args.push("3014");argv.push(folderId);}}else{args=["3013","3017"];argv=["1","true"];this.addAction(this.elem,mstrUpdateManager.DESIGN_MODE_PROCESS,this.beanPath,["6032","6018"],["1","1"],ac);if(folderId){args.push("3014");argv.push(folderId);}}this.addAction(this.elem,mstrUpdateManager.SAVE_GRID,microstrategy.servletName,args,argv,ac);this.um.useIframe=false;this.um.add(ac);this.um.flushAndSubmitChanges();}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.save=function(){try{if(this.isNew||this.isReadonly||this.isDrilled||this.needSaveAs){return this.saveReport();}else{this.um.add([this.um.createActionObject(null,mstrUpdateManager.APPLY_CHANGES,this.beanPath,[],[],[],null)]);this.um.add([this.um.createActionObject(null,mstrUpdateManager.SAVE_OBJECT,this.beanPath,["89001"],["0"],[],null)]);this.um.flushAndSubmitChanges();}}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.submitSave=function(){try{var askBeforeSaveCheckbox=document.getElementById("askBeforeSaveCheckbox");if(askBeforeSaveCheckbox&&askBeforeSaveCheckbox.checked&&this.isFeatureAvailable(microstrategy.FEATURE_ASK_BEFORE_SAVE_CHANGES)){this.commands.exec("dontAskAgain");}this.um.add([this.um.createActionObject(null,mstrUpdateManager.APPLY_CHANGES,this.beanPath,[],[],[],null)]);this.um.add([this.um.createActionObject(null,mstrUpdateManager.SAVE_OBJECT,this.beanPath,["89001"],["0"],[],null)]);this.um.flushAndSubmitChanges();}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.getSaveFolderId=function(){try{if(this.saveFolderId){return this.saveFolderId;}else{return this.parentFolderID;}}catch(err){microstrategy.errors.log(err);}};mstrGridReport.addAllLevel=function(s,src){var a=["UNIT_HEADER","UNIT_VALUE","SUBTOTAL_HEADER","SUBTOTAL_VALUE"];for(var j in a){s.addToSelectedUnits(null,src,microstrategy["GRIDCELLTYPE_"+j],true);}};mstrGridReport.prototype.selectAxis=function(axisObj,level){try{if(level==null||level=="none"){return false;}var s=this.selections;if(axisObj!=null&&axisObj.size()>0){for(var i in axisObj.units){var unitSrc=axisObj.units[i].src;if(unitSrc==null){continue;}if(level==microstrategy.GRIDCELLTYPE_LEVEL_ALL){mstrGridReport.addAllLevel(s,unitSrc);}else{s.addToSelectedUnits(null,unitSrc,level,true);}}}return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrGridReport.prototype.getGridUnitItems=function(){try{var units=[];var g=this.gridStructureInfo;var axes=[g.rowAxis.units,g.colAxis.units,g.metricAxis.units];for(var i=0;i<3;i++){for(var j=0,cnt=axes[i].length;j<cnt;j++){if(!axes[i][j].isMetricTemplateUnit){units.push(axes[i][j]);}}}return units;}catch(err){microstrategy.errors.log(err);return null;}};mstrGridReport.prototype.getGridUnitSelectorItems=function(onlyMetrics){try{var count=this.nonUnitCount;var units=[];var items=this.getGridUnitItems();var ri=0;for(var i=0,cnt=items.length;i<cnt;i++){var item=items[i],unit;if(onlyMetrics&&item.dssType!=microstrategy.DSSTYPE_METRIC){count++;continue;}if(!!item.dssType){units[ri++]=unit={dssid:count++,n:items[i].alias,tp:items[i].dssType,cssClass:"ToolbarList U"+items[i].dssType};if(item.dssSubtype==3076){unit.cssClass+="R";}}else{count++;}}return units;}catch(err){microstrategy.errors.log(err);return null;}};mstrGridReport.prototype.getSelectedGridUnitByIndex=function(index){try{var items=this.getGridUnitItems();return items[index-this.nonUnitCount];}catch(err){microstrategy.errors.log(err);}return null;};mstrGridReport.prototype.getGridFormats=function(){try{return this.gridFormat||{};}catch(err){microstrategy.errors.log(err);return{};}};mstrGridReport.prototype.getGridFormatMap=function(){try{if(!this.formatMap){this.formatMap={unitMap:{},valueMap:{1:"h",2:"v",3:"sn",4:"sv",5:"a"},fontFamily:{n:"ff",id:"4042"},fontWeight:{n:"fw",id:"4043"},fontStyle:{n:"fs",id:"4044"},fontSize:{n:"fz",id:"4045"},textDecoration2:{n:"ft",id:"4046"},textDecoration:{n:"fu",id:"4047"},color:{n:"c",id:"4048"},textAlign:{n:"hz",id:"4056"},textAlign2:{n:"hz",id:"4056"},GridHorizontal:{n:"hz",id:"4056"},verticalAlign:{n:"vt",id:"4057"},Vertical:{n:"vt",id:"4057"},Vertical2:{n:"vt",id:"4057"},whiteSpace:{n:"tw",id:"4058"},TextWrap:{n:"tw",id:"4058"},TextDirection:{n:"td",id:"4222"},paddingLeft:{n:"lp",id:"4223"},paddingTop:{n:"tp",id:"4224"},paddingRight:{n:"rp",id:"4225"},paddingBottom:{n:"bp",id:"4226"},Category:{n:"nct",id:"4050"},DecimalPlaces:{n:"ndp",id:"4051"},ThousandSeparator:{n:"nth",id:"4052"},CurrencySymbol:{n:"ncs",id:"4053"},CurrencyPosition:{n:"ncp",id:"4054"},NegativeNumbers:{n:"nnn",id:"4111"},Format:{n:"nfs",id:"4055"},propBorderStyle:{n:"bd",id:""},TopStyle:{n:"bts",id:"4061"},LeftStyle:{n:"bls",id:"4062"},BottomStyle:{n:"bbs",id:"4063"},RightStyle:{n:"brs",id:"4064"},TopColor:{n:"btc",id:"4067"},LeftColor:{n:"blc",id:"4068"},BottomColor:{n:"bbc",id:"4069"},RightColor:{n:"brc",id:"4070"},fillStyle:{n:"fty",id:"4224"},backgroundColor:{n:"bg",id:"4071"},gradientcolor:{n:"gr",id:["4071","4225","4226","4229","4230"]},Gradient:{n:"gr",id:["4071","4225","4226","4229","4230"]}};this.formatMap.unitMap[microstrategy.GRID_BORDERS]="gb";this.formatMap.unitMap[mstrGridReport.ALL_UNITS]="agc";this.formatMap.unitMap[mstrGridReport.ROW_UNITS]="ra";this.formatMap.unitMap[mstrGridReport.COL_UNITS]="ca";this.formatMap.unitMap[mstrGridReport.METRIC_UNITS]="am";this.formatMap.getName=function(p){return(this[p]&&this[p]["n"])||p;};this.formatMap.getArgId=function(p){return(this[p]&&this[p]["id"])||null;};this.formatMap.decode=function(p,v){switch(p){case"fontWeight":return(v==-2)?"default":(v==microstrategy.TRUE?"bold":"");case"fontStyle":return(v==-2)?"default":(v==microstrategy.TRUE?"italic":"");case"textDecoration":return(v)?"underline":"";case"textDecoration2":return(v)?"line-through":"";case"whiteSpace":return(v)?"normal":"nowrap";}return v;};this.formatMap.encode=function(p,v){var f=mstrFormatObject;switch(p){case"textDecoration":case"textDecoration2":case"TextWrap":return(v)?microstrategy.TRUE:microstrategy.FALSE;case"color":case"TopColor":case"LeftColor":case"BottomColor":case"RightColor":return(v=="transparent")?0:f.encodeValue("color",v);case"backgroundColor":case"Gradient":if(v.indexOf(",")==-1){return(v=="transparent")?0:f.encodeValue("color",v);}var gradientValues=v.split(",");return[f.encodeValue("color","#"+gradientValues[gradientUtil.GRADIENT_START_COLOR_INDEX]),f.encodeValue("color","#"+gradientValues[gradientUtil.GRADIENT_END_COLOR_INDEX]),gradientValues[gradientUtil.GRADIENT_ANGLE_INDEX],gradientValues[gradientUtil.GRADIENT_XOFFSET_INDEX],gradientValues[gradientUtil.GRADIENT_YOFFSET_INDEX]];}return v;};}return this.formatMap;}catch(err){microstrategy.errors.log(err);return null;}};mstrGridReport.prototype.getGridFormatNode=function(formatType,prop){try{var formats=this.getGridFormats();if(!formats){return null;}var formatMap=this.getGridFormatMap();var resultNode;if(formatType.unit>mstrGridReport.METRIC_UNITS){var unit=formats.u[formatType.unit-mstrGridReport.METRIC_UNITS-1];resultNode=unit?unit[formatMap.valueMap[formatType.format]]:null;}else{var main=formats[formatMap.unitMap[formatType.unit]];if(formatType.unit==microstrategy.GRID_BORDERS){resultNode=main;resultNode.defaultsApplied=true;}else{if(main){resultNode=main[formatMap.valueMap[formatType.format]];}}}if(!resultNode||!resultNode.defaultsApplied){resultNode=mstr.utils.Hash.applydefault(resultNode,formats.de);resultNode.defaultsApplied=true;}return resultNode;}catch(err){microstrategy.errors.log(err);return null;}};mstrGridReport.prototype.getGridFormatValue=function(formatType,prop,convert){try{if((formatType.unit==-1&&formatType.format==-1)||(formatType.unit==0)){return"";}var formatMap=this.getGridFormatMap();var n=formatMap.getName(prop);var node=this.getGridFormatNode(formatType);if(!node){return"";}var v="";if(prop=="borders"){v=microstrategy.resolveBorderFlags(this.checkBorders(formatMap,node),true);}else{if((n in node)&&prop=="propBorderStyle"){v=this.checkBorderStyle(formatMap,node);}else{v=(n in node)?node[n]:"";}}if(prop=="backgroundColor"){v=node.fty==1?"transparent":v;}if(convert){v=formatMap.decode(prop,v);}return isNaN(v)?v||"":v;}catch(err){microstrategy.errors.log(err);return"";}};mstrGridReport.prototype.checkBorderStyle=function(fm,n){var b=0;var fn=function(s){return n[fm.getName(s)];};try{if(fn("propBorderStyle")==0){return 0;}if(fn("TopStyle")!=0&&fn("BottomStyle")!=0&&fn("LeftStyle")!=0&&fn("RightStyle")!=0){return fn("propBorderStyle");}else{return 0;}}catch(err){microstrategy.errors.log(err);}return b;};mstrGridReport.prototype.checkBorders=function(fm,n){var b=0;var fn=function(s){return n[fm.getName(s)];};try{if(fn("propBorderStyle")==0){return 0;}if(fn("propBorderStyle")==1){return 31;}if(fn("TopStyle")!=0){b+=1;}if(fn("BottomStyle")!=0){b+=2;}if(fn("LeftStyle")!=0){b+=4;}if(fn("RightStyle")!=0){b+=8;}b=(b==15)?31:b;}catch(err){microstrategy.errors.log(err);}return b;};mstrGridReport.prototype.setGridFormatValue=function(formatType,prop,value,ac){try{var formatMap=this.getGridFormatMap();var n=formatMap.getName(prop);var node=this.getGridFormatNode(formatType);if(node&&node[n]!=value){node[n]=value;}}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.updateSelected=function(position,level,isMetric){try{if(level==null||level=="none"){return ;}var gridInfo=position.split(",");var axis=gridInfo[0];var pos=gridInfo[1];var unit=gridInfo[2];var depth=pos;this.positionForGradient=pos;if(isMetric){axis="0";depth=parseInt(pos,10)+1;}this.selectedAxis=axis;this.selectedPosition=pos;this.selectedUnit=unit;this.selectedLevel=level;this.gridValueFormat=level;var showSelections=false;var g=this.gridStructureInfo;if(!showSelections){this.selections.clearSelectionsFromOtherPages();}var that=this;var fn=function(o){that.selectAxis(o,level);};switch(position){case"0,-9999,7":this.gridUnitFormat=mstrGridReport.ALL_UNITS;if(showSelections){fn(g.rowAxis);fn(g.colAxis);fn(g.metricAxis);}break;case"1,0,3":this.gridUnitFormat=mstrGridReport.ROW_UNITS;if(showSelections){fn(g.rowAxis);}break;case"2,0,4":this.gridUnitFormat=mstrGridReport.COL_UNITS;if(showSelections){fn(g.colAxis);}break;case"0,-999,6":this.gridUnitFormat=mstrGridReport.METRIC_UNITS;if(showSelections){fn(g.metricAxis);}break;case"0,-9,7":this.gridUnitFormat=microstrategy.GRID_UNIT_CONTAINER;this.gridValueFormat=0;break;case"0,-99,7":this.gridUnitFormat=microstrategy.GRID_BORDERS;this.gridValueFormat=0;break;default:unit=g.getUnit(this.selectedAxis,depth,this.selectedUnit);var unitSrc=(unit!=null)?unit.src:null;if(unitSrc==null){break;}var lvl=position.split(",");var a=parseInt(lvl[0]);var p=parseInt(lvl[1]);var c=(p==-1||a<1);this.gridUnitFormat=this.resolveGridUnitId((c==true?-1:a),(c==true?p+1:p));if(this.selectedLevel==microstrategy.GRIDCELLTYPE_LEVEL_ALL){this.gridValueFormat=this.selectedLevel;if(showSelections){mstrGridReport.addAllLevel(this.selections,unitSrc);}}else{this.gridValueFormat=this.selectedLevel;if(showSelections){this.selections.addToSelectedUnits(null,unitSrc,this.selectedLevel,true);}}break;}this.notifySelectionChange("ongridselectionschange");}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.resolveGridUnitId=function(axis,depth){try{var g=this.gridStructureInfo;var isMetric=(axis<1);if(isMetric){axis=g.metricsAxis;}var index=mstrGridReport.METRIC_UNITS;if(isMetric||(axis!=g.metricsAxis||depth!=g.metricsDepth)){var sub=false;if(isMetric){index+=g.rowAxis.size();index+=g.colAxis.size();sub=(g.metricsAxis!=microstrategy.GRIDCELL_AXIS_PAGE_BY);}else{var fn=function(col){var b1=g.hasMetrics&&g.metricsAxis==microstrategy.GRIDCELL_AXIS_ROWS;var b2=g.metricsDepth<depth;var b3=g.metricsAxis==microstrategy.GRIDCELL_AXIS_COLUMNS;if(col){return(b1||(b2&&b3));}else{return(b1&&b2);}};switch(axis){case microstrategy.GRIDCELL_AXIS_ROWS:sub=fn();break;case microstrategy.GRIDCELL_AXIS_COLUMNS:index+=g.rowAxis.size();sub=fn(true);break;}}index+=depth;if(sub){index-=1;}}return index;}catch(err){microstrategy.errors.log(err);return mstrGridReport.METRIC_UNITS;}};mstrGridReport.prototype.resetSelections=function(){try{var a=["Axis","Level","Position","Unit"];for(var i in a){this["selected"+a[i]]=null;}}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.setGridUnitSelections=function(unit,value){try{this.gridUnitFormat=unit;this.gridValueFormat=value;if(!this.selections){return ;}var targets=this.resolveGridTargetProperties({unit:this.gridUnitFormat,format:this.gridValueFormat});this.selections.clearAll(true);if(unit<mstrGridReport.ALL_UNITS){return ;}var isMetric=false;if(unit>=this.nonUnitCount){var item=this.getGridUnitSelectorItems()[unit-this.nonUnitCount];isMetric=!!(item&&item.tp==microstrategy.DSSTYPE_METRIC);}this.updateSelected(targets.axis+","+targets.position+","+targets.unit,targets.level,isMetric);}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.resetGridUnitSelections=function(){this.gridUnitFormat=mstrGridReport.ALL_UNITS;this.gridValueFormat=2;};mstrGridReport.prototype.notifySelectionChange=function(evt){try{if(this.observer){this.observer.notifyAll(evt);}}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.getSelectedUnit=function(){var unit=null;if(this.selections&&this.selections.getSelectedGridTarget){var selectedGridTarget=this.selections.getSelectedGridTarget();if(selectedGridTarget&&selectedGridTarget.length>0){var values=selectedGridTarget.split(",");if(values!=null&&values.length>=2){var axis=values[0];var depth=values[1];var subDepth=values[2];unit=this.gridStructureInfo.getUnit(axis,depth,subDepth);}}}return unit;};mstrGridReport.prototype.addCalculationQuickGroup=function(cmdId){try{var deName="";var depth="";var subDepth="";var unit=null;var attrId="";var axis="";var attrName="";var functionId="";if(this.selections&&this.selections.getSelectedGridTarget){var selectedGridTarget=this.selections.getSelectedGridTarget();if(selectedGridTarget&&selectedGridTarget.length>0){var values=selectedGridTarget.split(",");if(values!=null&&values.length>=2){axis=values[0];depth=values[1];subDepth=values[2];unit=this.gridStructureInfo.getUnit(axis,depth,subDepth);if(unit!=null){if(unit.dssType==microstrategy.DSSTYPE_ATTRIBUTE_FORM){unit=this.gridStructureInfo.findUnit(unit.parentDssId);}attrId=unit.dssId;attrName=unit.alias;if(unit.src){depth=parseInt(unit.src.getAttribute(microstrategy.HTMLATTR_GRIDCELL_DEPTH));}else{if(unit.depth){depth=unit.depth;}}}}}}var operands=[];var ordinals=this.selections.getSelectedElementsOrdinals(operands);var labelText=mstrGridReport.desp("5207");var defaultName=mstrGridReport.desp("5422");var fn=function(id){return"["+attrName+"] "+mstrGridReport.desp(id)+" ";};switch(cmdId){case"deSum":deName=fn("2131");functionId=134;break;case"deAvg":deName=fn("2122");functionId=135;break;case"deMin":deName=fn("5416");functionId=116;break;case"deMax":deName=fn("5417");functionId=115;break;case"deMinus":deName=operands.join(" - ");functionId=2;break;case"deDivide":deName=operands.join(" / ");functionId=4;break;case"deList":defaultName=mstrGridReport.desp("6177");break;}this.getNewListName(cmdId,attrId,depth,ordinals.join(","),functionId,labelText,defaultName);}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.submitQuickGroupEvent=function(cmdId,deName,attrId,depth,ordinals,functionId){try{if(this.selections){this.selections.clearAll(true);}var ids=["4233","4234","4235","4236"];var values=[deName,attrId,depth,ordinals];if(this.sliceID){ids.push("4254");values.push(this.sliceID);}var id=mstrUpdateManager.DE_ADD_QUICK_LIST;if(cmdId!="deList"){ids.splice(4,0,"4237");values.splice(4,0,functionId);id=mstrUpdateManager.DE_ADD_QUICK_CALCULATION;}this.addAction(this.elem,id,this.beanPath,ids,values);}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.getNewListName=function(cmdId,attrId,depth,ordinals,functionId,labelText,defaultName){try{var label="<label for='gname' id='glabel'> "+labelText+" </label>";var onchangeevent="onpropertychange";if(!bIsIE4){onchangeevent="oninput";}var nameField="<input name='gname' id='gname' type='text' size='35' value='"+defaultName+"' "+onchangeevent+"= \"var gnamev = document.getElementById('gname').value;if((!gnamev) || gnamev.replace(/^\\s+/g,'').length <= 0){microstrategy.bones['msgBox'].okButton.disabled = true ;}else{ microstrategy.bones['msgBox'].okButton.disabled = false ;}\"/> ";var title=mstrGridReport.desp(functionId?"5415":"5414");showMessage({contents:"<div style='overflow:auto'>"+label+nameField+"</div>",elements:microstrategy.OK_BUTTON+microstrategy.CANCEL_BUTTON,okEval:"microstrategy.bones['"+this.id+"'].submitQuickGroupEvent('"+cmdId+"', document.getElementById('gname').value || '"+defaultName+"','"+attrId+"', "+depth+", '"+ordinals+"', '"+functionId+"')",title:title});}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.getUnitInfo=function(item){try{return this.gridStructureInfo.getGridUnitInfo(item);}catch(err){microstrategy.errors.log(err);return null;}};mstrGridReport.prototype.getItemFormats=function(){try{return this.itemFormats;}catch(err){microstrategy.errors.log(err);return false;}};mstrGridReport.prototype.getAttValue=function(formatType,att){try{if(formatType==mstrGridReport.FMT_TYPE_TITLE&&this.titleBarObj){var o=microstrategy.styleObj.formattingAttributes[this.titleBarObj.getAttribute("id")];if(o!=null&&typeof (o[att])!="undefined"){return o[att];}return this.titleBarObj.getAttribute(att,0);}}catch(err){microstrategy.errors.log(err);}return null;};mstrGridReport.prototype.getFormatValue=function(formatType,prop){try{if(!this.itemFormats){return null;}if(prop=="gradientcolor"&&formatType==mstrGridReport.FMT_TYPE_TITLE){return(this.titleBarObj)?this.titleBarObj.getAttribute(prop):null;}if(formatType==microstrategy.FORMAT_TYPE_CONTROL_TITLE){formatType=microstrategy.FORMAT_TYPE_TITLE;}return this.itemFormats[formatType][prop];}catch(err){microstrategy.errors.log(err);return null;}};mstrGridReport.prototype.setAttValue=function(formatType,att,value){try{this.itemFormats[formatType][att]=value;if(formatType==mstrGridReport.FMT_TYPE_TITLE){if(this.titleBarObj){var id=this.titleBarObj.getAttribute("id");var o=microstrategy.styleObj.formattingAttributes[id];if(typeof (o)=="undefined"){o=microstrategy.styleObj.formattingAttributes[id]={};}o[att]=value;var m=mstrGridReport.heightAndWidthAttMap[att];this.titleBarObj.style[m]=microstrategy.getFormatObject().decodeValue(m,value);}}}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.setFormatValue=function(formatType,prop,value,ac){try{if(typeof (formatType)=="object"&&"unit" in formatType){this.setGridFormatValue(formatType,prop,value);}else{if(this.itemFormats){this.itemFormats[formatType][prop]=value;if(formatType==mstrGridReport.FMT_TYPE_TITLE){if(prop=="Gradient"){return ;}if(this.titleBarObj){var elem=this.titleBarObj;var plc=prop&&prop.toLowerCase();if(plc=="textdecoration"||plc=="textdecoration2"||plc=="textalign"){elem=microstrategy.findChildWithAtt(this.titleBarObj,"div","id","titleBar");}microstrategy.bone("rwb_viewer").doc.styleObj.formatElem(elem,prop,value);if(prop&&prop.toLowerCase()=="backgroundcolor"){this.titleBarObj.setAttribute("bgstyle",(value=="transparent")?1:0);if(this.titleBarObj.getAttribute("gradientcolor")){this.titleBarObj.removeAttribute("gradientcolor");}}}}}}}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.isContainerSelected=function(){try{return(this.selectedAxis==0&&(this.selectedLevel==8||this.selectedLevel==9));}catch(err){microstrategy.errors.log(err);return false;}};mstrGridReport.prototype.isTemplateEmpty=function(e){try{return(this.gridStructureInfo.hasNoUnits);}catch(err){microstrategy.errors.log(err);return false;}};mstrGridReport.prototype.convertGradientInfo=function(value){try{var gi=[];var gv=value.split(",");var format=mstrFormatObject;var fn=function(s){return gv[gradientUtil["GRADIENT_"+s]];};gi[this.gradientColorId]=format.encodeValue("gradientColor",value);gi[this.gradientAngleId]=fn("ANGLE_INDEX");gi[this.gradientXOffsetId]=fn("XOFFSET_INDEX");gi[this.gradientYOffsetId]=fn("YOFFSET_INDEX");}catch(err){microstrategy.errors.log(err);}return gi;};mstrGridReport.prototype.makeSelectionByName=function(value,attId,anchorObj,ac){var sd=this.getSelectionData(attId);if(sd&&sd.el&&value&&sd.el[value]){var ids=new Array(sd.el[value].id);this.makeSelection(ids,attId,anchorObj,ac,true);}};mstrGridReport.prototype.makeSelection=function(values,attId,anchorObj,ac){try{var itemSeparator="\x1e";var sd=this.getSelectionData(attId);if(sd&&values&&values.length>0){var elemIDs=values.join(itemSeparator);sd.sel=values;sd.ias=false;for(var e in values){if(e=="u;"){sd.ias=true;break;}}var controlInfo=this.controlLinks&&this.controlLinks[attId];if(!controlInfo&&this.controlLinks){for(var link in this.controlLinks){controlInfo=this.controlLinks[link];break;}}if(controlInfo){this.applySelector(attId,controlInfo.ck,elemIDs,this.getVisibleTargets(controlInfo),controlInfo.partialUpdate,controlInfo.ctxt,anchorObj,ac);}}}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.makeSelections=function(selections){try{var ac=[];for(var i=0;i<selections.length;i++){this.makeSelection(selections[i].values,selections[i].attId,null,ac);}if(ac.length>0){this.um.add(ac);this.um.flushAndSubmitChanges();}}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.handleFitToAction=function(c){try{var acc=[];this.saveEnabled=true;this.isSaveBeforeDocCreate=true;this.notifySelectionChange("ongridselectionschange");this.commands.exec("setColWidthsMode",parseInt(c));this.colWidths.saveColWidthsMode(parseInt(c),acc);this.colWidths.syncCols();this.um.add(acc);}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.handleFitToWindow=function(){this.handleFitToAction("1");};mstrGridReport.prototype.handleFitToContent=function(){this.handleFitToAction("2");};mstrGridReport.prototype.setGraphSelected=function(graphSelected){this.graphSelected=graphSelected;};mstrGridReport.prototype.getFixedRC=function(rc){try{if(this.gridStructureInfo){return this.gridStructureInfo["getFixed"+rc]();}else{return mstrGridStatic.prototype["getFixed"+rc].apply(this);}}catch(err){microstrategy.errors.log(err);}return 0;};mstrGridReport.prototype.getFixedRows=function(){return this.getFixedRC("Rows");};mstrGridReport.prototype.getFixedColumns=function(){return this.getFixedRC("Columns");};mstrGridReport.prototype.addRefreshEvent=function(){try{var um=this.um;var action=um.createActionObject(null,mstrUpdateManager.PAGE_REFRESH,microstrategy.servletName+"."+microstrategy.pageName,[],[],[],null);um.add([action],true);}catch(err){microstrategy.errors.log(err);}};mstrGridReport.prototype.isADrillElemCheckBoxOrARadio=function(oCheck){return(oCheck.name&&(oCheck.name.indexOf(microstrategy.DRILL_BOX_NAME)==0||oCheck.name.indexOf(microstrategy.FILTER_BOX_NAME)==0)&&(oCheck.type=="checkbox"||oCheck.type=="radio"));};mstrGridReport.prototype.submitIncrementalFetch=function(anchor,e){if(!e){e=window.event;}if(e&&e.ctrlKey){return false;}if(anchor.getAttribute("useIframe")){anchor.href=replaceURLParameter(anchor.href,"iframe","true");}var sTarget=anchor.target;var oDForm=getObj("ReportEditorGrid");var TempValue="";var href=anchor.href;if(oDForm){var oNewForm=createDynamicForm(href);if(sTarget){oNewForm.target=sTarget;}for(var i=0;i<oDForm.elements.length;i++){var oCheck=oDForm.elements[i];if(this.isADrillElemCheckBoxOrARadio(oCheck)&&oCheck.checked){if(oCheck.type=="radio"){TempValue=oCheck.value;break;}TempValue=TempValue+oCheck.value+",";}}var oNewItem=document.createElement("INPUT");oNewItem.type="HIDDEN";oNewItem.name="hiddenDrillValues";oNewItem.id="hiddenDrillValues";if(this.hiddenDrillValues){oNewItem.value=TempValue+this.hiddenDrillValues;}else{oNewItem.value=TempValue;}oNewForm.insertAdjacentElement("beforeEnd",oNewItem);submitForm(oNewForm);}};mstrGridReport.prototype.submitDrillFromEditor=function(that){var _f=that.form;var ie=document.createElement("input");ie.type="hidden";ie.name=that.name;ie.value=that.value;_f.appendChild(ie);_f.onsubmit();_f.submit();};mstrGridReport.prototype.initIncrementalFetchBoxes=function(){var url=this.hiddenDrillValues;var tempString=url?url.split(","):[];var oDForm=getObj("ReportEditorGrid");var newHiddenDrillValues="";var oCheck;var drillCheckTypeIsAradio=false;if(oDForm){for(var i=0;i<oDForm.elements.length;i++){oCheck=oDForm.elements[i];if(oCheck.name&&oCheck.name.indexOf(microstrategy.DRILL_BOX_NAME)==0&&oCheck.type=="radio"){drillCheckTypeIsAradio=true;break;}}for(var i=0;i<oDForm.elements.length;i++){oCheck=oDForm.elements[i];if(this.isADrillElemCheckBoxOrARadio(oCheck)){for(var j=0;j<tempString.length;j++){if(oCheck.value==tempString[j]){oCheck.checked=true;if(oCheck.type=="radio"){return ;}break;}}}}if(drillCheckTypeIsAradio){newHiddenDrillValues=tempString[0];}else{var valueFound=false;for(var j=0;j<tempString.length;j++){valueFound=false;for(var i=0;i<oDForm.elements.length;i++){oCheck=oDForm.elements[i];if(oCheck.name&&oCheck.name.indexOf(microstrategy.DRILL_BOX_NAME)==0&&oCheck.type=="checkbox"){if(oCheck.value==tempString[j]){valueFound=true;break;}}}if(valueFound==false){newHiddenDrillValues=newHiddenDrillValues+tempString[j]+",";}}if(newHiddenDrillValues.substr(newHiddenDrillValues.length-1)==","){newHiddenDrillValues=newHiddenDrillValues.substr(0,newHiddenDrillValues.length-1);}}if(oDForm.hiddendrillvalues){oDForm.hiddendrillvalues.value=newHiddenDrillValues;}}};mstrGridReport.styAttrValue=function(c,s){return microstrategy.styleObj.getAttValue(c,microstrategy["HTMLATTR_"+s]);};mstrGridReport.prototype.getFilterBone=function(){try{return microstrategy.bone("rfe_pane")||microstrategy.bone("rle_pane")||microstrategy.bone("vfe_pane");}catch(err){microstrategy.errors.log(err);return null;}};mstrGridReport.prototype.prompt2ApplyFilter=function(){try{if(this.isFilterVisible){var fb=this.getFilterBone();if(fb){return fb.prompt2ApplyFilter();}}}catch(err){microstrategy.errors.log(err);}return false;};function mstrGridReport(id){this.inherits=mstrGridStatic;this.inherits(id);delete this.inherits;this.primaryBone=true;return this;}mstrGridCommands.prototype=new mstrGridStaticCommands();mstrGridCommands.prototype.exec=function(cmdId,cmdVal1,cmdVal2,cmdVal3,cmdVal4){try{var params=null;var ac=null;var um=this.parentBone.um;var _ac=[];var pb=this.parentBone;if(cmdId&&cmdId.match(/exportMenu;/)){return this.exec("exportMenu",cmdId.substring(11,cmdId.length));}if((pb.isGraph&&mstrGridStatic.isGraphCommand(cmdId))||(pb.graphSelected&&mstrGridStatic.isGridGraphCommand(cmdId))){var graphBone=microstrategy.bone(pb.id+"_graph");return graphBone&&graphBone.commands.exec(cmdId,cmdVal1,cmdVal2,cmdVal3,cmdVal4);}switch(cmdId){case"clearAllGridSelections":if(pb.selections){pb.selections.clearAll();}return true;case"clearAllGridSelectionsWithOutNotify":if(pb.selections){pb.selections.clearAll(true);}return true;case"updateSelected":pb.updateSelected(cmdVal1,cmdVal2,cmdVal3);return true;case"setColWidthsMode":this.exec("ensureColWidthsReady");if(pb.colWidths){pb.colWidths.setColWidthsMode(cmdVal1);}return true;case"setColWidth":this.exec("ensureColWidthsReady");if(pb.colWidths){pb.colWidths.setColWidthByKey(cmdVal1,cmdVal2,cmdVal3);}return true;case"setRowHeightMode":this.exec("ensureColWidthsReady");if(pb.colWidths){pb.colWidths.setRowHeightMode(cmdVal1,cmdVal2);}return true;case"saveColWidthsMode":this.exec("ensureColWidthsReady");if(pb.colWidths){return pb.colWidths.saveColWidthsMode(cmdVal1,cmdVal2);}case"saveColWidths":this.exec("ensureColWidthsReady");if(pb.colWidths){return pb.colWidths.saveAllColWidths(cmdVal1,cmdVal2);}case"saveRowHeightMode":this.exec("ensureColWidthsReady");if(pb.colWidths){return pb.colWidths.saveRowHeightMode(cmdVal1,cmdVal2,cmdVal3);}case"cancelAllWidthsChanges":this.exec("ensureColWidthsReady");if(pb.colWidths){pb.colWidths.cancelAllOperations();}return true;case"syncColumns":this.exec("ensureColWidthsReady");if(pb.colWidths){pb.colWidths.syncCols();}return true;case"ensureColWidthsReady":if(pb.doColWidths&&!pb.colWidths){pb.setupColResize(pb.colResizeExtraTag);}return ;case"saveActionCollection":pb.um.add(cmdVal1);return true;case"restoreColumnWidths":this.exec("ensureColWidthsReady");if(pb.colWidths){pb.colWidths.restoreColumns();}return true;case"createIVEFromRpt":case"createHTML5IVEFromRpt":case"createDocFromRpt":var isIVE=cmdId!=="createDocFromRpt";var msgDescID=isIVE?14333:5867;if((pb.isNew||pb.isReadonly||pb.isDrilled)||pb.isSaveBeforeDocCreate){microstrategy.bone(pb.id).saveCmdId=cmdId;var saveJS="microstrategy.bone('"+pb.id+"').save()";var msgBoxType=microstrategy.OK_BUTTON+microstrategy.CANCEL_BUTTON;showMessage({contents:mstrGridReport.desp(msgDescID),elements:msgBoxType,okEval:saveJS,type:mstrMsgBoxImpl.MSG_WARNING});}else{if(pb.stateID>0&&pb.stateID!=pb.saveStateID){var flashRender=cmdId==="createIVEFromRpt",saveJS="microstrategy.bone('"+pb.id+"').save()",continueJS="microstrategy.bone('"+pb.id+"').convertToDoc("+isIVE+","+flashRender+")",buttonLabels={Ok:microstrategy.descriptors.getDescriptor("218"),Cancel:microstrategy.descriptors.getDescriptor("221"),Apply:microstrategy.descriptors.getDescriptor("219")};msgBoxType=microstrategy.APPLY_BUTTON+microstrategy.OK_BUTTON+microstrategy.CANCEL_BUTTON;showMessage({contents:mstrGridReport.desp(5956),elements:msgBoxType,applyEval:saveJS,okEval:continueJS,type:mstrMsgBoxImpl.MSG_WARNING,buttonLabels:buttonLabels});}else{pb.convertToDoc(cmdId!=="createDocFromRpt",cmdId==="createIVEFromRpt");}}return true;case"addTemplateUnitAttForm":case"addTemplateUnit":var pid=cmdVal1.getAttribute(microstrategy.HTMLATTR_PARENT_ID);if(pid!=null){var unit=pb.gridStructureInfo.findUnit(pid);if(unit!=null){cmdVal2=unit.axis;cmdVal3=unit.depth;}}var forceDepth=(cmdId=="addTemplateUnitAttForm")||(cmdVal3!=-1);_ac=pb.addUnit(cmdVal1,cmdVal2,cmdVal3,-1,cmdVal4,forceDepth);if(this.selections){this.selections.clearAll(true);}if(_ac.length>0&&pb.useClientSideManipulations){microstrategy.eventManager.notifyOrphanBones("ongridstructurechange",pb.gridStructureInfo);}return _ac;case"edtColorPicker":params=cmdVal1.split("|");pb.openDialog("edtColorPicker",null,null,microstrategy.servletName+"."+microstrategy.pageName,{activeBoneID:params[0],activeControlID:params[1],currentColor:params[2]});pb.um.replaceURL("selectedTabOptions",params[3]);pb.um.flushAndSubmitChanges();break;case"graphEdtColorGradient":case"edtColorGradient":case"rwdEdtColorGradient":params=cmdVal1.split("|");var forGraph=(cmdId=="graphEdtColorGradient");var od=function(dn,a,t){pb.openDialog(dn,a,null,microstrategy.servletName+"."+microstrategy.pageName);if(t){pb.um.replaceURL("selectedTabOptions",t);}};var rp=null;var pm="parentBoneID="+params[0]+"&controlID="+params[1]+"&activeViewKey=";if(!pb.isGrid||forGraph){pm+=((this.objId)?this.objId:params[2])+"&graphObjectID="+params[3]+"&graphSeriesID="+parseInt(params[4]);if(params.length>5){pm+="&color1="+params[5]+"&color2="+params[6]+"&transitionType="+params[7]+"&angle="+params[8]+"&xOffset="+params[9]+"&yOffset="+params[10];rp=params[11];}od("edtColorGradient",pm,rp);}else{var dialogName=(cmdId=="edtColorGradient")?"gridEdtColorGradient":"rwdEdtColorGradient";if(params.length>6){pm+=this.objId+"startFromSolid="+false+"&retrieveGradient="+params[3]+"&color1="+params[4]+"&color2="+params[5]+"&angle="+params[6]+"&xOffset="+params[7]+"&yOffset="+params[8]+"&formatType="+microstrategy.formatType;rp=params[9];}else{if(params.length==6){var startColor=(params[4]=="transparent")?"#FFFFFF":params[4];pm+=params[2]+"&retrieveGradient="+params[3]+"&color1="+startColor+"&startFromSolid="+true+"&formatType="+microstrategy.formatType;rp=params[5];}else{pm+=params[2]+"&retrieveGradient="+params[3]+"&color1="+params[4]+"&startFromSolid="+true+"&targetAxis="+pb.selectedAxis+"&targetPosition="+pb.positionForGradient+"&targetLevel="+pb.selectedLevel+"&formatType="+microstrategy.formatType;}}od(dialogName,pm,rp);}pb.um.flushAndSubmitChanges();break;case"bgcolorgradient":pb.exec("backgroundColor",cmdVal1);break;case"removeTemplateUnit":_ac=null;var objInfo=pb.gridStructureInfo.findUnit(cmdVal2);if(objInfo!=null){if(cmdVal3!=null){var formInfo=objInfo.attForms.findUnit(cmdVal3);_ac=(formInfo!=null)?pb.deleteUnit(formInfo,cmdVal4):pb.deleteUnit(objInfo,cmdVal4);}else{_ac=pb.deleteUnit(objInfo,cmdVal4);}if(this.selections){this.selections.clearAll(true);}if(_ac.length>0&&!this.queryState("graphMode")&&pb.useClientSideManipulations){microstrategy.eventManager.notifyOrphanBones("ongridstructurechange",pb.gridStructureInfo);}}return _ac;case"getGridUnits":if(pb.gridStructureInfo){return pb.gridStructureInfo.getGridUnits();}break;case"formatGridBulk":pb.processGridFormattingProperties(cmdVal1);return true;case"formatGraphBulk":pb.processGraphFormattingProperties(cmdVal1);return true;case"redo":pb.processRedo();return true;case"undo":pb.processUndo();return true;case"subtotalChanges":case"PropertyChanges":ac=[];for(var i=0,cnt=cmdVal1.length;i<cnt;i++){var propName=cmdVal1[i].cmdId;var propValue=cmdVal1[i].value;pb.processGridPropertyChanges(propName,propValue,ac);}pb.um.add(ac);pb.um.flushAndSubmitChanges();return true;case"ShowThreshold":pb.displayThresholds(pb.thresholdsState?"0":"1");return true;case"quickThresholds":pb.addQuickThresholds(ac,cmdVal1+"|edtAdvancedThresholds");return true;case"swapAxes":pb.swapAxes();return true;case"gridMode":case"graphMode":var m={gridMode:1,graphMode:2}[cmdId];if(pb.isGraph){var graphBone=microstrategy.bone(pb.id+"_graph");if(graphBone&&graphBone.zonesEditor){graphBone.toggleZonesEditor(null,false);}}if(pb.quickSwitch&&!pb.hasResized&&(!pb.isGrid||!pb.isGraph)){if((m==1&&pb.isGraph)||(m==2&&pb.isGrid)){pb.onQuickSwitchClick();}else{pb.notifySelectionChange("onselectionchange");}}else{pb.updateViewMode(m);pb.handleViewMode(m);}return true;case"gridGraphMode":pb.updateViewMode(3);pb.handleViewMode(3);return true;case"visFlashMode":case"visAjaxMode":var visMode=((cmdId=="visFlashMode")?50:51);microstrategy.adjustSelectedVisualization(pb,visMode);pb.updateViewMode(visMode);pb.handleViewMode(visMode);return true;case"visualizationMode":microstrategy.adjustSelectedVisualization(pb,cmdVal1);pb.updateViewMode(cmdVal1);pb.handleViewMode(cmdVal1);return true;case"autostyle":pb.handleChangeStyle(cmdVal1);return true;case"selectedVisualization":ac=[];params=cmdVal1.split("|");pb.setVisualizationSettings(null,params[0],null,params[1],ac);pb.um.add(ac);if((mstrGridReport.isRWD()&&microstrategy.EDIT_MODE==microstrategy.NOT_ALLOW_EDIT_MODE)||(mstrGridReport.isReport()&&mstrGridReport.isViewMode())){pb.um.flushAndSubmitChanges();}return true;case"setVisProps":ac=[];pb.setVisualizationSettings(null,null,null,null,ac,cmdVal1);pb.um.add(ac);return true;case"raiseGridResize":pb.onresize();return true;case"tbanding":pb.handleBanding();return true;case"tOutline":ac=[];var v=1;if(this.queryState("tOutline")){v=0;}pb.processGridPropertyChanges("Outline",v,ac);pb.um.add(ac);pb.um.flushAndSubmitChanges();return true;case"fittocontent":pb.handleFitToContent();return true;case"fittowindow":pb.handleFitToWindow();return true;case"checkMergeRowHeader":case"checkMergeColHeader":pb.toggleMergeHeaders(cmdId);return true;case"checkLockRowHeader":case"checkLockColHeader":pb.toggleLockHeaders(cmdId);return true;case"pageBy":microstrategy.toggleEditor("pbb_PageByStyle","pbb");return true;case"reportFilter":microstrategy.toggleEditor("rfe_pane","rfe");return true;case"viewFilter":microstrategy.toggleEditor("vfep_pane","vfep");return true;case"replaceTemplate":return pb.replaceTemplate(cmdVal1,cmdVal2,cmdVal3);case"promptDetails":microstrategy.toggleEditor("promptDetails_PromptDetailsStyle","promptDetails");return true;case"simpleThresholds":microstrategy.toggleEditor("edtReportSimpleThresholds_SimpleThresholdsReportEditorStyle","edtReportSimpleThresholds");return true;case"addQuickTotals":pb.addAction(this.elem,mstrUpdateManager.ADD_QUICK_SUBTOTAL,pb.beanPath);return true;case"save":if(mstrGridReport.isDesignMode()){return this.exec("dmSave",cmdVal1,cmdVal2,cmdVal3,cmdVal4);}else{var folderId=pb.getSaveFolderId();var args=["3013","3017"];var argv=["false","false"];if(folderId){args.splice(1,0,"3014");argv.splice(1,0,folderId);}um.useIframe=false;this.submitAction(this.elem,mstrUpdateManager.DESIGN_MODE_SAVE_AS,microstrategy.servletName,args,argv);break;}case"menuDirectSave":case"dSave":if(pb.prompt2ApplyFilter()){return ;}if(pb.isNew||pb.isReadonly||pb.isDrilled||pb.needSaveAs){return this.exec("save",cmdVal1,cmdVal2,cmdVal3,cmdVal4);}else{if(pb.isFeatureAvailable(microstrategy.FEATURE_ASK_BEFORE_SAVE_CHANGES)){pb.askBeforeSaveOverwrite();}else{if(pb.isFeatureAvailable(microstrategy.FEATURE_FORCE_SAVE_AS)&&cmdId=="dSave"){pb.saveReport();}else{pb.submitSave();}}break;}case"dmFilters":var rfb=microstrategy.findBone(pb.elem.parentNode);if(rfb){rfb.toggleFilterViewers(null,(cmdVal1<0));pb.isFilterVisible=(cmdVal1>0);}break;case"dmSave":if(pb.prompt2ApplyFilter()){return ;}if(pb.isNew||pb.isReadonly||pb.isDrilled){return this.exec("dmSaveAs",cmdVal1,cmdVal2,cmdVal3,cmdVal4);}else{pb.submitSave();}break;case"dmSaveAs":if(pb.prompt2ApplyFilter()){return ;}_ac.push(um.createActionObject(this.elem,mstrUpdateManager.DESIGN_MODE_PROCESS,pb.beanPath,["6032","6018"],["1","1"],[]));var folderId=pb.getSaveFolderId();var args=["3013","3017"];var argv=["1","true"];if(folderId){args.splice(1,0,"3014");argv.splice(1,0,folderId);}if(cmdVal1&&cmdVal1.origin){args.push("3031");argv.push(cmdVal1.origin);}_ac.push(um.createActionObject(this.elem,mstrUpdateManager.DESIGN_MODE_SAVE_AS,microstrategy.servletName,args,argv,[]));um.add(_ac);um.useIframe=false;um.flushAndSubmitChanges();break;case"dmRun":if(pb.prompt2ApplyFilter()){return ;}um.useIframe=false;this.submitAction(this.elem,mstrUpdateManager.DESIGN_MODE_PROCESS,pb.beanPath,["6017"],["1"]);break;case"Shortcut":case"isLinkedTemplate":pb.setFeature(microstrategy.FEATURE_EMBEDDED_TEMPLATE_NODE,!cmdVal1);break;case"cancelGridFormatRequest":pb.cancelGridFormatRequest();break;case"FilterDetailsFormat":microstrategy.openDataBasedBlockEditor("FilterDetailsEditor","FilterDetailsEditorBlockLoader",pb.beanPath,{});break;case"fos":um=pb.um;var selectedElems=pb.commands.queryState("selectedDrillElements");if(selectedElems){um.add([um.createActionObject(null,mstrUpdateManager.FILTER_ON_SELECTIONS,pb.beanPath,["4035","4134"],[selectedElems,"1"],[],null)]);pb.commands.exec("clearAllGridSelections");um.flushAndSubmitChanges();}break;case"togglePivot":case"toggleSort":case"toggleGraphZones":case"dontAskAgain":case"forceSaveAs":var pref="showGraphZones";var feature=microstrategy.FEATURE_CHECK_SHOW_GRAPH_ZONES;if(cmdId=="togglePivot"){pref="showPivot";feature=microstrategy.FEATURE_CHECK_SHOW_PIVOT_BUTTONS;}else{if(cmdId=="toggleSort"){pref="sSrt";feature=microstrategy.FEATURE_CHECK_SHOW_SORT_BUTTONS;}else{if(cmdId=="dontAskAgain"){pref="askBeforeSaveChanges";feature=microstrategy.FEATURE_ASK_BEFORE_SAVE_CHANGES;if(this.observer){this.observer.notifyAll("onstatechange");}this.submitAction(this.elem,mstrUpdateManager.SET_PREFERENCE,pb.beanPath,["5003","5004"],[pref,0]);break;}else{if(cmdId=="forceSaveAs"){pref="askBeforeSaveChanges";feature=microstrategy.FEATURE_FORCE_SAVE_AS;if(this.observer){this.observer.notifyAll("onstatechange");}this.submitAction(this.elem,mstrUpdateManager.SET_PREFERENCE,pb.beanPath,["5003","5004"],[pref,2]);break;}}}}if(this.observer){this.observer.notifyAll("onstatechange");}this.submitAction(this.elem,mstrUpdateManager.SET_PREFERENCE,pb.beanPath,["5003","5004"],[pref,pb.isFeatureAvailable(feature)?0:1]);break;case"comboToggleButton":if(this.queryEnabled("toggleSubtotals")){this.exec("toggleSubtotals");}else{this.exec("quickTotals");}break;case"tsubtotals":case"toggleSubtotals":pb.toggleSubtotals();break;case"showBean":this.submitAction(this.elem,mstrUpdateManager.SHOW_BEAN,pb.beanPath,["5018","5017"],[cmdVal1,cmdVal2]);break;case"openFormulaEditor":this.submitAction(this.elem,mstrUpdateManager.OPEN_FORMULA_EDITOR,pb.beanPath,["6036","6037"],[cmdVal1,cmdVal2]);break;case"setPropertyValues":this.submitAction(this.elem,mstrUpdateManager.REPORT_EVENT_SET_PROPERTY_VALUES,pb.beanPath,["4146"],[cmdVal1]);break;case"quickTotals":case"addViewFilterCondition":case"toggleThresholds":case"banding":case"outline":case"mergeCols":case"mergeRows":case"lockCols":case"lockRows":case"fitContents":case"fitWindow":case"attForms":var m=this.getActionMap(cmdId);this.submitAction(m.e,m.id,pb.beanPath,m.s,m.v);break;case"saveReport":var folderId=pb.getSaveFolderId();var args=["3013"];var argv=[false];if(folderId){args.push("3014");argv.push(folderId);}um.useIframe=false;this.submitAction(this.elem,mstrUpdateManager.SAVE_GRID,microstrategy.servletName,args,argv);break;case"optimizedMode":um.useIframe=false;this.submitAction(this.elem,mstrUpdateManager.CHANGE_OPTIMIZED_MODE,microstrategy.servletName,["3017"],["1"]);break;case"designMode":um.useIframe=false;this.submitAction(this.elem,mstrUpdateManager.CHANGE_DESIGN_MODE,pb.beanPath,["3017"],["1"]);break;case"browseParent":if(!pb.parentFolderID||pb.isParentFolderHidden){return this.exec("openHome");}um.useIframe=false;this.submitAction(null,mstrUpdateManager.BROWSE_FOLDER,microstrategy.servletName,["1001"],[pb.parentFolderID]);break;case"openHome":um.useIframe=false;this.submitAction(null,mstrUpdateManager.OPEN_DESKTOP,microstrategy.servletName,[],[]);break;case"export":case"print":case"printPDF":case"buttonPDF":case"buttonFlash":var viewMode=1;viewMode=pb.isGraph?viewMode+1:viewMode;viewMode=pb.isGrid&&pb.isGraph?viewMode+1:viewMode;var target=pb.isFeatureAvailable("export-new-window")?"_blank":"mstrExportWindow";exportReport(null,target,cmdId,viewMode);break;case"toggleScreenMode":toggleScreenMode();break;case"gridEditor":case"graphEditor":case"gridOptions":case"resizeEditor":this.exec("showBean",cmdId,true);break;case"sort":microstrategy.openAdvSortEditor({beanPath:pb.beanPath,subtotalPosition:pb.subtotalPosition,isReportDesignMode:mstrGridReport.isDesignMode(),isReportBlank:pb.isReportBlank,sourceAxis:cmdVal1&&cmdVal1[0],sourceType:cmdVal1&&cmdVal1[1],targetGrid:pb,taskParams:{taskId:"reportExecute",styleName:"AdvSortDataStyle",startCol:pb.startCol,maxCols:pb.maxCols,msgID:mstrApp.getMsgID()}});break;case"drill":toggleShowBean("drillEditor",!this.queryState("drill"));break;case"editDM":case"newMetric":var mid=mstrApp.getMsgID(),dss=[pb.wksInfos],src=microstrategy.activeCXMenu,gsi=pb.gridStructureInfo,curId="",curName="",unitPos=1,config={datasets:dss,msgID:mid},actions=[];if(src){curId=src.getAttribute(microstrategy.HTMLATTR_DSS_ID);curName=src.getAttribute(microstrategy.HTMLATTR_DISPLAY_NAME);unitPos=src.getAttribute(microstrategy.HTMLATTR_GRIDCELL_DEPTH);}else{var mu=gsi&&gsi.metricAxis&&gsi.metricAxis.units&&gsi.metricAxis.units[0];if(mu){curId=mu.dssId;curName=mu.alias;unitPos=mu.depth;}}var submitAction=function(actions){um.add(actions);um.flushAndSubmitChanges();};if(cmdId==="newMetric"){config.metricId="";config.action={cmd:"editNew",refOi:{did:curId,n:curName}};config.onApplyMetricCallback=function(cfg){var argNames=["4031","4032","4259","4029"],argVals=[cfg.alias,cfg.tokenStreamXML,!mstrmojo.string.isEmpty(cfg.tokenStreamXML),unitPos+1];if(cfg.afb!==undefined){argNames.push("4260");argVals.push(cfg.afb);}if(cfg.sfb!==undefined){argNames.push("4258");argVals.push(cfg.sfb);}actions.push(um.createActionObject(null,mstrUpdateManager.ADD_DERIVED_METRIC,pb.beanPath,argNames,argVals));submitAction.call(this,actions);};}else{config.metricId=curId;config.action={cmd:"edit",n:curName};config.onApplyMetricCallback=function(cfg){var argNames=["4248","4031","4032","4259"],argVals=[curId,cfg.alias,cfg.tokenStreamXML,!mstrmojo.string.isEmpty(cfg.tokenStreamXML)];if(cfg.afb!==undefined){argNames.push("4260");argVals.push(cfg.afb);}if(cfg.sfb!==undefined){argNames.push("4258");argVals.push(cfg.sfb);}actions.push(um.createActionObject(null,mstrUpdateManager.CHANGE_METRIC_FORMULA,pb.beanPath,argNames,argVals));submitAction.call(this,actions);};}microstrategy.openDerivedMetricEditor(config);break;case"renameEditObjects":this.exec("openFormulaEditor","1",false);break;case"toggleattforms":case"toggleAttributeForms":pb.toggleAttForms();break;case"editTotals":this.exec("showBean","ReportSubtotalsDHTMLEditor",true);break;case"advancedThresholds":this.exec("showBean","edtAdvancedThresholds",true);break;case"setGridUnitSelections":pb.setGridUnitSelections(cmdVal1.unit,cmdVal1.value);break;case"tbGridUnitSelector":pb.setGridUnitSelections(cmdVal1,Math.max(pb.gridValueFormat,microstrategy.GRID_BORDERS));break;case"tbGridValueSelector":pb.setGridUnitSelections(pb.gridUnitFormat,cmdVal1);break;case"tbGraphUnitSelector":var gb=(pb.isGraph&&!pb.isGrid)?pb:microstrategy.bone(pb.id+"_graph");if(gb){pb.setGraphSelected(true);gb.commands.exec(cmdId,cmdVal1);pb.notifySelectionChange("ongridselectionschange");}break;case"tbUnitSelector":if(cmdVal1!="-1"){if(cmdVal1.indexOf("**grid")>-1){pb.setGraphSelected(false);this.exec("tbGridUnitSelector",cmdVal1.replace("**grid",""));}else{if(cmdVal1.indexOf("**graph")>-1){if(pb.selections&&pb.selections.removeAllHilites){pb.selections.removeAllHilites(true);}this.exec("tbGraphUnitSelector",cmdVal1.replace("**graph",""));}}}else{pb.notifySelectionChange("ongridselectionschange");}break;case"tbValueSelector":pb.graphSelected?this.exec("tbGraphValueSelector",cmdVal1):this.exec("tbGridValueSelector",cmdVal1);break;case"FontFamily":case"FontSize":case"Underline":case"GridHorizontal":case"IncreaseDecimal":case"DecreaseDecimal":case"Currency":case"IntlCurrency":case"Percent":case"Comma":case"FillColor":case"lncolor":case"borders":case"FontColor":case"lnstyle":pb.processSingleFormattingProperty(cmdId,cmdVal1);break;case"Bold":case"Italic":pb.processSingleFormattingProperty(cmdId,cmdVal1?microstrategy.TRUE:microstrategy.FALSE);break;case"autoArrange":var graphBone=microstrategy.bone(pb.id+"_gb");if(graphBone){graphBone.submitAutoArrange(pb.id);}break;case"major":case"minor":if(pb.isGrid&&pb.isGraph){microstrategy.bones[pb.id+"_graph"].exec(cmdId,cmdVal1);}return true;case"toggleReportBar":var showBar=this.queryState("toggleReportBar")?"0":"1";this.submitAction(this.elem,mstrUpdateManager.TOGGLE_REPORT_BAR,pb.beanPath,["6050"],[showBar]);break;case"exportMenu":var target=mstr.behaviors.featureResolver.featAvailable("export-new-window")?"_blank":"mstrExportWindow";exportReport(cmdVal1,target,"export",pb.currentView);break;case"customVisualizations":this.exec("openReportFrameElement","visualizationsEditor");break;case"visPropsEditor":var args="scope="+cmdVal1[0]+"&selVis="+cmdVal1[1]+"&visEditorId="+cmdVal1[2];if(mstrGridReport.isRWD()){args+="&activeViewID="+pb.objId;}if(cmdVal1[3]){args+="&widgetPropsXml="+escape(cmdVal1[3]);}if(cmdVal1[4]){args+="&secDataProv="+escape(cmdVal1[4]);}if(mstrGridReport.isRWD()&&mstrGridReport.isDesignMode()){ac=[];ac.push(um.createActionObject(this.elem,mstrUpdateManager.APPLY_CHANGES,pb.beanPath,[],[],[]));pb.um.add(ac);}toggleShowBean("visPropsEditor",true,args);break;case"drillEditor":case"drillFilterEditor":this.exec("openReportFrameElement",cmdId);break;case"forwardPicker":case"backPicker":um.useIframe=false;var actionCollection=new Array();actionCollection.push(um.createActionObject(this.elem,mstrUpdateManager.OPEN_HISTORY_PAGE,microstrategy.servletName+"."+microstrategy.pageName,["3140"],[cmdVal1]));um.add(actionCollection,true);um.flushAndSubmitChanges();return true;case"toggleHideNullsOrZeros":var hidden=this.queryState("HideNullsOrZeros"),ac=[];ac.push(um.createActionObject(this.elem,mstrUpdateManager.TOGGLE_HIDE_NULLS,pb.beanPath,["4261"],[(hidden)?microstrategy.TRUE:microstrategy.FALSE],[],null));um.add(ac,true);um.flushAndSubmitChanges();break;default:if(pb.exec(cmdId,cmdVal1)){return true;}mstrGridStaticCommands.prototype.exec.call(this,cmdId,cmdVal1,cmdVal2,cmdVal3,cmdVal4);}return false;}catch(err){microstrategy.errors.log(err);return false;}};mstrGridReport.prototype.askBeforeSaveOverwrite=function(){try{var textLabel=mstrGridReport.desp("11165").replace(/##/,"<b>"+this.objName+"</b>");var checkBoxLabel="<label for='askBeforeSaveCheckbox' id='glabel'> "+mstrGridReport.desp("211")+" </label>";var askCheckbox="<input name='askBeforeSave' id='askBeforeSaveCheckbox' type='checkbox'/> ";showMessage({contents:"<div style='overflow:auto'>"+textLabel+"</div><br/><br/><div style='overflow:auto' text-align:center>"+askCheckbox+checkBoxLabel+"</div>",elements:microstrategy.APPLY_BUTTON+microstrategy.OK_BUTTON+microstrategy.CANCEL_BUTTON,applyEval:"microstrategy.bones['"+this.id+"'].submitSave()",okEval:"microstrategy.bones['"+this.id+"'].saveReport()",buttonLabels:{Apply:microstrategy.descriptors.getDescriptor("219"),Ok:microstrategy.descriptors.getDescriptor("218")},title:mstrGridReport.desp("5728"),type:mstrMsgBoxImpl.MSG_TEXT_ONLY});}catch(err){microstrategy.errors.log(err);}};mstrGridCommands.prototype.submitAction=function(elem,actId,bp,args,argv){this.parentBone.addAction(elem,actId,bp,args,argv);};mstrGridCommands.prototype.getActionMap=function(arg){var am=this.am;var pb=this.parentBone;var u=mstrUpdateManager;if(!am){am={quickTotals:{id:u.ADD_QUICK_SUBTOTAL},addViewFilterCondition:{id:u.ADD_VIEW_FILTER_CONDITION},attForms:{id:u.OPEN_ATT_FORMS_EDITOR},toggleThresholds:{id:u.REPORT_EVENT_SET_THRESHOLDS_DISPLAY,s:["4193"],v:[pb.thresholdsState?0:1]},banding:{id:u.REPORT_EVENT_SHOW_BANDING,s:["4125"],v:[pb.isFeatureAvailable(microstrategy.FEATURE_CHECK_SHOW_BANDING)?0:1]},outline:{id:u.REPORT_EVENT_SHOW_OUTLINE_MODE,s:["4121"],v:[pb.isFeatureAvailable(microstrategy.FEATURE_CHECK_OUTLINE_MODE)?0:1]},mergeCols:{id:u.MERGE_COLUMN_HEADERS,s:["6038"],v:[!pb.isFeatureAvailable(microstrategy.FEATURE_CHECK_MERGE_COL_HEADER)]},mergeRows:{id:u.REPORT_EVENT_SET_PROPERTY_VALUES,s:["4126","4146"],v:[pb.styleName,"4!Template Formatting!MergeCells!"+(pb.isFeatureAvailable(microstrategy.FEATURE_CHECK_MERGE_ROW_HEADER)?0:-1)]},lockCols:{id:u.REPORT_EVENT_SET_PROPERTY_VALUES,s:["4146"],v:["4!Template Formatting!LockColumnHeaders!"+(pb.isFeatureAvailable("check-lock-column-headers")?0:1)]},lockRows:{id:u.REPORT_EVENT_SET_PROPERTY_VALUES,s:["4146"],v:["4!Template Formatting!LockRowHeaders!"+(pb.isFeatureAvailable("check-lock-row-headers")?0:1)]},fitContents:{id:u.REPORT_EVENT_SET_COLUMN_SCENARIO,s:["4153","4154","4155","4056"],v:["2","2","1","1"]},fitWindow:{id:u.REPORT_EVENT_SET_COLUMN_SCENARIO,s:["4153","4154","4155","4056"],v:["1","2","1","1"]}};this.am=am;}var m=am[arg];m.e=this.elem;if(!m.s){m.s=[];}if(!m.v){m.v=[];}return m;};mstrGridCommands.prototype.queryEnabled=function(cmdId,skipGraph){try{var pb=this.parentBone;if(!skipGraph&&((pb.isGraph&&mstrGridStatic.isGraphCommand(cmdId))||(pb.graphSelected&&mstrGridStatic.isGridGraphCommand(cmdId)))){var graphBone=microstrategy.bone(pb.id+"_graph");return graphBone&&graphBone.commands.queryEnabled(cmdId);}var selections=null;var match;if(cmdId&&(match=cmdId.match(/exportMenu;/))&&match.index==0){return true;}var fn=function(s,v){var c=true;if(v){c=!pb.isVisualization;}return(pb.isFeatureAvailable(microstrategy["FEATURE_"+s])&&c);};var fr=function(s){return mstr.behaviors.featureResolver.featAvailable(s+"-formatting");};switch(cmdId){case"Hmode":return !(microstrategy.formatType==mstrGridReport.FMT_TYPE_TITLE);case"Height":return(microstrategy.formatType==mstrGridReport.FMT_TYPE_TITLE&&pb.showTitleBar()==true);case"number":case"IntlCurrency":case"Currency":case"deltaDecimal":case"IncreaseDecimal":case"DecreaseDecimal":case"Percent":case"Comma":if((fr("number")||fr("grid-graph"))&&this.queryEnabled("canUseGridFormatting")){return !(pb.selectedPosition=="-9"||pb.selectedPosition=="-99");}else{return false;}case"TextAlign":case"align":case"font":case"FontFamily":case"fsize":case"FontSize":case"color":case"FontColor":case"fstyle":case"Bold":case"Italic":case"Underline":case"GridHorizontal":return this.queryEnabled("canUseGridFormatting")&&fr("grid-graph")&&!((pb.selectedPosition=="-9"&&pb.selectedLevel=="8")||pb.gridUnitFormat==microstrategy.GRID_BORDERS);case"FillColor":case"bgcolor":return this.queryEnabled("canUseGridFormatting")&&(fr("grid-graph")&&pb.gridUnitFormat!=microstrategy.GRID_BORDERS);case"lncolor":case"borders":case"lnstyle":return this.queryEnabled("canUseGridFormatting")&&fr("grid-graph")&&!(pb.selectedPosition=="-9"&&pb.selectedLevel=="9");case"canUseGridFormatting":var r=!this.queryState("Shortcut")&&!(pb.selectedPosition=="-999"&&(pb.selectedLevel=="1"||pb.selectedLevel=="5")&&pb.hasNoMetrics);return r&&(pb.graphSelected||mstr.behaviors.featureResolver.featAvailable("change-grid-autostyle"));case"lineColor":case"borderLeftStyle":case"lineStyle":return(microstrategy.formatType==microstrategy.FORMAT_TYPE_MAIN);case"advColorPicker":case"onegrid":case"edtSort":case"edtRename":case"level":case"target":case"graphCategory":case"graphTarget":case"reportFilter":case"promptDetails":case"fmtToolbar":case"advColorPicker":case"visualizationsEditor":case"edtColorGradient":case"gradientcolor":case"export":case"saveReport":case"designMode":case"save":case"print":case"printPDF":case"browseParent":case"toggleScreenMode":case"createDocFromRpt":case"createIVEFromRpt":case"createHTML5IVEFromRpt":case"gridOptions":case"addViewFilterCondition":case"visFlashMode":case"visAjaxMode":case"toggleGraphZones":case"toggleReportBar":case"buttonPDF":case"buttonFlash":case"FilterDetailsFormat":case"drillFilterEditor":case"optimizedMode":return true;case"menuDirectSave":if(mstrGridReport.isDesignMode()){return pb.gridStructureInfo!=null&&!pb.gridStructureInfo.hasNoUnits;}else{return pb.saveEnabled;}case"dSave":if(pb.isFeatureAvailable(microstrategy.FEATURE_FORCE_SAVE_AS)){return true;}else{return pb.saveEnabled;}case"togglePivot":case"toggleSort":return pb.isGrid;case"renameEditObjects":return fn("ENABLE_RENAME_EDIT_OBJECT",true);case"newMetric":return fn("ENABLE_INSERT_NEW_METRIC",true);case"editTotals":return fn("ENABLE_SHOW_TOTALS",true);case"toggleSubtotals":return fn("ENABLE_SHOW_SUBTOTALS");case"sort":return fn("ENABLE_SORT",true);case"drill":case"drillEditor":return fn("ENABLE_DRILL_EDITOR",true);case"viewFilter":return fn("ENABLE_VIEW_FILTER_EDITOR");case"pageBy":return fn("ENABLE_PAGE_BY");case"allObjects":return !fn("IS_VIEW_REPORT")&&fn("ENABLE_OBJECT_BROWSER");case"objBrowser":return fn("ENABLE_OBJECT_BROWSER");case"ncSendNow":return fn("ENABLE_SEND_NOW");case"gridMode":return fn("ENABLE_GRID_MODE");case"graphMode":return fn("ENABLE_GRAPH_MODE");case"gridGraphMode":return fn("ENABLE_GRID_GRAPH_MODE");case"redo":return((pb.um.anyNonStatic(true)||pb.isReportRedoable)&&!pb.isVisualization);case"undo":return((pb.um.anyNonStatic(false)||pb.isReportUndoable)&&!pb.isVisualization);case"gridGraphCategory":return pb.isGrid&&pb.isGraph;case"autoArrange":var graphBone=microstrategy.bone(pb.id+"_gb");return graphBone&&!graphBone.autoArrange;case"edtDMetric":return !pb.isTemplateEmpty();case"quickThresholds":return pb.isGrid&&pb.selections&&pb.selections.hasMetricsSelected&&pb.selections.hasMetricsSelected()&&pb.isFeatureAvailable(microstrategy.FEATURE_EMBEDDED_TEMPLATE_NODE);case"checkMergeRowHeader":return this.queryEnabled("mergeHeader")&&!this.queryState("tOutline")&&mstr.behaviors.featureResolver.featAvailable("enable-grid-format-editor");case"checkMergeColHeader":return this.queryEnabled("mergeHeader");case"mergeHeader":case"autostyle":case"tbanding":case"tOutline":case"checkLockColHeader":case"checkLockRowHeader":case"fittocontent":case"fittowindow":case"edtSortGridMenu":case"edtSortGrid":case"vfeRWGrid":case"gridNoVisNoEmpty":return pb.isGrid&&pb.isFeatureAvailable(microstrategy.FEATURE_EMBEDDED_TEMPLATE_NODE)&&!((pb.isVisualization&&pb.docViewer&&!pb.docViewer.isEditableViewModeEplus())||pb.isTemplateEmpty());case"toggleAttributeForms":case"toggleattforms":if(!this.queryEnabled("gridNoVisNoEmpty")){return false;}var atts=pb.gridStructureInfo&&pb.gridStructureInfo.getAttributes();var anyAttForm=false;if(!atts){return false;}for(var i=0;i<atts.length;i++){anyAttForm|=atts[i].hasAttForms();if(anyAttForm){return true;}}return false;case"graphCategory":case"graphTarget":case"graphZones":return pb.isGraph&&fn("EMBEDDED_TEMPLATE_NODE")&&!(pb.isVisualization||pb.isTemplateEmpty());case"visualizationMode":return pb.visualizationsEnabled;case"selectedVisualization":return pb.visualizationList&&pb.visualizationList.length>0;case"isLinkedGrid":return !fn("EMBEDDED_TEMPLATE_NODE");case"toggleThresholds":case"ShowThreshold":return pb&&(pb.isGrid||pb.isGraph)&&pb.hasThresholds&&fn("EMBEDDED_TEMPLATE_NODE");case"simpleThresholds":case"advancedThresholds":case"edtSubtotals":case"addQuickTotals":case"edtSubtotalsOldIServer":case"openSimpleThresholdEditor":case"openAdvThresholdEditor":return this.queryEnabled("hasmetrics")&&fn("EMBEDDED_TEMPLATE_NODE");case"comboToggleButton":return this.queryEnabled("addQuickTotals")&&(this.queryEnabled("toggleSubtotals")||fn("SHOW_TOTALS"));case"hasmetrics":return !pb.hasNoMetrics;case"tsubtotals":return fn("ENABLE_SHOW_SUBTOTALS")&&fn("EMBEDDED_TEMPLATE_NODE");case"edtResize":return pb.isGrid&&this.queryEnabled("notEmptyTemplate");case"notEmptyTemplate":case"swapAxes":return(pb.gridStructureInfo!=null&&fn("EMBEDDED_TEMPLATE_NODE"))?!pb.gridStructureInfo.isEmptyTemplate:false;case"attForms":return fn("ENABLE_MODIFY_ATTRIBUTE_FORMS")&&pb.gridStructureInfo&&pb.gridStructureInfo.getAttributes()&&pb.gridStructureInfo.getAttributes().length>0;case"fos":selections=mstr.behaviors.featureResolver.featAvailable("is-not-single-row-report")&&this.queryEnabled("mdxOneSelection")&&pb.selections;return(selections!=null&&selections.getSelectedDrillElementsCount&&selections.getSelectedDrillElementsCount()>0&&selections.anyAttributeElementSelected());case"b3dstyle":case"b3dweight":case"enabled3d":return(pb.selectedPosition=="-9"&&pb.selectedLevel=="8")||pb.selectedPosition=="-99";case"fontprops":case"numberprops":case"alignprops":case"colorprops":return true;case"moveLeft":case"moveRight":case"moveUp":case"moveDown":return(pb.selections!=null&&pb.selections.allOnOneAxis());case"showRight":var selections=pb&&pb.selections;if(selections){var items=selections.getSelectedCellsWithAttr("dg","true");if(items.length==0){return false;}items.sort(function(a,b){return(parseInt(a.getAttribute(microstrategy.HTMLATTR_GRIDCELL_DEPTH))-parseInt(b.getAttribute(microstrategy.HTMLATTR_GRIDCELL_DEPTH)));});var depth=items[items.length-1].getAttribute(microstrategy.HTMLATTR_GRIDCELL_DEPTH);var info=pb.gridStructureInfo.getGridUnitInfoBySrc(items[items.length-1]);return info.index<(pb.gridStructureInfo.allAxes[(info.axis==microstrategy.GRIDCELL_AXIS_METRICS)?0:info.axis].units.length-1);}return false;case"showLeft":var selections=pb&&pb.selections;if(selections){var items=selections.getSelectedCellsWithAttr("dg","true");if(items.length==0){return false;}items.sort(function(a,b){return(parseInt(b.getAttribute(microstrategy.HTMLATTR_GRIDCELL_DEPTH))-parseInt(a.getAttribute(microstrategy.HTMLATTR_GRIDCELL_DEPTH)));});var depth=items[items.length-1].getAttribute(microstrategy.HTMLATTR_GRIDCELL_DEPTH);var info=pb.gridStructureInfo.getGridUnitInfoBySrc(items[items.length-1]);return info.index>0;}return false;case"dmFilters":case"dmCancel":return mstrGridReport.isDesignMode();case"dmRun":case"dmSave":case"dmSaveAs":return mstrGridReport.isDesignMode()&&(pb.gridStructureInfo!=null&&!pb.gridStructureInfo.hasNoUnits);case"deList":case"deCalc":case"deSum":case"deAvg":case"deMin":case"deMax":case"deMinus":case"deDivide":case"editSelector":case"links":case"dynLinks":selections=pb.selections;var b=selections.singleAttributeElementsAreSelected();var c=selections.getSelectedItemCount();var d=!selections.containsDerivedElements();var u=pb.getSelectedUnit();var bm={deList:b&&c>=1&&d,dynLinks:d||(!b&&c==1),deCalc:b&&c>1&&(d||!(u&&u.src.getAttribute("pthr"))),deSum:b&&c>1,deAvg:b&&c>1,deMin:b&&c>1,deMax:b&&c>1,deMinus:b&&c==2,deDivide:b&&c==2,editSelector:c==1,links:c>=1}[cmdId];return selections!=null&&bm;case"WebHyperLinkEditor":case"showWebHyperLinkEditor":if(pb.selections&&pb.selections.getSelectedItemCount()==1){var units=pb.selections.getItems();if(units&&units[0]){var dssType=units[0].getAttribute(microstrategy.HTMLATTR_DSS_TYPE);return(dssType==microstrategy.DSSTYPE_METRIC||dssType==microstrategy.DSSTYPE_ATTRIBUTE||dssType==microstrategy.DSSTYPE_CONSOLIDATION||dssType==microstrategy.DSSTYPE_CUSTOM_GROUP);}}return false;case"showPageByHyperLinkEditor":return true;case"isGraph":return pb.isGraph;case"graphEditor":return(fr("grid-graph")||fr("simple-graph"))&&pb.isGraph;case"gridEditor":return(fr("grid-graph")||fr("number"))&&pb.isGrid&&mstr.behaviors.featureResolver.featAvailable("enable-grid-format-editor");case"tbGridUnitSelector":case"tbGridValueSelector":return pb.isGrid&&!pb.isGraph;case"tbGraphUnitSelector":case"tbGraphValueSelector":return !pb.isGrid&&pb.isGraph;case"tbUnitSelector":case"tbValueSelector":return pb.isGrid||pb.isGraph;case"rmcDrilling":case"rmcPageByDrilling":case"mdxOneSelection":if(pb.isMdxCube){selections=pb.selections;var c=selections?selections.getSelectedItemCount():0;var bc=c==0;if(cmdId=="rmcDrilling"||cmdId=="mdxOneSelection"){bc=c==1;if(!bc&&pb.gridStructureInfo&&pb.gridStructureInfo.showAttForms){bc=selections&&selections.getSelectedDrillElementsCount&&selections.getSelectedDrillElementsCount()==1;}}return selections!=null&&bc;}if("rmcDrilling"==cmdId){var selIts=(pb.selections&&pb.selections.getItems())||[],td=selIts[0];return td!=null&&td.getAttribute?td.getAttribute("emp")!="1":true;}return true;case"resizeEditor":return mstr.behaviors.featureResolver.resolveFeatSet("enable-resize-columns-rows;is-not-visualization-mode");case"vfeRWView":return !pb.isVFEmpty;case"toggleHideNullsOrZeros":return mstrGridReport.isViewMode()&&fn("EMBEDDED_TEMPLATE_NODE");default:return mstrGridStaticCommands.prototype.queryEnabled.call(this,cmdId);}}catch(err){microstrategy.errors.log(err);return false;}};mstrGridCommands.prototype.queryState=function(cmdId,cmdValue,skipGraph){try{var pb=this.parentBone;if(!skipGraph&&((pb.isGraph&&mstrGridStatic.isGraphCommand(cmdId))||(pb.graphSelected&&mstrGridStatic.isGridGraphCommand(cmdId)))){var graphBone=microstrategy.bone(pb.id+"_graph");return graphBone&&graphBone.commands.queryState(cmdId,cmdValue,skipGraph);}var bone=null;var format=mstrFormatObject;var i,guItems,unitsObjs,graphBone;var fn=function(s){return pb.isFeatureAvailable(microstrategy["FEATURE_"+s]);};var gfv=function(p,q){return pb.getGridFormatValue({unit:pb.gridUnitFormat,format:pb.gridValueFormat},p,q);};var bs=pb.selections;switch(cmdId){case"isGraphSelected":return pb.graphSelected;case"isLocked":var unit=pb.gridStructureInfo.findUnit(cmdValue);return(unit)?unit.isLocked:false;case"existSelectedUnits":return(bs&&bs.getSelectedUnitsCount()>0);case"selectedTarget":return(bs)?bs.getSelectedGridTarget():null;case"selectedLevel":return(bs)?bs.getSelectedGridLevel():null;case"selected":case"SubType":if(pb.isWidget){return mstrGridReport.desp("4921");}switch(parseInt(pb.effectiveView)-1){case microstrategy.GRID_EFFECTIVE_VIEW_GRAPH:return mstrGridReport.desp("3479");case microstrategy.GRID_EFFECTIVE_VIEW_GRID_GRAPH:return mstrGridReport.desp("3702");default:return mstrGridReport.desp("3624");}case"isOnGrid":var objInfo=pb.gridStructureInfo.buildGridUnitInfo(cmdValue);return(pb.gridStructureInfo.findUnitInfo(objInfo)!=null);case"getRowHeight":return pb.colWidths.getRowHeight();case"getGridWidthsObj":if(pb.colWidths==null){pb.setupColResize();}return pb.colWidths!=null?pb.colWidths.getColWidthsObj():null;case"selectedGrid":return pb.elem;case"tbanding":return pb.checkBanding;case"checkLockRowHeader":return fn("CHECK_LOCK_ROW_HEADERS");case"checkLockColHeader":return fn("CHECK_LOCK_COLUMN_HEADERS");case"checkMergeRowHeader":return fn("CHECK_MERGE_ROW_HEADER")||this.queryState("tOutline");case"checkMergeColHeader":return fn("CHECK_MERGE_COL_HEADER");case"tsubtotals":case"checkSubtotals":return fn("CHECK_SHOW_SUBTOTALS");case"tOutline":return fn("CHECK_OUTLINE_MODE");case"checkBanding":case"enableLegends":case"enableLabels":case"allowedGraphTypes":case"styleName":return pb[cmdId];case"assoNodesDrill":var manipCat={assoNodesDrill:"1"}[cmdId];return("associatedNodes" in pb)?pb.associatedNodes[manipCat]:false;case"target":return pb.selectedAxis+","+pb.selectedPosition+","+pb.selectedUnit;case"level":return pb.selectedLevel;case"autostyle":return pb.autostyleId||"custom";case"selectedVisualization":var visualizationItems=[];var selected=-1;var visList=pb.visualizationList;if(visList&&visList.length>0){for(i=0;i<visList.length;i++){if(pb.selectedVisualization==visList[i].name){selected=i;}visualizationItems.push({dssid:visList[i].name+"|"+visList[i].vm,n:visList[i].desc});}return{items:visualizationItems,value:visList[selected].name+"|"+visList[selected].vm};}return{items:[]};case"toggleThresholds":case"ShowThreshold":return pb.thresholdsState;case"toggleAttributeForms":case"toggleattforms":return pb.showAttForms;case"fittocontent":return(pb.gridWidthInfo)?pb.gridWidthInfo.colScenario==mstrGridReport.COL_WIDTH_FIT_TO_CONTENT:false;case"fittowindow":return(pb.gridWidthInfo)?pb.gridWidthInfo.colScenario==mstrGridReport.COL_WIDTH_FIT_TO_DISPLAY:false;case"objBrowser":bone=microstrategy.bone("accordion_AccordionTabManagerStyle");return(bone&&bone.currentTabName==microstrategy.ACCORDION_REPORT_RP_OBJECT_PANEL);case"allObjects":bone=microstrategy.bone("accordion_AccordionTabManagerStyle");return(bone&&bone.currentTabName==microstrategy.ACCORDION_REPORT_ALL_OBJECT_PANEL);case"pageBy":bone=microstrategy.bone("pbb_PageByStyle");return(bone&&isInDocument(bone.elem));case"reportFilter":bone=microstrategy.bone("rfe_pane");return(bone&&isInDocument(bone.elem));case"viewFilter":bone=microstrategy.bone("vfep_pane");return(bone&&isInDocument(bone.elem));case"promptDetails":bone=microstrategy.bone("promptDetails_PromptDetailsStyle");return(bone&&isInDocument(bone.elem));case"simpleThresholds":bone=microstrategy.bone("edtReportSimpleThresholds_SimpleThresholdsReportEditorStyle");return(bone&&isInDocument(bone.elem));case"formatToolbar":return(microstrategy.bone("reportFormatToolbar"))?true:false;case"gridPosition":case"gridFactor":var container=microstrategy.findAncestor(pb.elem.parentNode);if(container){return(cmdId=="gridPosition")?mstrGridReport.styAttrValue(container,"GRID_POS"):mstrGridReport.styAttrValue(container,"GRID_AREA_PCT");}break;case"selections":var selectionFromToolbar=bs&&bs.lastSelectionIsFromToolbar&&bs.lastSelectionIsFromToolbar();var gvu=pb.gridUnitFormat;var gvf=pb.gridValueFormat;var isValidNonUnitSelected=(gvu!=-1)&&(gvf!=-1);if(selectionFromToolbar&&isValidNonUnitSelected){return"{ src: true, unit: "+gvu+", value: "+gvf+" }";}else{return(bs&&bs.getSelections)?bs.getSelections():null;}case"graphSelections":var graphSelections="'graphSelected':"+(pb.graphSelected?"true":"false");if(pb.graphSelected&&pb.selectedGraphUnit&&pb.selectedGraphTargetValue){graphSelections+=",'graphSelectedUnit':'"+pb.selectedGraphUnit+"','graphSelectedValue':'"+pb.selectedGraphTargetValue+"'";}return"{"+graphSelections+"}";case"selectedDrillElements":return(bs!=null&&bs.getSelectedDrillElements)?bs.getSelectedDrillElements():"";case"dmFilters":return pb.isFilterVisible;case"ShowDrillingOptions":return fn("SHOW_GRID_OPTIONS_DRILL");case"RHS":case"RHM":case"RHL":case"CHS":case"CHM":case"Outline":case"Banding":case"ShowThreshold":case"TitleOverlap":case"enableAttForms":case"enableThresholds":return("editorProperties" in pb&&pb.editorProperties[cmdId]==microstrategy.TRUE);case"CHL":return("editorProperties" in pb&&pb.editorProperties[cmdId]!==microstrategy.FALSE);case"HideNullsOrZeros":return pb.ShowAllRows===microstrategy.FALSE;case"HideNullZeroValues":return pb.HideNullZeroValues;case"AttForms":case"DrillOptions":return("editorProperties" in pb)?pb.editorProperties[cmdId]:"";case"isShowHeadersAvailable":return(mstrGridReport.isRWD());case"isMergeHeadersAvailable":return this.queryState("isGridFormattingEnabled");case"isLockHeadersAvailable":return pb.isFeatureAvailable("lock-grid-headers");case"isNonLinkedTemplate":return !this.queryState("isLinkedTemplate");case"Shortcut":case"isLinkedTemplate":return !fn("EMBEDDED_TEMPLATE_NODE");case"isGridFormattingEnabled":return(microstrategy.EXECUTION_SCOPE!=microstrategy.REPORT_EXECUTION||pb.isFeatureAvailable("enable-grid-format-editor"));case"DataSource":return pb.gridStructureInfo.dataSetId;case"effectiveView":return pb.effectiveView;case"areGridFormatsReady":return(pb.getGridFormats()!=null);case"getControlGroupByList":return pb.ControlGroupByList;case"GraphExportOverflow":return pb.xgovf;case"GraphExportOverflowSpacing":return pb.xgovfs;case"togglePivot":return fn("CHECK_SHOW_PIVOT_BUTTONS");case"toggleSort":return fn("CHECK_SHOW_SORT_BUTTONS");case"toggleGraphZones":return fn("CHECK_SHOW_GRAPH_ZONES");case"promptDetails":return !!microstrategy.bone("promptDetails_PromptDetailsStyle");case"viewFilter":return !!microstrategy.bone("vfep_pane");case"pageBy":return !!microstrategy.bone("pbb_PageByStyle");case"reportFilter":return !!microstrategy.bone("rfe_pane");case"drill":var drillEditor=document.getElementById("drillEditor_BeanGeneratedOutputStyle");return drillEditor&&drillEditor.hasChildNodes()&&drillEditor.firstChild.style.display!="none";case"comboToggleButton":case"toggleSubtotals":return fn("CHECK_SHOW_SUBTOTALS");case"gridMode":return pb.isGrid&&!pb.isGraph&&!this.queryState("visFlashMode")&&!this.queryState("visAjaxMode");case"graphMode":return !pb.isGrid&&pb.isGraph&&!this.queryState("visFlashMode")&&!this.queryState("visAjaxMode");case"gridGraphMode":return pb.isGrid&&pb.isGraph&&!this.queryState("visFlashMode")&&!this.queryState("visAjaxMode");case"visFlashMode":return pb.isVisualization&&pb.visualizationMode==50;case"visAjaxMode":return pb.isVisualization&&pb.visualizationMode==51;case"XTabView":if(this.queryState("gridMode")){return"1";}if(this.queryState("graphMode")){return"2";}if(this.queryState("gridGraphMode")){return"3";}if(this.queryState("visFlashMode")){return"50";}if(this.queryState("visAjaxMode")){return"51";}return"1";case"GridSelections":return{unit:pb.gridUnitFormat,value:pb.gridValueFormat};case"AllGridUnitSelector":case"tbGridUnitSelector":case"GridUnitSelector":var frsa=mstr.behaviors.featureResolver.featAvailable;var onlyMetrics=!frsa("grid-graph-formatting")&&frsa("number-formatting");guItems=pb.getGridUnitSelectorItems(onlyMetrics);var items=[];if(!onlyMetrics){items.push({dssid:mstrGridReport.ALL_UNITS,n:mstrGridReport.desp("4754"),cssClass:"ToolbarList UAC"},{dssid:mstrGridReport.ROW_UNITS,n:mstrGridReport.desp("2185"),cssClass:"ToolbarList URA"},{dssid:mstrGridReport.COL_UNITS,n:mstrGridReport.desp("2184"),cssClass:"ToolbarList UCA"});}items.push({dssid:mstrGridReport.METRIC_UNITS,n:mstrGridReport.desp("2460"),tp:parseInt(microstrategy.DSSTYPE_METRIC,10),cssClass:"ToolbarList UMA"});unitsObjs={items:items.concat(guItems),value:pb.gridUnitFormat,isFetching:!this.queryState("areGridFormatsReady")};if(cmdId=="tbGridUnitSelector"&&unitsObjs.value==-1){unitsObjs.items.splice(0,0,{dssid:-1,n:mstrGridReport.desp("3625")});}return unitsObjs;case"tbGridValueSelector":case"AllGridUnitValueSelector":case"GridUnitValueSelector":var valuesObj={items:[{dssid:5,n:mstrGridReport.desp("2461")},{dssid:1,n:mstrGridReport.desp("2033")},{dssid:2,n:mstrGridReport.desp("2175")}],value:pb.gridValueFormat,isFetching:!this.queryState("areGridFormatsReady")};if(cmdId=="tbGridValueSelector"&&valuesObj.value==-1){valuesObj.items.splice(0,0,{dssid:-1,n:mstrGridReport.desp("3625")});}var u=pb.getSelectedGridUnitByIndex(pb.gridUnitFormat);if(pb.gridUnitFormat==mstrGridReport.METRIC_UNITS||(u&&u.dssType==microstrategy.DSSTYPE_METRIC)){return valuesObj;}valuesObj.items=valuesObj.items.concat([{dssid:3,n:mstrGridReport.desp("2034")},{dssid:4,n:mstrGridReport.desp("2035")}]);return valuesObj;case"tbGraphUnitSelector":var gb=microstrategy.bone(pb.id+"_graph");if(gb){return gb.commands.queryState(cmdId);}return{items:[],value:""};case"tbUnitSelector":var units={items:[],value:""};var graphUnits,gridUnits;var that=this;var fg=function(s){var gUnits;var v=(s=="Grid");var p=v?"Graph":"Grid";var d=v?"3478":"3479";if(pb["is"+s]){if(pb["is"+p]){units.items=units.items.concat({dssid:"-1",n:mstrGridReport.desp(d),cssClass:"ToolbarListH"});}gUnits=that.queryState("tb"+s+"UnitSelector");for(var x in gUnits.items){gUnits.items[x].dssid+="**"+s.toLowerCase();}units.items=units.items.concat(gUnits.items);}return gUnits;};gridUnits=fg("Grid");if(pb.isFeatureAvailable("grid-graph-formatting")){graphUnits=fg("Graph");}pb.setGraphSelected(pb.graphSelected||!gridUnits);units.value=pb.graphSelected?(graphUnits?graphUnits.value+="**graph":units.value):gridUnits.value+="**grid";return units;case"tbValueSelector":if(pb.graphSelected||!pb.isGrid){return this.queryState("tbGraphValueSelector");}else{return this.queryState("tbGridValueSelector");}case"FillColor_vf":return(mstr.Enum.ColorPickerFlags.NO_COLOR+mstr.Enum.ColorPickerFlags.MORE_COLORS+mstr.Enum.ColorPickerFlags.GRADIENT_COLORS+mstr.Enum.ColorPickerFlags.USER_COLORS);case"lncolor_vf":return(mstr.Enum.ColorPickerFlags.MORE_COLORS+mstr.Enum.ColorPickerFlags.USER_COLORS);case"FillColor":return gfv("backgroundColor",true);case"FontColor":return gfv("color",true);case"Bold":return gfv("fontWeight",true)=="bold";case"Italic":return gfv("fontStyle",true)=="italic";case"Underline":var v=gfv("textDecoration",true);return(v&&v.indexOf("underline")>-1);case"FontSize":return format.encodeValue("fontSize",gfv("fontSize",true));case"FontFamily":return gfv("fontFamily",true);case"TextAlign":var res=gfv("textAlign",true);if(res in [3,4,2]){return{3:2,4:1,2:0}[res];}return -1;case"borders":return gfv("borders",false);case"toggleReportBar":var rt=document.getElementById("report_toolbar");return rt&&rt.childNodes.length!=0;case"forwardPicker":return pb.forwardHistory;case"backPicker":return pb.backHistory;case"toggleHideNullsOrZeros":return this.queryState("HideNullsOrZeros");default:return mstrGridStaticCommands.prototype.queryState.call(this,cmdId,cmdValue);}}catch(err){microstrategy.errors.log(err);}return"";};mstrGridCommands.prototype.queryVisible=function(cmdId){var pb=this.parentBone;switch(cmdId){case"visFlashMode":case"visAjaxMode":if(!pb.visualizationsEnabled){return false;}var visList=pb.visualizationList;for(var i=0;i<visList.length;i++){if(visList[i].vm==((cmdId=="visFlashMode")?50:51)){return true;}}return false;case"toggleGraphZones":return pb.isGraph;case"selectedVisualization":if(!pb.visualizationsEnabled){return false;}var visList=pb.visualizationList;if(visList){return visList.length>1;}return false;case"tbGridUnitSelector":case"tbGridValueSelector":return pb.isGrid&&!pb.isGraph;case"tbGraphUnitSelector":case"tbGraphValueSelector":return !pb.isGrid&&pb.isGraph;case"tbUnitSelector":case"tbValueSelector":return(pb.isGrid||pb.isGraph)&&!pb.isVisualization;case"drillEditor":return mstr.behaviors.featureResolver.resolveFeatSet("drill-editor;enable-drill-editor;is-not-visualization-mode;show-filter-on-selections-checks");case"drill":return mstr.behaviors.featureResolver.resolveFeatSet("drill-editor;enable-drill-editor;is-not-visualization-mode;!show-filter-on-selections-checks");default:if(mstrGridStaticScript&&mstrGridStatic.isGraphCommand(cmdId)){if(pb.isGrid&&pb.isGraph){var graphBone=microstrategy.bone(pb.id+"_graph");return graphBone&&graphBone.commands.queryVisible(cmdId);}}return mstrGridStaticCommands.prototype.queryVisible.call(this,cmdId);}};function mstrGridCommands(parentBone){this.parentBone=parentBone;return this;}mstrGridInfo.prototype={};mstrGridInfo.prototype.dataSetId="";mstrGridInfo.prototype.hasNoUnits=true;mstrGridInfo.prototype.isEmptyTemplate=true;mstrGridInfo.prototype.hasMetrics=false;mstrGridInfo.prototype.metricsAxis=-1;mstrGridInfo.prototype.metricsDepth=-1;mstrGridInfo.prototype.showAttForms=false;mstrGridInfo.prototype.showColHeaders=true;mstrGridInfo.prototype.showRowHeaders=true;mstrGridInfo.prototype.metricAxis=null;mstrGridInfo.prototype.rowAxis=null;mstrGridInfo.prototype.colAxis=null;mstrGridInfo.prototype.pageAxis=null;mstrGridInfo.prototype.allAxes=[];mstrGridInfo.prototype.overlapGridTitles=false;mstrGridInfo.prototype.emptyCase=false;mstrGridInfo.prototype.toString=function(){return"";};mstrGridInfo.prototype.enableColWidths=function(){try{return(this.rowAxis.size()>0||this.colAxis.size()>0||this.metricsAxis==microstrategy.GRIDCELL_AXIS_PAGE_BY);}catch(err){microstrategy.errors.log(err);return false;}};mstrGridInfo.prototype.useExtraColTag=function(){try{return(this.rowAxis.size()==0&&this.colAxis.size()==0&&this.metricsAxis==microstrategy.GRIDCELL_AXIS_PAGE_BY);}catch(err){microstrategy.errors.log(err);return false;}};mstrGridInfo.prototype.hasNonMetricUnitsOnAxis=function(axisType){try{var __result=false;if(!this.isEmptyTemplate&&axisType!=null){var sa=this.getAxisFromType(axisType);if(sa!=null){var ss=sa.size();if(ss>0&&(ss>1||this.metricsAxis!=axisType)){__result=true;}}}return __result;}catch(err){microstrategy.errors.log(err);return false;}};mstrGridInfo.prototype.getAttributes=function(){try{var __result=[];for(var i=0,cnt=this.allAxes.length;i<cnt;i++){var ax=this.allAxes[i];for(var j=0,cnt2=ax.size();j<cnt2;j++){var currentUnit=ax.units[j];if(currentUnit!=null&&currentUnit.dssType==microstrategy.DSSTYPE_ATTRIBUTE){__result.push(ax.units[j]);}}}return __result;}catch(err){microstrategy.errors.log(err);return null;}};mstrGridInfo.prototype.getFixedColumns=function(){try{if(!this.showRowHeaders){return 0;}var __result=(this.parentBone.isOutlineMode)?this.rowAxis.size():this.rowAxis.totalSize();if(this.showColHeaders&&(this.colAxis.size()>0)&&!this.overlapGridTitles){__result++;}return __result;}catch(err){microstrategy.errors.log(err);return -1;}};mstrGridInfo.prototype.getFixedRows=function(){try{var result=0;if(this.showColHeaders){result=this.colAxis.totalSize();result=(result==0)?1:result;}else{result=util_getFixedRows(this.parentBone.gridTable);}return result;}catch(err){microstrategy.errors.log(err);return -1;}};mstrGridInfo.prototype.getAxisFromType=function(axisType){var m=null;switch(axisType){case microstrategy.GRIDCELL_AXIS_ROWS:m=1;break;case microstrategy.GRIDCELL_AXIS_COLUMNS:m=2;break;case microstrategy.GRIDCELL_AXIS_PAGE_BY:m=3;break;}return m&&this.allAxes[m];};mstrGridInfo.prototype.unitTypeExistsOnAxis=function(axisType,searchUnitTypes){try{var __result=false;if(!this.isEmptyTemplate&&axisType!=null){var sa=this.getAxisFromType(axisType);if(sa!=null){for(var i=0,cnt=sa.units.length;i<cnt;i++){if(sa.units[i]!=null){for(var j=0,cnt2=searchUnitTypes.length;j<cnt2;j++){if(sa.units[i].dssType==searchUnitTypes[j]){return true;}}}}}}return __result;}catch(err){microstrategy.errors.log(err);return null;}};mstrGridInfo.prototype.findUnit=function(id){try{var __result=null;for(var i=0,cnt=this.allAxes.length;i<cnt;i++){__result=this.allAxes[i].findUnit(id);if(__result!=null){break;}}return __result;}catch(err){microstrategy.errors.log(err);return null;}};mstrGridInfo.prototype.findUnitInfo=function(objInfo){try{var __result=null;if(objInfo.dssType!=microstrategy.DSSTYPE_ATTRIBUTE_FORM){__result=this.findUnit(objInfo.dssId);}else{var unitInfo=this.findUnit(objInfo.parentDssId);if(unitInfo){if(unitInfo.hasAttForms()){__result=unitInfo.attForms.findUnit(objInfo.dssId);}else{if(unitInfo.attFormId==objInfo.dssId){__result=unitInfo;}}}}return __result;}catch(err){microstrategy.errors.log(err);return null;}};mstrGridInfo.prototype.getUnitIndex=function(axis,depth,subDepth){try{var __result=0;var fn=function(s){if(s>1){__result+=s-1;}};if(axis==microstrategy.GRIDCELL_AXIS_ROWS){__result+=this.rowAxis.unitLength(depth);fn(subDepth);if(this.metricsAxis==microstrategy.GRIDCELL_AXIS_ROWS&&this.metricsDepth<=depth){__result+=this.metricAxis.size()-1;}return __result;}if(axis==microstrategy.GRIDCELL_AXIS_COLUMNS){__result+=this.rowAxis.headerSize();if(this.metricsAxis==microstrategy.GRIDCELL_AXIS_ROWS){__result--;__result+=this.metricAxis.size();}__result+=this.colAxis.unitLength(depth);fn(subDepth);if(this.metricsAxis==microstrategy.GRIDCELL_AXIS_COLUMNS&&this.metricsDepth<=depth){__result+=this.metricAxis.size()-1;}return __result;}if(axis==microstrategy.GRIDCELL_AXIS_METRICS){if(this.metricsAxis==microstrategy.GRIDCELL_AXIS_ROWS){__result+=this.metricsDepth;fn(depth);return __result;}if(this.metricsAxis==microstrategy.GRIDCELL_AXIS_COLUMNS){__result+=this.rowAxis.size();__result+=this.metricsDepth;fn(depth);return __result;}}}catch(err){microstrategy.errors.log(err);}return null;};mstrGridInfo.prototype.getMaxAxisPosition=function(axis){try{if((axis==microstrategy.GRIDCELL_AXIS_METRICS)&&mstrGridReport.isViewMode()){return this.parentBone.metricsCount+1;}return(axis==microstrategy.GRIDCELL_AXIS_METRICS)?this.allAxes[0].size()+1:this.allAxes[axis].size()+1;}catch(err){microstrategy.errors.log(err);return null;}};mstrGridInfo.prototype.getGridUnitInfo=function(item,passSubdepth){try{var axis=microstrategy.GRIDCELL_AXIS_METRICS;var ga=function(s){return item.getAttribute(microstrategy["HTMLATTR_"+s]);};var subtype=ga("SUBOBJTYPE");var dssType=ga("DSS_TYPE");if(!mstrGridReport.isMetric(dssType,(subtype==microstrategy.SUBOBJTYPE_METRIC&&dssType==microstrategy.DSSTYPE_PROMPT))){axis=parseInt(ga("GRIDCELL_AXIS"));}var subDepth=null;if(passSubdepth==undefined||passSubdepth){subDepth=Math.max(parseInt(this.getAttrFormPos(item)),1);}var oid=ga("DSS_ID");var unitBaseOnID=oid&&this.findUnit(oid);var unitDepth=null;if(mstr.utils.String.isEmpty(unitBaseOnID)){if(item.getAttribute("MH")&&item.getAttribute("MH").toLowerCase()=="true"){var axisUnits=this.allAxes[axis].units;for(var i=0;i<axisUnits.length;i++){if(axisUnits[i].isMetricTemplateUnit){return axisUnits[i];}}}else{unitDepth=ga("GRIDCELL_DEPTH");}}else{unitDepth=unitBaseOnID.depth;}var unit=this.getUnit(axis,parseInt(unitDepth),subDepth);if(!unit){unit=unitBaseOnID;}return unit;}catch(err){microstrategy.errors.log(err);return null;}};mstrGridInfo.prototype.getGridUnitInfoBySrc=function(item){var axis=microstrategy.GRIDCELL_AXIS_METRICS;var ga=function(s){return item.getAttribute(microstrategy["HTMLATTR_"+s]);};var subtype=ga("SUBOBJTYPE");var dssType=ga("DSS_TYPE");if(!mstrGridReport.isMetric(dssType,(subtype==microstrategy.SUBOBJTYPE_METRIC&&dssType==microstrategy.DSSTYPE_PROMPT))){axis=parseInt(ga("GRIDCELL_AXIS"));}subDepth=Math.max(parseInt(this.getAttrFormPos(item)),1);var unit=this.getUnitByLocation(axis,parseInt(ga("GRIDCELL_DEPTH")),subDepth);if(!unit){var oid=ga("DSS_ID");unit=oid&&this.findUnit(oid);}return unit;};mstrGridInfo.prototype.getUnitByLocation=function(axis,depth,subDepth){try{var __result=null;var localAxis=(axis==microstrategy.GRIDCELL_AXIS_METRICS)?0:axis;var axisObj=this.allAxes[localAxis];if(axisObj!=null){var unit=null;for(var i in axisObj.units){var u=axisObj.units[i];if(u.depth==depth){unit=u;u.index=i;break;}}__result=(unit&&unit.hasAttForms()&&subDepth!=null&&subDepth>0&&unit.attForms.size()>=subDepth)?unit.attForms.units[subDepth-1]:unit;}return __result;}catch(err){microstrategy.errors.log(err);return null;}};mstrGridInfo.prototype.getUnit=function(axis,depth,subDepth){try{var __result=null;var localAxis=(axis==microstrategy.GRIDCELL_AXIS_METRICS)?0:axis;var axisObj=this.allAxes[localAxis];if(axisObj!=null&&axisObj.size()>=depth){var unit=axisObj.units[depth-1];__result=(unit&&unit.hasAttForms()&&subDepth!=null&&subDepth>0&&unit.attForms.size()>=subDepth)?unit.attForms.units[subDepth-1]:unit;}return __result;}catch(err){microstrategy.errors.log(err);return null;}};mstrGridInfo.prototype.getGridUnits=function(){try{var __result=[];var axes=new Array(this.rowAxis,this.colAxis,this.metricAxis);for(var i=0,cnt=axes.length;i<cnt;i++){for(var j=0,cnt2=axes[i].size();j<cnt2;j++){__result.push(axes[i].units[j]);}}return __result;}catch(err){microstrategy.errors.log(err);return[];}};mstrGridInfo.prototype.getAxisObj=function(objInfo){try{var isUnresolvedMOP=(objInfo.subtype==microstrategy.SUBOBJTYPE_METRIC&&objInfo.dssType==microstrategy.DSSTYPE_PROMPT);return((this.hasMetrics||(objInfo.axis==this.metricAxis.axisType))&&(mstrGridReport.isMetric(objInfo.dssType,isUnresolvedMOP)))?this.metricAxis:this.allAxes[objInfo.axis];}catch(err){microstrategy.errors.log(err);return null;}};mstrGridInfo.prototype.add=function(objInfo,isNew){try{var axisObj=this.getAxisObj(objInfo);if(axisObj){switch(objInfo.subtype){case microstrategy.SUBOBJTYPE_ATTRIBUTE:if(objInfo.isMetricTemplateUnit&&objInfo.axis==microstrategy.GRIDCELL_AXIS_PAGE_BY){var items=this.buildPageByMetrics(objInfo.src);for(var i=0,cnt=items.length;i<cnt;i++){this.metricAxis.add(items[i]);}}axisObj.add(objInfo);break;case microstrategy.SUBOBJTYPE_METRIC:if(!this.hasMetrics){var pos=this.parentBone.metricsPosInGrid&&this.parentBone.metricsPosInGrid.split("A");if(!pos||pos.length<2){pos=objInfo.src.getAttribute("upt")&&objInfo.src.getAttribute("upt").split(",");}if(pos&&pos.length>=2){var unit=this.buildGridMetricsHeaderInfo(parseInt(pos[0]),parseInt(pos[1]));this.allAxes[parseInt(pos[0])].add(unit);}else{var unit=this.buildGridMetricsHeaderInfo(objInfo.axis,objInfo.depth);axisObj.add(unit);}if(isNew){objInfo.depth=1;}}objInfo.axis=microstrategy.GRIDCELL_AXIS_METRICS;this.metricAxis.add(objInfo);break;case microstrategy.SUBOBJTYPE_ATTRIBUTE_FORM:unit=axisObj.findUnit(objInfo.parentDssId);if(unit==null){unit=this.buildGridAttUnitInfoFromForm(objInfo);axisObj.add(unit);}else{if(unit.attForms.size()==0){var child=this.buildGridAttFormInfoFromUnit(unit);unit.attForms.add(child);}}var subForm=unit.attForms.findUnit(objInfo.dssId);if(subForm==null){unit.attForms.add(objInfo);}if(!unit.attFormList){unit.attFormList=new mstrAttFormListObj(null);}unit.attFormList.addForm(objInfo.dssId);for(var k=0,cnt=unit.attForms.units.length;k<cnt;k++){unit.attForms.units[k].attFormList=unit.attFormList;}this.dataSetId=(objInfo.dssSetId)?objInfo.dssSetId:this.dataSetId;break;}if(this.parentBone.useClientSideManipulations){microstrategy.eventManager.notifyOrphanBones("ongriddatasourcechange");}}}catch(err){microstrategy.errors.log(err);}};mstrGridInfo.prototype.pivot=function(oldObjInfo,newObjInfo){try{var sao=this.getAxisObj(oldObjInfo);var tao=this.getAxisObj(newObjInfo);switch(oldObjInfo.subtype){case microstrategy.SUBOBJTYPE_ATTRIBUTE:case microstrategy.SUBOBJTYPE_METRIC:sao.remove(oldObjInfo.depth);tao.add(newObjInfo);break;case microstrategy.SUBOBJTYPE_ATTRIBUTE_FORM:var unit=sao.findUnit(oldObjInfo.parentDssId);if(oldObjInfo.axis!=newObjInfo.axis||oldObjInfo.depth!=newObjInfo.depth){unit=sao.remove(oldObjInfo.depth);sao.setAxis(unit,newObjInfo.axis);sao.setDepth(unit,newObjInfo.depth);tao.add(unit);}else{unit.attForms.remove(oldObjInfo.subDepth);unit.attForms.add(newObjInfo);}break;}}catch(err){microstrategy.errors.log(err);}};mstrGridInfo.prototype.pivotUnit=function(fromAxis,fromDepth,fromSubDepth,toAxis,toDepth,toSubDepth){try{var o=this.getUnit(fromAxis,fromDepth,fromSubDepth);var src=this.allAxes[fromAxis];var trg=this.allAxes[toAxis];src.remove(fromDepth);o.axis=toAxis;o.depth=toDepth;o.subDepth=toSubDepth;trg.add(o);}catch(err){microstrategy.errors.log(err);}};mstrGridInfo.prototype.remove=function(objInfo){try{var axisObj=this.getAxisObj(objInfo);switch(objInfo.subtype){case microstrategy.SUBOBJTYPE_ATTRIBUTE:axisObj.remove(objInfo.depth);if(objInfo.isMetricTemplateUnit){this.allAxes[0]=this.metricAxis=new mstrGridAxisObj(this,microstrategy.GRIDCELL_AXIS_METRICS);}break;case microstrategy.SUBOBJTYPE_METRIC:axisObj.remove(objInfo.depth);if(this.metricAxis.size()==0){var fun=this.metricsAxis==microstrategy.GRIDCELL_AXIS_ROWS?"rowAxis":"colAxis";if(this[fun].size()>=this.metricsDepth){this[fun].remove(this.metricsDepth);}}break;case microstrategy.SUBOBJTYPE_ATTRIBUTE_FORM:var attUnit=axisObj.findUnit(objInfo.parentDssId);var aaf=attUnit.attForms;aaf.remove(objInfo.subDepth);var length=aaf.size();if(length==0){axisObj.remove(attUnit.depth);}else{if(length==1){var depth=attUnit.depth;var newUnit=this.buildGridAttUnitInfoFromForm(aaf.units[0]);axisObj.remove(attUnit.depth);axisObj.add(newUnit);attUnit=newUnit;}else{attUnit.attFormName=aaf.units[0].alias;attUnit.attFormId=aaf.units[0].dssId;}}attUnit.attFormList.removeForm(objInfo.dssId);for(var k=0,cnt=aaf.units.length;k<cnt;k++){aaf.units[k].attFormList=attUnit.attFormList;}break;}}catch(err){microstrategy.errors.log(err);}};mstrGridInfo.prototype.swapAxes=function(){try{if(!this.isEmptyTemplate){var ROW=microstrategy.GRIDCELL_AXIS_ROWS;var COL=microstrategy.GRIDCELL_AXIS_COLUMNS;var moveMetrics=(!this.hasNonMetricUnitsOnAxis(ROW)||!this.hasNonMetricUnitsOnAxis(COL));var hasMetrics=(this.metricsAxis==ROW||this.metricsAxis==COL);if(hasMetrics&&!moveMetrics){var metricsDepth=this.metricsDepth;var metricsUnit=this.getUnit(this.metricsAxis,this.metricsDepth,1);if(metricsDepth==this.getAxisObj(metricsUnit).size()){metricsDepth=-1;}var metrics=this.metricAxis.clear();this.remove(metricsUnit);}this.rowAxis.setEntireAxis(COL);var cols=this.rowAxis.clear();this.colAxis.setEntireAxis(ROW);var rows=this.colAxis.clear();var that=this;var fn=function(a){for(var i=0,cnt=a.length;i<cnt;i++){that.add(a[i]);}};fn(cols);fn(rows);if(hasMetrics&&!moveMetrics){var axis=this.getAxisObj(metricsUnit);if(metricsDepth==-1||metricsDepth>axis.size()){metricsUnit.depth=axis.size()+1;}this.add(metricsUnit);for(i=0,cnt=metrics.length;i<cnt;i++){this.add(metrics[i]);}}}}catch(err){microstrategy.errors.log(err);}};mstrGridInfo.prototype.init=function(grid){try{var that=this;var fn=function(s){return new mstrGridAxisObj(that,microstrategy["GRIDCELL_AXIS_"+s]);};this.rowAxis=fn("ROWS");this.colAxis=fn("COLUMNS");this.metricAxis=fn("METRICS");this.pageAxis=fn("PAGE_BY");this.allAxes=new Array(this.metricAxis,this.rowAxis,this.colAxis,this.pageAxis);this.emptyCase=(grid.getAttribute("ept")=="-1");var pb=this.parentBone;if(pb.rowAxis||pb.colAxis||pb.pagebyAxis||pb.metricsAxis){this.initFromProp();}else{this.initFromHTML(grid);}this.initSharedCellProperties();this.isEmptyTemplate=(this.rowAxis.size()==0&&this.colAxis.size()==0);this.hasNoUnits=(this.isEmptyTemplate&&this.pageAxis.size()==0);}catch(err){microstrategy.errors.log(err);}};mstrGridInfo.prototype.initFromProp=function(){try{var pb=this.parentBone;var axes=new Array(pb.rowAxis,pb.colAxis,pb.pagebyAxis,pb.metricsAxis);for(var i=0,cnt=axes.length;i<cnt;i++){var axis=axes[i];if(axis!=null){for(var j=0,cnt2=axis.length;j<cnt2;j++){var unit=new mstrGridUnitInfo();unit.populate(axis[j],this);this.add(unit);}}}}catch(err){microstrategy.errors.log(err);}};mstrGridInfo.prototype.initFromHTML=function(el){try{var tbl=el.getElementsByTagName("table")[0];var isDesignGraph=(tbl&&tbl.getAttribute("id")===(this.parentBone.id+"_gdz"));if(isDesignGraph){this.initFromGraphHtml(el);}else{this.initFromGridHtml(el);}if(mstrGridReport.isReport()){var pb=document.getElementById("pbb_PageByStyle");if(!pb){return ;}var cells=pb.getElementsByTagName("span");for(var i=0,cnt=cells.length;i<cnt;i++){if(cells[i].getAttribute(microstrategy.HTMLATTR_OBJTYPE)!=microstrategy.OBJTYPE_PAGE_BY_ELEM){continue;}this.add(this.buildGridUnitInfo(cells[i]));}}}catch(err){microstrategy.errors.log(err);}};mstrGridInfo.prototype.initFromGraphHtml=function(el){try{var cells=el.getElementsByTagName("span");for(var i=0,cnt=cells.length;i<cnt;i++){var ax=cells[i].getAttribute(microstrategy.HTMLATTR_GRIDCELL_AXIS);if(!ax){continue;}if(cells[i].getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==microstrategy.OBJTYPE_METRIC){this.hasMetrics=true;this.metricsAxis=ax;}this.add(this.buildGridUnitInfo(cells[i]));}}catch(err){microstrategy.errors.log(err);}};mstrGridInfo.prototype.initFromGridHtml=function(el){try{var tbody=el.getElementsByTagName("TBODY")[0];if(!tbody){return ;}if(mstrGridReport.isReport()){var me=this;tbody.onmouseover=function(evt){return me.parentBone.onmouseover(evt);};tbody.onmouseout=function(evt){return me.parentBone.onmouseout(evt);};}var metricsCount=0;outer:for(var i=0,cnt=tbody.rows.length;i<cnt;i++){var row=tbody.rows[i];if(row.getAttribute("o")!=null&&!this.parentBone.metricsOnRows){break;}for(var j=0,cellCnt=row.cells.length;j<cellCnt;j++){var cell=row.cells[j];if(cell.nodeType==1){var ax=cell.getAttribute(microstrategy.HTMLATTR_GRIDCELL_AXIS);if(ax!=null&&(cell.getAttribute(microstrategy.HTMLATTR_DSS_ID)!=null||cell.getAttribute("mh")=="TRUE")){var objInfo=this.buildGridUnitInfo(cell);var isMetric=(objInfo.subtype==microstrategy.OBJTYPE_METRIC);var unit=(isMetric)?unit=this.findUnit(objInfo.dssId):null;if(ax==microstrategy.GRIDCELL_AXIS_ROWS&&isMetric&&unit){if(metricsCount==this.parentBone.metricsCount){break outer;}break;}if(!unit){if(isMetric&&ax==microstrategy.GRIDCELL_AXIS_ROWS){metricsCount++;}this.add(objInfo);if(this.colAxis.units&&this.colAxis.units[0]&&this.colAxis.units[0].src==null&&isMetric){this.colAxis.units[0].src=objInfo.src;this.colAxis.units[0].isVisible=true;this.colAxis.units[0].needBuildColMetricAreas=true;}}}}}}if(this.parentBone.hiddenUnitInfo){var unitInfo=new mstrGridUnitInfo();unitInfo.populate(this.parentBone.hiddenUnitInfo,this);this.add(unitInfo);}}catch(err){microstrategy.errors.log(err);}};mstrGridInfo.prototype.syncUnitSources=function(isGraph,targetId,showAttForms){try{for(var i=0,cnt=this.allAxes.length;i<cnt;i++){for(var j=0,cnt2=this.allAxes[i].size();j<cnt2;j++){this.allAxes[i].units[j].populateUnitSrc(isGraph,targetId,showAttForms);}}}catch(err){microstrategy.errors.log(err);}};mstrGridInfo.prototype.getAttValue=function(cellSrc,att,defaultVal){try{var value=cellSrc&&cellSrc.getAttribute(att);return(value?value:defaultVal);}catch(err){microstrategy.errors.log(err);return null;}};mstrGridInfo.prototype.getAttrFormPos=function(cellSrc){return this.getAttValue(cellSrc,microstrategy.HTMLATTR_FORM_POS,"1");};mstrGridInfo.prototype.getCellType=function(cellSrc){return this.getAttValue(cellSrc,microstrategy.HTMLATTR_GRID_CELL_TYPE,microstrategy.GRIDCELLTYPE_UNIT_VALUE);};mstrGridInfo.prototype.buildGridUnitInfo=function(cell,axis,depth,subdepth){try{var __result=new mstrGridUnitInfo();if(cell!=null){if(cell.nodeType==1){var fn=function(s){return cell.getAttribute(microstrategy["HTMLATTR_"+s]);};__result.subtype=fn("SUBOBJTYPE");__result.dssSubtype=fn("DSS_SUBTYPE");var des=fn("DESCRIPTION");__result.alias=(des!=null)?trim(des):cell.firstChild&&cell.firstChild.data;if(!__result.alias){__result.alias="";}var dssDes=fn("DSS_DESCRIPTION");if(dssDes!=null){__result.description=dssDes;}__result.src=cell;var ATT=microstrategy.SUBOBJTYPE_ATTRIBUTE;var FORM=microstrategy.SUBOBJTYPE_ATTRIBUTE_FORM;var MTC=microstrategy.SUBOBJTYPE_METRIC;var search="|"+ATT+"|"+FORM+"|"+MTC+"|";function _formatUnit(defaultForms,result){for(var i=0,cnt=defaultForms.length;i<cnt;i++){var unit=new mstrGridUnitInfo();unit.axis=result.axis;unit.depth=result.depth;unit.subDepth=i+1;unit.subtype=FORM;unit.dssSetId=result.dssSetId;unit.dssId=unit.attFormId=defaultForms[i][mstrAttFormListObj.FORM_ID];unit.dssType=microstrategy.DSSTYPE_ATTRIBUTE_FORM;unit.alias=unit.attFormName=defaultForms[i][mstrAttFormListObj.FORM_NAME];unit.parentDssId=result.dssId;unit.parentAlias=result.alias;unit.attFormList=result.attFormList;unit.isVisible=true;unit.src=result.src;result.attForms.add(unit);}}if(search.indexOf("|"+__result.subtype+"|")>-1){__result.axis=(axis!=null)?parseInt(axis):(__result.subtype==microstrategy.OBJTYPE_METRIC)?microstrategy.GRIDCELL_AXIS_METRICS:parseInt(fn("GRIDCELL_AXIS"));__result.depth=(depth!=null)?parseInt(depth):parseInt(fn("GRIDCELL_DEPTH"));__result.subDepth=(subdepth!=null)?parseInt(subdepth):parseInt(this.getAttrFormPos(cell));__result.isMetricTemplateUnit=(cell.getAttribute("MH")&&cell.getAttribute("MH").toLowerCase()=="true");__result.dssSetId=this.dataSetId;__result.isLocked=(fn("IS_LOCKED")==microstrategy.TRUE);if(__result.subtype==FORM){__result.dssId=__result.attFormId=fn("FORM_ID");__result.dssType=microstrategy.DSSTYPE_ATTRIBUTE_FORM;__result.parentDssId=fn("DSS_ID");var alias=__result.alias;__result.alias=__result.attFormName=fn("FORM_NAME");if(alias.indexOf(__result.alias)>-1){__result.parentAlias=trim(alias.substr(0,alias.indexOf(__result.alias)));}__result.attFormList=new mstrAttFormListObj(fn("FORM_LIST"));}else{if(!__result.isMetricTemplateUnit){__result.dssId=fn("DSS_ID");__result.dssType=fn("DSS_TYPE");}if(__result.subtype==ATT&&!__result.isMetricTemplateUnit){__result.attForms=new mstrGridAxisObj(null,0);var formId=fn("FORM_ID");var formName=fn("FORM_NAME");if(formId!=null&&formName!=null){__result.attFormId=formId;__result.attFormName=formName;}__result.attFormList=new mstrAttFormListObj(fn("FORM_LIST"));if(!this.showAttForms||this.parentBone.isOutlineMode||this.parentBone.isStaticOutlineMode){var attForms=__result.attFormList.getFormsOnView();if(attForms&&attForms.length>1){_formatUnit(attForms,__result);}}}}}else{__result.dssId=fn("DSS_ID");__result.dssType=fn("DSS_TYPE");__result.dssSetId=(cell.getAttribute("id"))?cell.getAttribute("id").slice(0,32):"";__result.axis=parseInt(axis);__result.depth=parseInt(depth);__result.isMetricTemplateUnit=false;if(__result.dssType==microstrategy.DSSTYPE_ATTRIBUTE_FORM){__result.attFormName=fn("DESCRIPTION");__result.attFormId=fn("DSS_ID");__result.attFormList=new mstrAttFormListObj(fn("FORM_LIST"));var parentUL=findTargetTag(cell,"UL");if(parentUL){var parentLI=findTargetTag(parentUL,"LI");if(parentLI&&parentLI.getElementsByTagName("span")[0]){var anchor=parentLI.getElementsByTagName("span")[0];__result.parentDssId=anchor.getAttribute(microstrategy.HTMLATTR_DSS_ID);__result.parentAlias=anchor.getAttribute(microstrategy.HTMLATTR_DESCRIPTION);}}}else{if(__result.dssType==microstrategy.DSSTYPE_ATTRIBUTE){__result.attForms=new mstrGridAxisObj(null,0);__result.attFormList=new mstrAttFormListObj(fn("FORM_LIST"));__result.attFormList.addDefaultForms();var defaultForms=__result.attFormList.getDefaultForms();if(defaultForms.length<=1){for(i=0,cnt=defaultForms.length;i<cnt;i++){__result.attFormName=defaultForms[i][mstrAttFormListObj.FORM_NAME];__result.attFormId=defaultForms[i][mstrAttFormListObj.FORM_ID];}}else{_formatUnit(defaultForms,__result);}}}__result.subDepth=1;if(mstrGridReport.isMetric(__result.dssType)){__result.subtype=MTC;}else{if(__result.dssType==microstrategy.DSSTYPE_ATTRIBUTE_FORM){__result.subtype=FORM;__result.subDepth=parseInt(subdepth);}else{__result.subtype=ATT;}}}}}else{__result.subtype=ATT;__result.axis=axis;__result.depth=depth;__result.subDepth=1;__result.dssSetId=this.dataSetId;}if(__result.subDepth==null||isNaN(__result.subDepth)){__result.subDepth=1;}if(cell&&cell.getAttribute("olap")=="1"){__result.olap=true;}return __result;}catch(err){microstrategy.errors.log(err);return null;}};mstrGridInfo.prototype.buildFormSrcFromCM=function(attInfo,formName,formID){try{var att=attInfo.src;var attID=att.getAttribute(microstrategy.HTMLATTR_DSS_ID);var attFormsList=att.getAttribute(microstrategy.HTMLATTR_FORM_LIST);var attForms=new mstrAttFormListObj(attFormsList);var subDepth=(attForms!=null&&attForms.getFormsOnView()!=null)?attForms.getFormsOnView().length+1:"1";var td=document.createElement("td");var fn=function(s,v){td.setAttribute(microstrategy["HTMLATTR_"+s],v);};fn("IS_LOCKED",((attInfo.isLocked)?microstrategy.TRUE:microstrategy.FALSE));fn("SUBOBJTYPE",microstrategy.SUBOBJTYPE_ATTRIBUTE_FORM);fn("FORM_ID",formID);fn("DSS_ID",attID);fn("FORM_NAME",formName);fn("FORM_POS",subDepth);fn("FORM_LIST",attFormsList);var alias;if(attInfo.parentAlias!=null&&attInfo.parentAlias.length>0){alias=attInfo.parentAlias;}else{if(attInfo.alias!=null&&attInfo.alias.length>0){alias=attInfo.alias;}}alias+=" "+formName;td.setAttribute(microstrategy.HTMLATTR_DESCRIPTION,alias);return td;}catch(err){microstrategy.errors.log(err);return null;}};mstrGridInfo.prototype.buildGridAttUnitInfoFromForm=function(unit){try{var __result=this.buildGridUnitInfo(unit.src,unit.axis,unit.depth,1);__result.subtype=microstrategy.SUBOBJTYPE_ATTRIBUTE;__result.alias=unit.parentAlias;__result.attForms=new mstrGridAxisObj(null,0);__result.attForms.add(unit);__result.parentDssId="";__result.parentAlias="";__result.attFormName=unit.alias;__result.attFormId=unit.dssId;__result.attFormList=unit.attFormList;__result.dssId=unit.parentDssId;__result.dssType=microstrategy.DSSTYPE_ATTRIBUTE;__result.isMetricTemplateUnit=false;__result.dssSetId=unit.dssSetId;__result.isLocked=unit.isLocked;return __result;}catch(err){microstrategy.errors.log(err);return null;}};mstrGridInfo.prototype.buildGridAttFormInfoFromUnit=function(unit){try{var __result=this.buildGridUnitInfo(unit.src,unit.axis,unit.depth,1);__result.subtype=microstrategy.SUBOBJTYPE_ATTRIBUTE_FORM;__result.alias=unit.attFormName;__result.attForms=null;__result.parentDssId=unit.dssId;__result.parentAlias=unit.alias;__result.attFormName=unit.attFormName;__result.attFormId=unit.attFormId;__result.attFormList=unit.attFormList;__result.dssId=unit.attFormId;__result.dssType=microstrategy.DSSTYPE_ATTRIBUTE_FORM;__result.isMetricTemplateUnit=false;__result.dssSetId=unit.dssSetId;__result.isLocked=unit.isLocked;return __result;}catch(err){microstrategy.errors.log(err);return null;}};mstrGridInfo.prototype.buildGridMetricsHeaderInfo=function(axis,depth){try{var __result=this.buildGridUnitInfo(null,axis,depth,1);__result.subtype=microstrategy.SUBOBJTYPE_ATTRIBUTE;__result.alias=mstrGridReport.desp("1158");__result.attForms=null;__result.parentDssId="";__result.parentAlias="";__result.attFormName="";__result.attFormId="";__result.attFormList="";__result.dssId="";__result.dssType="";__result.isMetricTemplateUnit=true;__result.isVisible=false;__result.dssSetId=this.dataSetId;return __result;}catch(err){microstrategy.errors.log(err);return null;}};mstrGridInfo.prototype.buildPageByMetrics=function(src){try{var items=[];if(src){var mid=src.getAttribute("mid");if(mid){var raw=mid.split("~");for(var i=0,cnt=raw.length;i<cnt;i++){var info=this.buildGridUnitInfo(null,microstrategy.GRIDCELL_AXIS_METRICS,i+1,1);var txt=raw[i].split("|");info.subtype=microstrategy.SUBOBJTYPE_METRIC;info.dssType=microstrategy.DSSTYPE_METRIC;info.dssId=txt[0];info.alias=txt[1];info.dssSetId=this.dataSetId;info.src=src;items.push(info);}}}return items;}catch(err){microstrategy.errors.log(err);return null;}};mstrGridInfo.prototype.axisUnitChange=function(){try{this.isEmptyTemplate=(this.rowAxis.size()==0&&this.colAxis.size()==0);this.hasNoUnits=(this.isEmptyTemplate&&this.pageAxis.size()==0);}catch(err){microstrategy.errors.log(err);}};mstrGridInfo.prototype.hasEmptyAxis=function(){try{return(this.rowAxis.size()==0||this.colAxis.size()==0||this.metricAxis.size()==0);}catch(err){microstrategy.errors.log(err);return false;}};mstrGridInfo.prototype.initSharedCellProperties=function(){var sharedMap=this.parentBone&&this.parentBone.hdrMvMap;if(sharedMap){this.valueCellProps={};for(var axId in sharedMap){this.valueCellProps[axId]={};var ax=sharedMap[axId];for(var dId in ax){var unit=new mstrGridCellProps(this,axId,parseInt(dId)+1);for(var n in ax[dId]){if(ax[dId][n]){unit[n]=ax[dId][n];}}if(!unit.p){unit.p=unit.depth;if(axId==="0"&&this.parentBone.currentPageX>0){var metricAx=this.allAxes[0];for(var p in metricAx.units){if(metricAx.units[p].depth==unit.depth){unit.p=parseInt(p)+1;break;}}}}if(!unit.tup){unit.tup=unit.depth;}this.valueCellProps[axId][dId]=unit;}}}};mstrGridInfo.prototype.getGridCellProps=function getGridCellProps(item){if(!item){return ;}var cellId;if(typeof item=="string"){cellId=item;}else{cellId=item.getAttribute(microstrategy.HTMLATTR_GRIDCELL_ID);}var ps=cellId&&cellId.split("A");if(ps&&ps.length==2&&!isNaN(ps[0])&&!isNaN(ps[1])&&this.valueCellProps){return this.valueCellProps[ps[0]][parseInt(ps[1])-1];}};function mstrGridInfo(gridBone){this.parentBone=gridBone;this.dataSetId=gridBone.dSetId;this.showAttForms=gridBone.showAttForms;this.showColHeaders=gridBone.showColHeaders;this.showRowHeaders=gridBone.showRowHeaders;this.overlapGridTitles=gridBone.overlapGridTitles;return this;}mstrGridAxisObj.prototype={};mstrGridAxisObj.prototype.parentGridInfo=null;mstrGridAxisObj.prototype.axisType=-2;mstrGridAxisObj.prototype.units=null;mstrGridAxisObj.prototype.toString=function(offset){try{if(offset==null){offset="";}if(this.size()>0){var s=offset+"Axis "+this.axisType+"\n\n";for(var i=0,cnt=this.size();i<cnt;i++){s+=(this.units[i].hasAttForms())?this.units[i].attForms.toString("     "):this.units[i].toString(offset);}return s;}else{return mstrGridReport.desp("2210");}}catch(err){microstrategy.errors.log(err);return -1;}};mstrGridAxisObj.prototype.clear=function(){try{var __result=[];for(var i=0;i<this.size();i++){if(!this.units[i].isMetricsTemplateUnit){__result.push(this.units[i]);}}this.units=[];return __result;}catch(err){microstrategy.errors.log(err);return -1;}};mstrGridAxisObj.prototype.size=function(){try{return this.units.length;}catch(err){microstrategy.errors.log(err);return -1;}};mstrGridAxisObj.prototype.unitLength=function(depth){try{return(this.parentGridInfo!=null&&this.parentGridInfo.showAttForms)?this.axisCellLength(depth):depth;}catch(err){microstrategy.errors.log(err);return -1;}};mstrGridAxisObj.prototype.get=function(index){try{if(index>this.size()-1){microstrategy.errors.log("Index out of bounds exception: Axis "+this.axisType+" doesn't contain an unit at the "+index+" index.");return null;}return this.units[index];}catch(err){microstrategy.errors.log(err);return null;}};mstrGridAxisObj.prototype.axisCellLength=function(depth){try{var __result=0;for(var i=0;i<depth;i++){__result+=(this.units[i]!=null&&this.units[i].hasAttForms())?this.units[i].attForms.size():1;}return __result;}catch(err){microstrategy.errors.log(err);return -1;}};mstrGridAxisObj.prototype.headerSize=function(){try{return(this.parentGridInfo!=null&&this.parentGridInfo.showAttForms)?this.headerCellSize():this.size();}catch(err){microstrategy.errors.log(err);return -1;}};mstrGridAxisObj.prototype.headerCellSize=function(){try{return this.axisCellLength(this.size());}catch(err){microstrategy.errors.log(err);return -1;}};mstrGridAxisObj.prototype.totalSize=function(){try{var __result=0;for(var i=0,cnt=this.size();i<cnt;i++){var u=this.units[i];__result+=(u!=null&&u.hasAttForms())?u.attForms.size():1;}return __result;}catch(err){microstrategy.errors.log(err);return -1;}};mstrGridAxisObj.prototype.findUnit=function(dssId){try{if(dssId==null){dssId="";}for(var i=0,cnt=this.units.length;i<cnt;i++){if(this.units[i].dssId==dssId){return this.units[i];}}return null;}catch(err){microstrategy.errors.log(err);return null;}};mstrGridAxisObj.prototype.add=function(obj){try{var depth=(this.axisType!=microstrategy.GRIDCELL_AXIS_ATT_FORMS)?obj.depth:obj.subDepth;if(depth==-1){depth=this.size()+1;if(this.axisType!=microstrategy.GRIDCELL_AXIS_ATT_FORMS){obj.depth=depth;}else{obj.subDepth=depth;}}if(obj.dssType==microstrategy.DSSTYPE_HIERARCHY){var unit=this.findUnit(obj.dssId);if(unit){unit.lastHiSrc=obj.src;return true;}}if(depth>this.size()){var i=this.units.push(obj);depth=i;}else{this.updateDepth(depth,1);this.units.splice(depth-1,0,obj);}if(this.axisType>microstrategy.GRIDCELL_AXIS_ATT_FORMS){this.setDepth(this.units[depth-1],depth);this.setAxis(this.units[depth-1],this.axisType);}if(this.parentGridInfo!=null){if(obj.isMetricTemplateUnit){this.updateMetricsInfo(depth);}this.parentGridInfo.axisUnitChange();this.parentGridInfo.dataSetId=obj.dssSetId;}return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrGridAxisObj.prototype.remove=function(depth){try{this.updateDepth(depth+1,-1);var __result=this.units.splice(depth-1,1)[0];if(this.parentGridInfo!=null){if(__result.isMetricTemplateUnit){this.updateMetricsInfo(-1);}this.parentGridInfo.axisUnitChange();}return __result;}catch(err){microstrategy.errors.log(err);return false;}};mstrGridAxisObj.prototype.updateMetricsInfo=function(depth){try{if(this.parentGridInfo!=null){var c=(depth!=-1);var pgi=this.parentGridInfo;pgi.hasMetrics=c;pgi.metricsAxis=c?this.axisType:-1;pgi.metricsDepth=c?depth:-1;}}catch(err){microstrategy.errors.log(err);}};mstrGridAxisObj.prototype.updateDepth=function(depth,offset){try{if(this.axisType!=microstrategy.GRIDCELL_AXIS_ATT_FORMS){for(var i=depth-1,cnt=this.units.length;i<cnt;i++){var unit=this.units[i];if(unit){unit.depth=unit.depth+offset;if(unit.hasAttForms()){for(var j=0,cnt2=unit.attForms.size();j<cnt2;j++){unit.attForms.units[j].depth=unit.attForms.units[j].depth+offset;}}}}var pgi=this.parentGridInfo;if(pgi.metricsAxis==this.axisType&&pgi.metricsDepth>=depth){pgi.metricsDepth=pgi.metricsDepth+offset;}}else{for(i=depth-1,cnt=this.units.length;i<cnt;i++){this.units[i].subDepth=this.units[i].subDepth+offset;}}}catch(err){microstrategy.errors.log(err);}};mstrGridAxisObj.prototype.setAxis=function(unit,newAxis){try{unit.axis=newAxis;if(unit.hasAttForms()){for(var i=0,cnt=unit.attForms.size();i<cnt;i++){unit.attForms.setAxis(unit.attForms.units[i],newAxis);}}}catch(err){microstrategy.errors.log(err);}};mstrGridAxisObj.prototype.setEntireAxis=function(newAxis){try{for(var i=0,cnt=this.size();i<cnt;i++){this.setAxis(this.units[i],newAxis);}}catch(err){microstrategy.errors.log(err);}};mstrGridAxisObj.prototype.setDepth=function(unit,newDepth){try{unit.depth=newDepth;if(unit.hasAttForms()){for(var i=0,cnt=unit.attForms.size();i<cnt;i++){unit.attForms.setDepth(unit.attForms.units[i],newDepth);}}}catch(err){microstrategy.errors.log(err);}};mstrGridAxisObj.prototype.getAxisUnitInfos=function(arrUnits){try{for(var i=0,cnt=this.units.length;i<cnt;i++){var unit=this.units[i];var subAxis=unit.getSubAxis();if(this.parentGridInfo!=null&&this.parentGridInfo.showAttForms&&subAxis!=null){arrUnits=subAxis.getAxisUnitInfos(arrUnits);}else{arrUnits.push(unit);}}return arrUnits;}catch(err){microstrategy.errors.log(err);return arrUnits;}};mstrGridAxisObj.prototype.setUnitSource=function(src){try{for(var i=0,cnt=this.units.length;i<cnt;i++){this.units[i].src=src;}}catch(err){microstrategy.errors.log(err);}};function mstrGridAxisObj(gridInfo,axisType){this.parentGridInfo=gridInfo;this.axisType=axisType;this.units=[];return this;}mstrGridUnitInfo.prototype={};mstrGridUnitInfo.prototype.axis=-9;mstrGridUnitInfo.prototype.depth=1;mstrGridUnitInfo.prototype.subDepth=1;mstrGridUnitInfo.prototype.alias="";mstrGridUnitInfo.prototype.description="";mstrGridUnitInfo.prototype.subtype="";mstrGridUnitInfo.prototype.isMetricTemplateUnit=false;mstrGridUnitInfo.prototype.dssSetId="";mstrGridUnitInfo.prototype.dssId="";mstrGridUnitInfo.prototype.dssType="";mstrGridUnitInfo.prototype.dssSubtype="";mstrGridUnitInfo.prototype.attForms=null;mstrGridUnitInfo.prototype.lastHiSrc=null;mstrGridUnitInfo.prototype.parentDssId="";mstrGridUnitInfo.prototype.parentAlias="";mstrGridUnitInfo.prototype.attFormName="";mstrGridUnitInfo.prototype.attFormId="";mstrGridUnitInfo.prototype.attFormList="";mstrGridUnitInfo.prototype.src=null;mstrGridUnitInfo.prototype.isVisible=true;mstrGridUnitInfo.prototype.isLocked=false;mstrGridUnitInfo.prototype.toString=function(offset){try{offset=offset||"";var s="";for(var prop in this){if(typeof (this[prop])!="function"){s+=offset+prop+": "+this[prop]+"\n";}}return(s+offset+"___________________________\n");}catch(err){microstrategy.errors.log(err);return"";}};mstrGridUnitInfo.prototype.populate=function(unit,gridInfo){try{for(var prop in unit){this[prop]=unit[prop];}if(this.subtype==microstrategy.SUBOBJTYPE_ATTRIBUTE){this.attForms=new mstrGridAxisObj(null,0);}if(this.attFormList.length>0){this.attFormList=new mstrAttFormListObj(this.attFormList);}this.populateUnitSrc(gridInfo.parentBone.isGraph,gridInfo.parentBone.id,gridInfo.showAttForms);}catch(err){microstrategy.errors.log(err);}};mstrGridUnitInfo.prototype.populateUnitSrc=function(isGraph,targetId,showAttForms){try{var id="";if(this.axis==microstrategy.GRIDCELL_AXIS_PAGE_BY){id="pbk"+this.depth;}else{id=targetId+"_"+this.axis+"_"+this.depth+"_";if(isGraph&&mstrGridReport.isRWD()){id+="1";}else{id+=(!showAttForms&&this.subDepth>1)?"1":this.subDepth;}}var elem=document.getElementById(id);if(elem!=null){this.src=elem;}else{this.isVisible=false;}}catch(err){microstrategy.errors.log(err);}};mstrGridUnitInfo.prototype.hasAttForms=function(){try{return(this.attForms!=null&&this.attForms.size()>0);}catch(err){microstrategy.errors.log(err);return false;}};mstrGridUnitInfo.prototype.getSubAxis=function(){try{return(this.hasAttForms())?this.attForms:null;}catch(err){microstrategy.errors.log(err);return false;}};mstrGridUnitInfo.prototype.getSubUnit=function(formId){try{var axis=this.getSubAxis();return(axis!=null)?axis.findUnit(formId):null;}catch(err){microstrategy.errors.log(err);return false;}};function mstrGridUnitInfo(){return this;}mstrAttFormListObj.prototype={};mstrAttFormListObj.prototype.forms=null;mstrAttFormListObj.FORM_NAME=0;mstrAttFormListObj.FORM_ID=1;mstrAttFormListObj.FORM_STATUS=2;mstrAttFormListObj.IS_TEMPLATE_FORM=3;function mstrAttFormListObj(attFormList){try{if(attFormList!=null){this.forms=[];var formsList=attFormList.split(unescape(UNIT_SEPARATOR));for(var i=0,cnt=formsList.length;i<cnt;i++){this.forms.push(formsList[i].split(unescape(mstrUpdateManager.ITEM_SEPARATOR)));}return this;}}catch(err){microstrategy.errors.log(err);}return null;}mstrAttFormListObj.prototype.toString=function(){try{if(this.forms!=null){var __result=[];for(var i=0,cnt=this.forms.length;i<cnt;i++){__result.push(this.forms[i].join(mstrUpdateManager.ITEM_SEPARATOR));}return __result.join(UNIT_SEPARATOR);}}catch(err){microstrategy.errors.log(err);}return"";};mstrAttFormListObj.prototype.putForm=function(formID,v){try{if(this.forms!=null){for(var i=0,cnt=this.forms.length;i<cnt;i++){if(this.forms[i][microstrategy.FORM_LIST_ID]==formID){this.forms[i][microstrategy.FORM_LIST_STATUS]=v;break;}}}}catch(err){microstrategy.errors.log(err);}};mstrAttFormListObj.prototype.addForm=function(formID){this.putForm(formID,microstrategy.FORM_ON_VIEW);};mstrAttFormListObj.prototype.addDefaultForms=function(){try{var dftForms=this.getDefaultForms();for(var i=0,cnt=dftForms.length;i<cnt;i++){this.addForm(dftForms[i][microstrategy.FORM_LIST_ID]);}}catch(err){microstrategy.errors.log(err);}};mstrAttFormListObj.prototype.removeForm=function(formID){this.putForm(formID,microstrategy.FORM_ON_WS);};mstrAttFormListObj.prototype.removeFormFromWS=function(formID){this.putForm(formID,microstrategy.FORM_NOT_ON_WS);};mstrAttFormListObj.prototype.getForms=function(r,s,v){try{if(this.forms!=null){r=[];for(var i=0,cnt=this.forms.length;i<cnt;i++){if(this.forms[i][mstrAttFormListObj[s]]==v){r.push(this.forms[i]);}}}return r;}catch(err){microstrategy.errors.log(err);return null;}};mstrAttFormListObj.prototype.getFormsOnView=function(){return this.getForms(null,"FORM_STATUS","1");};mstrAttFormListObj.prototype.getDefaultForms=function(){return this.getForms([],"IS_TEMPLATE_FORM",microstrategy.TRUE);};mstrGridCellProps.prototype={};mstrGridCellProps.prototype.getGridUnitInfo=function getGridUnitInfo(){return this.parentBone.getUnit(this.axis,this.p);};mstrGridCellProps.prototype.getCellUpt=function getCellUpt(){var ui=this.getGridUnitInfo();if(mstrGridReport.isMetric(ui.dssType)){return"-1,"+this.tup;}else{return this.axis+","+this.tup;}};mstrGridCellProps.prototype.getCellCx=function getCellCx(){return this.cx;};mstrGridCellProps.prototype.getAttColTitleMissing=function getAttColTitleMissing(){return this.ctm;};mstrGridCellProps.prototype.getCellDrillKey=function getCellDrillKey(){return this.dk;};mstrGridCellProps.prototype.getCellTooltip=function getCellTooltip(){return this.tp;};mstrGridCellProps.prototype.getCellDrillElement=function getCellDrillElement(context){var ords;if(typeof context!="string"&&isNaN(context)){context=context.getAttribute&&context.getAttribute(microstrategy.HTMLATTR_GRIDCELL_ORDINAL);}if(!context){return ;}ords=context.split(",");var ui=this.getGridUnitInfo();if(ui&&mstrGridReport.isMetric(ui.dssType)){var drillElems="";var gridBone=this.parentBone;var mtNbr=this.nh.split(",");for(var i in mtNbr){if(i>0){drillElems+=",";}var cellInd=mtNbr[i].split("A");drillElems+=gridBone.valueCellProps[cellInd[0]][parseInt(cellInd[1])-1].getCellDrillElement(ords[i]);}return drillElems;}else{return this.axis+"A"+this.depth+"A"+ords[0];}};function mstrGridCellProps(gridBone,axId,dId){this.parentBone=gridBone;this.axis=axId;this.depth=dId;return this;}